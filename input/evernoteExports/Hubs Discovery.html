<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (it-IT, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="405"/>

<div><span><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give a definition of hubs discovery ?</div></td></tr><tr><td><div style="text-align:start;">Hubs Discovery is a module responsible to discover best hubs (stopovers) given a specific route (origin and destination cities) and departure date. It is used at search time, in calculate searches step, to dynamically choose best hubs for Smarthub search strategy. With the discovered hubs, the provider searches are calculated and then launch to provider modules. Once provider results are received, product building phase builds the Smarthub itineraries combining the flights. </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>How many service does have hubs discovery ?</div></td></tr><tr><td><div style="text-align:start;">There is only 1 public method <b><i>getBestHubs:</i></b></div><div><br/></div><div style="padding-left:40px;"><b>Hubs Discovery Service</b></div><div><br/></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">@Path(&quot;/v1/hubsdiscovery&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">@Produces(&quot;application/json;charset=UTF-8&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">public interface HubsDiscoveryService {</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;"> </span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    String DATE_FORMAT = &quot;yyyyMMdd&quot;;</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    String FORMAT_STRING_REGEXP = &quot;^([0-9]{4})(1[0-2]|0[1-9])(3[01]|[12][0-9]|0[1-9])$&quot;;</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;"> </span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    @GET</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    @Path(&quot;/{originIataCode}/{destinationIataCode}/{departureDate}&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    @ValidateRequest</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    HubsDiscoveryResponse getBestHubs(</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @NotNull(message = &quot;A valid origin iata is mandatory&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @Size(max = 3)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @PathParam(&quot;originIataCode&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">                    String originIataCode,</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @NotNull(message = &quot;A valid destination iata is mandatory&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @Size(max = 3)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @PathParam(&quot;destinationIataCode&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">                    String destinationIataCode,</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @NotNull(message = &quot;A valid departure date is mandatory.&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @Pattern(regexp = FORMAT_STRING_REGEXP, message = &quot;Invalid format. Expected &quot; + <a href="https://jira.odigeo.com/wiki/display/KB/HubsDiscoveryService.DATE_FORMAT)" rev="en_rl_none">HubsDiscoveryService.DATE_FORMAT)</a></span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @PathParam(&quot;departureDate&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">                    String departureDate,</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">            @QueryParam(&quot;results&quot;)</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">                    int maxResults</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">    );</span></span></div><div><span style="--en-fontfamily: monospace; font-family: &quot;Source Code Pro&quot;,monospace"><span style="font-size: 12px;">}</span></span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an example of request  and response of hubs discovery ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="font-family: inherit;"><span style="font-size: 18px;">Example url (request)</span></span></b></div><div style="text-align:start;"><a href="http://hubs_discovery_endpoint/hubs-discovery/v1/hubsdiscovery/PAR/DPS/20191005?results=5" rel="nofollow" rev="en_rl_none">http://HUBS_DISCOVERY_ENDPOINT/hubs-discovery/v1/hubsdiscovery/PAR/DPS/20191005?results=</a>2</div><div><br/></div><div style="text-align:start;"><b>Example response</b></div><div style="text-align:start;">{&quot;hubIataCodes&quot;: [&quot;KUL&quot;]}</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the dependencies of hubs discovery ?</div></td></tr><tr><td><div><b>Neo4j</b>: Hubs Discovery module depends on the Neo4j graph database. This database is used to store the provider search results in a graph mode, so that a &quot;shortest path&quot; algorithm can be run to discover best hubs for a given route. More details can be found <a href="https://jira.odigeo.com/wiki/display/KB/Hubs+Discovery+Neo4j" rel="nofollow" rev="en_rl_none">here</a>. </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the search flow of hubs discovery ?</div></td></tr><tr><td><ul><li><div>First step in search-engine when processing a search request is to apply search strategies to calculate the provider searches to be launched.</div></li><li><div>When applying SmartHub strategy (VIN strategy), the search-engine sends a request to hubs-discovery to get the best hubs to use for this search.</div></li><li><div>The hubs-discovery module answers with the best hubs for this search.</div></li><li><div>The search-engine module uses those hubs to calculate the provider searches of the SmartHub strategy.</div></li><li><div>Once all the provider searches are calculated, they are sent to the itinerary-gateway module (responsible for provider searches).</div></li><li><div>The itinerary-gateway module will answer with the provider search results.</div></li><li><div>The search-engine module will use the provider search results associated to each provider search to build the itineraries (product building step).</div></li><li><div>Once the itineraries are built, pricing and post process steps are applied before returning the results to the client.</div></li></ul><div style="text-align:start;"><br/></div><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">IMPORTANT</span></b><span style="color: rgb(51, 51, 51);">: note that hubs-discovery is only suggesting hubs! Hubs-discovery is not building the results that will be offered to the user; it is suggesting hubs that will be used to calculate the provider searches. Those provider searches will give provider results that will be combined, and the built itineraries will be offered to the user. </span></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);"><span style="--en-markholder:true;"><br/></span></span></div><img src="https://jira.odigeo.com/wiki/download/attachments/228950052/image2019-8-1_13-13-38.png?version=1&amp;modificationDate=1564658020000&amp;api=v2"></img><div><span style="color: rgb(51, 51, 51);"><span style="--en-markholder:true;"><br/></span></span></div></td></tr></tbody></table><h1 style="text-align:start;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how does work the cache in hubs discovery ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">The hubs-discovery module use a multi-level cache to avoid overloading Neo4j database with queries to find the best hubs. These cache levels are:</span></div><div><br/></div><ul><li><div>Exact match: try to match the exact request of the user composed by origin-destination-departureDate</div></li><li><div>Day of week: gets the day of week associated to the departureDate, and tries to match the triple origin-destination-dayOfWeek.</div></li></ul></td></tr></tbody></table><h1 style="text-align:start;"></h1></span>
</div></body></html> 