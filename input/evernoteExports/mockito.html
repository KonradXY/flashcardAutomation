<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (it-IT, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="388"/>

<div>
<span><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;">What are the characteristics of an unit test ?</span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">A unit test should exhibit the following characteristics:</span></span></div><ul><li><div><span style="font-size: 14px;">It should be automated,</span></div></li><li><div><span style="font-size: 14px;">It should have a fast test execution. To be precise, a test should not take more than a few milliseconds to finish execution</span></div></li><li><div><span style="font-size: 14px;">A test should not depend on the result of another test or rather test execution order.</span></div></li><li><div><span style="font-size: 14px;">A test should not depend on database access, file access, or any long running task. Rather, an appropriate test double should isolate the external dependencies.</span></div></li><li><div><span style="font-size: 14px;">A test result should be consistent and time-and-location transparent.</span></div></li><li><div><span style="font-size: 14px;">Tests should be meaningful. It means that should test functionality of the software.</span></div></li><li><div><span style="font-size: 14px;">Tests are system documentation. Tests should be readable and expressive; for example, a test that verifies the unauthorized access could be written as </span><span style="font-size: 14px; color: blue;">testUnauthorizedAccess()</span><span style="font-size: 14px;"> or rather </span><span style="font-size: 14px; color: blue;">when_an_unauthorized_user_accesses_the_system_then_raises_secuirty_error()</span><span style="font-size: 14px;">. The latter is more readable and expresses the intent of the test.</span></div></li><li><div><span style="font-size: 14px; font-style: italic;">Tests should be short</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; font-style: italic;">tests should not be treated as second-class citizens</span><span style="font-size: 14px;">. Code is refactored to improve the quality; similarly, unit tests should be refactored to improve the quality. A test class of 300 lines is not maintainable; we can rather create new test classes, move the tests to the new classes, and create a maintainable suite.</span></div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>What are test doubles ? Can you list them ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Test doubles act as stunt doubles. They are a skilled replacement of the collaborator objects and allow you to unit test code in isolation from the original collaborator.</span></span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; font-style: italic; color: rgb(51, 51, 51);">Gerard Meszaros</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> coined the term </span></span><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: rgb(51, 51, 51);">test doubles</span></span><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);"> in his book </span><span style="font-size: 14px; font-style: italic; color: rgb(51, 51, 51);">xUNIT TEST PATTERNS</span><span style="font-size: 14px; color: rgb(51, 51, 51);">, </span><span style="font-size: 14px; font-style: italic; color: rgb(51, 51, 51);">Addison-Wesley</span><span style="font-size: 14px; color: rgb(51, 51, 51);">—this book explores the various test doubles and sets the foundation for Mockito. Test doubles can be created to impersonate collaborators and can be categorized into the types, as shown in the following diagram:</span></span></div><div><br/></div><div><img src="mockito_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" alt="Understanding test doubles" width="386"/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is a stub ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">A </span></span><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: rgb(51, 51, 51);">stub</span></span><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);"> delivers indirect inputs to the caller when the stub's methods are called. Stubs are programmed only for the test scope. Stubs may record other information such as how many times they are invoked and so on.</span></span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Stubs are very handy to impersonate error conditions and external dependencies (you can achieve the same thing with a mock; this is just one approach). Suppose you need to test a code that looks up a JNDI resource and asks the resource to return some value. You cannot look up a JNDI resource from a JUnit test; you can stub the JNDI lookup code and return a stubbed object that will give you a hardcoded value.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is a spy ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);"> As the name suggests, a spy object spies on a real object. A spy is a variation of a stub, but instead of only setting the expectation, a spy records the method calls made to the collaborator. A spy can act as an indirect output of the unit under test and can also act as an audit log.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is a mock ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">A mock object is a combination of a spy and a stub. It acts as an indirect output for a code under test, such as a spy, and can also stub methods to return values or throw exceptions, like a stub. A mock object fails a test if an expected method is not invoked or if the parameters of the method don't match.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is a fake object ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">A fake object is a test double with real logic (unlike stubs) and is much more simplified or cheaper in some way. We do not mock or stub a unit that we test; rather, the external dependencies of the unit are mocked or stubbed so that the output of the dependent objects can be controlled or observed from the tests. The fake object replaces the functionality of the real code that we want to test. Fakes are also dependencies, and don't mock via subclassing (which is generally always a bad idea; use composition instead). Fakes aren't just stubbed return values; they use some real logic.</span></span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following are the reasons behind using a fake object:</span></span></div><ul><li><div><span style="font-size: 14px;">The real object cannot be instantiated, such as when the constructor reads a file, performs a JNDI lookup, and so on.</span></div></li><li><div><span style="font-size: 14px;">The real object has slow methods; for example, a class might have a </span><span style="font-size: 14px; color: blue;">calculate ()</span><span style="font-size: 14px;"> method that needs to be unit tested, but the </span><span style="font-size: 14px; color: blue;">calculate()</span><span style="font-size: 14px;"> method calls a </span><span style="font-size: 14px; color: blue;">load ()</span><span style="font-size: 14px;">method to retrieve data from the database. The </span><span style="font-size: 14px; color: blue;">load()</span><span style="font-size: 14px;"> method needs a real database, and it takes time to retrieve data, so we need to bypass the </span><span style="font-size: 14px; color: blue;">load()</span><span style="font-size: 14px;"> method to unit test the </span><span style="font-size: 14px; color: blue;">calculate</span><span style="font-size: 14px;"> behavior.</span></div></li></ul><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Fake objects are working implementations. Mostly, the fake class extends the original class, but it usually performs hacking, which makes it unsuitable for production.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how you create a mock object with mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">A mock object can be created with the help of a static method </span><span style="font-size: 14px; color: blue;">mock()</span><span style="font-size: 14px; color: rgb(51, 51, 51);">. You need to invoke the </span><span style="font-size: 14px; color: blue;">Mockito.mock()</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> method or static import Mockito's </span><span style="font-size: 14px; color: blue;">mock()</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> method.</span></span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">There's another way of mocking objects — using the </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> annotation. But to work with the </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> annotation, it is necessary to call </span><span style="font-size: 14px; color: blue;">MockitoAnnotations.initMocks(this)</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> before using the mocks; or use </span><span style="font-size: 14px; color: blue;">MockitoJUnitRunner</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> as a JUnit runner.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>What object mockito cannot mock/spy ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito cannot mock/spy the following things:</span></span></div><ul><li><div><span style="font-size: 14px;">Final classes</span></div></li><li><div><span style="font-size: 14px;">Final methods</span></div></li><li><div><span style="font-size: 14px;">Enums</span></div></li><li><div><span style="font-size: 14px;">Static methods</span></div></li><li><div><span style="font-size: 14px;">Private methods</span></div></li><li><div><span style="font-size: 14px;">The </span><span style="font-size: 14px; color: blue;">hashCode()</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">equals()</span><span style="font-size: 14px;"> method</span></div></li><li><div><span style="font-size: 14px;">Anonymous classes</span></div></li><li><div><span style="font-size: 14px;">Primitive types</span></div></li></ul><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">PowerMock has the capability to mock these constructs.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;">what does represent the method when in mockito ?</span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The Mockito framework supports stubbing and allows us to return a given value when a specific method is called. It can be done using </span><span style="font-size: 14px; color: blue;">Mockito.when()</span><span style="font-size: 14px;"> along with </span><span style="font-size: 14px; color: blue;">thenReturn()</span><span style="font-size: 14px;">.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following test code stubs the </span><span style="font-size: 14px; color: blue;">retrieve</span><span style="font-size: 14px;"> method for </span><span style="font-size: 14px; color: blue;">CountryDao</span><span style="font-size: 14px;"> and returns an empty list. Finally, the stubbing is verified using the </span><span style="font-size: 14px; color: blue;">assertTrue</span><span style="font-size: 14px;"> method:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void retrieves_empty_country_list() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  List&lt;Country&gt; list = new ArrayList&lt;Country&gt;();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  list.add(new Country());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(countryDao.retrieve(isA(RetrieveCountryRequest.class))).thenReturn(emptyList);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertTrue(countryDao.retrieve(new RetrieveCountryRequest()).size() == 1);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">when()</span><span style="font-size: 14px;"> method represents the trigger—when to stub it. The following methods are used to represent a </span><span style="font-size: 14px; font-style: italic;">trigger action</span><span style="font-size: 14px;"> or </span><span style="font-size: 14px; font-style: italic;">what to do</span><span style="font-size: 14px;"> when the trigger is triggered.</span></div><ul><li><div><span style="font-size: 14px;">thenReturn (a value to be returned): This method returns a given value.</span></div></li><li><div><span style="font-size: 14px;">thenThrow (a throwable to be thrown): This method throws a given exception.</span></div></li><li><div><span style="font-size: 14px;">thenAnswer (</span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> answer): In this method, unlike returning a hardcoded value, a dynamic, user-defined logic is executed; more like </span><span style="font-size: 14px; font-style: italic;">fake</span><span style="font-size: 14px;"> test doubles. </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> is an interface. Dynamic code logic is needed to implement the </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> interface.</span></div></li><li><div><span style="font-size: 14px;">thenCallRealMethod(): This method calls the real method on the mock object/spy.</span></div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what does represent the method thenReturn in mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">thenReturn()</span> method has a variant; it can either return a hardcoded value or can accept variable arguments of hardcoded values. What follows are the three ensuing variants:</span></div><div><br/></div><ul><li><div><span style="font-size: 14px;">thenReturn(value)</span></div></li><li><div><span style="font-size: 14px;">thenReturn(value, values...)</span></div></li><li><div><span style="font-size: 14px;">thenReturn(value).thenReturn(value2).thenReturn(value3)</span></div></li></ul><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">thenReturn(value)</span><span style="font-size: 14px;"> variant returns the same hardcoded value for each method call, whereas </span><span style="font-size: 14px; color: blue;">when(mock.someMethod()).thenReturn(10,5,100)</span><span style="font-size: 14px;"> returns the following values:</span></div><div><br/></div><ul><li><div><span style="font-size: 14px;">During the first invocation, </span><span style="font-size: 14px; color: blue;">mock.someMethod()</span><span style="font-size: 14px;"> returns </span><span style="font-size: 14px; color: blue;">10</span></div></li><li><div><span style="font-size: 14px;">During the second invocation, </span><span style="font-size: 14px; color: blue;">mock.someMethod()</span><span style="font-size: 14px;"> returns </span><span style="font-size: 14px; color: blue;">5</span></div></li><li><div><span style="font-size: 14px;">During the third invocation, </span><span style="font-size: 14px; color: blue;">mock.someMethod()</span><span style="font-size: 14px;"> returns </span><span style="font-size: 14px; color: blue;">100</span></div></li><li><div><span style="font-size: 14px;">During all the other invocations, </span><span style="font-size: 14px; color: blue;">mock.someMethod()</span><span style="font-size: 14px;"> returns </span><span style="font-size: 14px; color: blue;">100</span></div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you describe each step of this code snippet ?</div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void retrieves_empty_country_list() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(request.getParameter(anyString())).thenReturn(&quot;1&quot;, &quot;10&quot;,SortOrder.ASC.name(), SortColumn.iso.name());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  List&lt;Country&gt; countryList = new ArrayList&lt;Country&gt;();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  countryList.add(new Country());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(countryDao.retrieve(isA(RetrieveCountryRequest.class))).thenReturn(countryList);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  JsonDataWrapper&lt;Country&gt; response = ajaxController.retrieve(request);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(1, response.getPage());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(1, response.getTotal());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(1, response.getRows().size());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">RequestBuilder</span><span style="font-size: 14px;"> class calls the </span><span style="font-size: 14px; color: blue;">getParameter()</span><span style="font-size: 14px;"> method of </span><span style="font-size: 14px; color: blue;">HttpServletRequest</span><span style="font-size: 14px;"> to fetch the request parameters. Sequentially, it calls </span><span style="font-size: 14px; color: blue;">webReq.getParameter(&quot;page&quot;)</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">webReq.getParameter(&quot;rp&quot;)</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">webReq.getParameter(&quot;sortorder&quot;)</span><span style="font-size: 14px;">, and </span><span style="font-size: 14px; color: blue;">webReq.getParameter(&quot;sortname&quot;)</span><span style="font-size: 14px;">.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">In the test method, we stubbed the </span><span style="font-size: 14px; color: blue;">getParameter</span><span style="font-size: 14px;"> call with a variable argument </span><span style="font-size: 14px; color: blue;">thenReturn</span><span style="font-size: 14px;"> style.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">We used two Mockito matchers, namely, </span><span style="font-size: 14px; color: blue;">anyString</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">isA</span><span style="font-size: 14px;">. The </span><span style="font-size: 14px; color: blue;">anyString()</span><span style="font-size: 14px;"> matcher is used to stub the </span><span style="font-size: 14px; color: blue;">getParameter</span><span style="font-size: 14px;"> method. The </span><span style="font-size: 14px; color: blue;">getParameter</span><span style="font-size: 14px;"> method accepts a string argument, such as </span><span style="font-size: 14px; color: blue;">webReq.getParameter(&quot;page&quot;)</span><span style="font-size: 14px;">. The </span><span style="font-size: 14px; color: blue;">anyString</span><span style="font-size: 14px;"> matcher is used as a generic argument matcher. This means, no matter what value is passed to the </span><span style="font-size: 14px; color: blue;">getParameter</span><span style="font-size: 14px;"> method, it will return a hardcoded value.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">isA</span><span style="font-size: 14px;"> matcher is used to stub the </span><span style="font-size: 14px; color: blue;">retrieve</span><span style="font-size: 14px;"> method of </span><span style="font-size: 14px; color: blue;">CountryDao</span><span style="font-size: 14px;"> to get the following:</span></div><ul><li><div><span style="font-size: 14px;">If the retrieve method is called with a </span><span style="font-size: 14px; color: blue;">RetrieveCountryRequest</span><span style="font-size: 14px;"> object, it will return the country list</span></div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">How do we test exceptional conditions such as database access failure?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">For this, Mockito provides a </span><span style="font-size: 14px; color: blue;">thenThrow(Throwable)</span><span style="font-size: 14px;">method. This method tells the Mockito framework to throw a throwable (could be exception or error) when the stubbed method is invoked.</span> <span style="font-size: 14px; color: rgb(51, 51, 51);">JUnit 4.0 provides a way to test exceptions using </span><span style="font-size: 14px; color: blue;">@Test(expected=&lt;exception&gt;)</span><span style="font-size: 14px;">.</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">We'll stub the </span><span style="font-size: 14px; color: blue;">countryDao</span><span style="font-size: 14px;"> access call to throw an exception and assert the exception using </span><span style="font-size: 14px; color: blue;">@Test(execpted=)</span><span style="font-size: 14px;">. If the test doesn't throw any exception, it will fail:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test(expected=RuntimeException.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_system_throws_exception() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(request.getParameter(anyString())).thenReturn(&quot;1&quot;, &quot;10&quot;, SortOrder.DESC.name(), SortColumn.iso.name());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(countryDao.retrieve(isA(RetrieveCountryRequest.class))).    thenThrow(new RuntimeException(&quot;Database failure&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  JsonDataWrapper&lt;Country&gt; response = ajaxController.retrieve(request)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To throw an exception from a </span><span style="font-size: 14px; color: blue;">void</span> method, use the following code syntax:</span> <span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">doThrow(exception).when(mock).voidmethod(arguments);</span></div><div style="margin-bottom:20px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Checking and throwing </span><span style="font-size: 14px; color: blue;">RuntimeException</span><span style="font-size: 14px;"> is not recommended. Instead, we can use a specific exception in production code. In JUint 4, there exists an </span><span style="font-size: 14px; color: blue;">ExpectedException</span><span style="font-size: 14px;"> rule API for exception handling.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you describe what is an argument matcher in mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The argument matcher plays a key role in mocking. Mock objects return expected values, but when they need to return different values for different arguments, the argument matcher comes into play.</span></span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Suppose we have a method that takes a cricket player's name as an input and returns the number of runs as an output. We want to stub it and return </span><span style="font-size: 14px; color: blue;">100</span><span style="font-size: 14px;"> for the player </span><span style="font-size: 14px; color: blue;">Sachin</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">10</span><span style="font-size: 14px;"> for </span><span style="font-size: 14px; color: blue;">xyz</span><span style="font-size: 14px;">. We have to use the argument matcher to stub this.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito returns expected values when a method is stubbed. If the method takes arguments, the argument must match during the execution. For example, the </span><span style="font-size: 14px; color: blue;">getValue(int someValue)</span> method is stubbed in the following way:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">when(mockObject.getValue(1)).thenReturn(expected value);</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Here, the </span><span style="font-size: 14px; color: blue;">getValue</span><span style="font-size: 14px;"> method is called with </span><span style="font-size: 14px; color: blue;">mockObject.getValue(100)</span><span style="font-size: 14px;">. The parameter doesn't match (it is expected that the method will be called with </span><span style="font-size: 14px; color: blue;">1</span><span style="font-size: 14px;">, but at runtime it encounters </span><span style="font-size: 14px; color: blue;">100</span><span style="font-size: 14px;">), so the mock object fails to return the expected value. It will return the default value of the return type. If the return type is </span><span style="font-size: 14px; color: blue;">int</span><span style="font-size: 14px;"> or </span><span style="font-size: 14px; color: blue;">short</span><span style="font-size: 14px;"> or </span><span style="font-size: 14px; color: blue;">long</span><span style="font-size: 14px;">, it returns </span><span style="font-size: 14px; color: blue;">0</span><span style="font-size: 14px;"> for wrapper types such as integer and long. If it returns </span><span style="font-size: 14px; color: blue;">NULL</span><span style="font-size: 14px;"> for Boolean, it'll return </span><span style="font-size: 14px; color: blue;">false</span><span style="font-size: 14px;"> if the object is null and so on.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito verifies argument values in natural Java style by using an object's </span><span style="font-size: 14px; color: blue;">equals()</span><span style="font-size: 14px;"> method. Sometimes, we use argument matchers when extra flexibility is required. Mockito provides built-in matchers, such as </span><span style="font-size: 14px; color: blue;">anyInt()</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">anyDouble()</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">anyString()</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">anyList()</span><span style="font-size: 14px;">, and </span><span style="font-size: 14px; color: blue;">anyCollection()</span><span style="font-size: 14px;">. More built-in matchers and examples of custom argument matchers / </span><span style="font-size: 14px; font-weight: bold;">hamcrest</span><span style="font-size: 14px;"> matchers can be found at the following link:</span></div><div><br/></div><div><span style="font-size: 14px;"><a href="https://github.com/mockito/mockito/blob/master/src/org/mockito/Matchers.java" style="font-size: 14px; color: rgb(7, 7, 7);">https://github.com/mockito/mockito/blob/master/src/org/mockito/Matchers.java</a></span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">NOTE</span></span></div><div><span style="font-size: 14px;">Examples of other matchers are </span><span style="font-size: 14px; color: blue;">isA(java.lang.Class&lt;T&gt; clazz)</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">any(java.lang.Class&lt;T&gt; clazz)</span><span style="font-size: 14px;">, and </span><span style="font-size: 14px; color: blue;">eq(T)</span><span style="font-size: 14px;"> or </span><span style="font-size: 14px; color: blue;">eq(primitive value)</span><span style="font-size: 14px;">.</span></div><div style="margin-bottom:20px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">isA</span><span style="font-size: 14px;"> matcher checks whether the passed object is an instance of the class type passed in the </span><span style="font-size: 14px; color: blue;">isA</span><span style="font-size: 14px;"> argument. The </span><span style="font-size: 14px; color: blue;">any(T)</span><span style="font-size: 14px;"> matcher also works in the same way.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what are the constraints when using arguments matchers ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">While using argument matchers, all arguments have to be provided by matchers.</span></span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">We're passing three arguments, and all of them are passed using matchers in the following manner:</span></span></div><div><span style="font-size: 14px;"> </span> <span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">verify(mock).someMethod(anyInt(), anyString(), eq(&quot;third argument&quot;));</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following example will fail because the first and the third argument are not passed using a matcher:</span></span></div><div><span style="font-size: 14px;"> </span> <span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">verify(mock).someMethod(1, anyString(), &quot;third argument&quot;);</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;">Can you describe each line of this code snippet ?</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void verify_multiple_values() throws Exception {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  double marks = 100.00;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertThat(marks, either(is(100.00)).or(is(90.9)));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertThat(marks, both(not(99.99)).and(not(60.00)));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertThat(marks, anyOf(is(100.00),is(1.00),is(55.00),is(88.00),is(67.8)));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertThat(marks, not(anyOf(is(0.00),is(200.00))));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertThat(marks, not(allOf(is(1.00),is(100.00), is(30.00))));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">In the preceding example, a double variable mark is initialized with the value </span><span style="font-size: 14px; color: blue;">100.00</span><span style="font-size: 14px;">. This variable value is asserted with an </span><span style="font-size: 14px; color: blue;">either</span><span style="font-size: 14px;"> matcher.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Basically, using </span><span style="font-size: 14px; color: blue;">either</span><span style="font-size: 14px;">, we can compare two values against an actual/calculated value. If any of them match, the assertion is passed. If none of them match, </span><span style="font-size: 14px; color: blue;">AssertionError</span><span style="font-size: 14px;"> is thrown.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">either(Matcher)</span><span style="font-size: 14px;"> takes a matcher and returns a </span><span style="font-size: 14px; color: blue;">CombinableEitherMatcher</span><span style="font-size: 14px;"> class. The </span><span style="font-size: 14px; color: blue;">CombinableEitherMatcher</span><span style="font-size: 14px;"> class has an </span><span style="font-size: 14px; color: blue;">or(Matcher other)</span><span style="font-size: 14px;"> method so that </span><span style="font-size: 14px; color: blue;">either</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">or</span><span style="font-size: 14px;"> can be combined:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">or(Matcher other)</span> <span style="font-size: 14px;">is translated as</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">return (new CombinableMatcher(first)).or(other); -</span><span style="font-size: 14px;">&gt; finally to</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">new CombinableMatcher(new AnyOf(templatedListWith(other)));</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Using </span><span style="font-size: 14px; color: blue;">both</span><span style="font-size: 14px;">, we can compare two values against an actual/calculated value. If neither of them match, the assertion error is thrown. If both of them match, the assertion is passed.</span> <span style="font-size: 14px; color: rgb(51, 51, 51);">A numeric value, like math score, cannot be equal to both 60 and 80. But we can negate the expression. If the math score is 80, using the </span><span style="font-size: 14px; color: blue;">both</span><span style="font-size: 14px;"> matcher, we can write the expression as </span><span style="font-size: 14px; color: blue;">assertThat (mathScore , both (not(60)). and(not (90)))</span><span style="font-size: 14px;">.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">anyOf</span><span style="font-size: 14px;"> matcher is more like </span><span style="font-size: 14px; color: blue;">either</span><span style="font-size: 14px;"> with multiple values. Using </span><span style="font-size: 14px; color: blue;">anyOf</span><span style="font-size: 14px;">, we can compare multiple values against an actual/calculated value. If any of them match, the assertion is passed. If none of them match, the </span><span style="font-size: 14px; color: blue;">assertionError</span><span style="font-size: 14px;"> is thrown.</span></div><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">allOf</span><span style="font-size: 14px;"> matcher is more like </span><span style="font-size: 14px; color: blue;">both</span><span style="font-size: 14px;"> with multiple values. Using </span><span style="font-size: 14px; color: blue;">allOf</span><span style="font-size: 14px;">, we can compare multiple values against an actual/calculated value. If none of them match, the </span><span style="font-size: 14px; color: blue;">assertionError</span><span style="font-size: 14px;"> is thrown. Just like </span><span style="font-size: 14px; color: blue;">both</span><span style="font-size: 14px;">, we can use </span><span style="font-size: 14px; color: blue;">allOf</span><span style="font-size: 14px;">, along with </span><span style="font-size: 14px; color: blue;">not</span><span style="font-size: 14px;">, to check that a value doesn't belong to a set.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how could you test an invocation of a method, especially if it is called redundantly ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To verify a redundant method invocation or if a stubbed method was not called but was important from the test perspective, we should manually verify the invocation. We need to use the static </span><span style="font-size: 14px; color: blue;">verify</span> method.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Mock objects are used to stub external dependencies. We set an expectation and a mock object returns an expected value. In some conditions, a behavior/method of a mock object should not be invoked, or sometimes we may need to call the method </span><span style="font-size: 14px; font-style: italic; color: rgb(51, 51, 51);">N</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> (a number) times. The </span><span style="font-size: 14px; color: blue;">verify</span> method verifies the invocation of mock objects. Mockito does not automatically verify all stubbed calls; JMock does this automatically.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">If a stubbed behavior should not be called, but is called due to bug in a code, the </span><span style="font-size: 14px; color: blue;">verify</span><span style="font-size: 14px;"> method flags the error (but we have to verify that manually). The </span><span style="font-size: 14px; color: blue;">void</span><span style="font-size: 14px;"> methods don't return a value; </span><span style="font-size: 14px; color: blue;">verify</span><span style="font-size: 14px;"> is very handy to test a </span><span style="font-size: 14px; color: blue;">void</span><span style="font-size: 14px;"> method's behavior (explained later).</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">verify()</span><span style="font-size: 14px;"> method has an overloaded version, which takes </span><span style="font-size: 14px; color: blue;">VerificationMode</span><span style="font-size: 14px;"> (</span><span style="font-size: 14px; color: blue;">AtLeast</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">AtMost</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">Times</span><span style="font-size: 14px;">, and so on) as an argument. The </span><span style="font-size: 14px; color: blue;">Times</span><span style="font-size: 14px;"> mode is a Mockito framework class of package, </span><span style="font-size: 14px; color: blue;">org.mockito.internal.verification</span><span style="font-size: 14px;">, and it takes the integer argument, </span><span style="font-size: 14px; color: blue;">wantedNumberOfInvocations</span><span style="font-size: 14px;">.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">If </span><span style="font-size: 14px; color: blue;">0</span><span style="font-size: 14px;"> is passed to </span><span style="font-size: 14px; color: blue;">Times</span><span style="font-size: 14px;">, it infers that the method will not be invoked in the testing path. We can pass </span><span style="font-size: 14px; color: blue;">0</span><span style="font-size: 14px;"> to </span><span style="font-size: 14px; color: blue;">Times(0)</span><span style="font-size: 14px;"> to make sure that the </span><span style="font-size: 14px; color: blue;">sell</span><span style="font-size: 14px;"> or </span><span style="font-size: 14px; color: blue;">buy</span><span style="font-size: 14px;"> methods are not invoked. If a negative number is passed to the </span><span style="font-size: 14px; color: blue;">Times</span><span style="font-size: 14px;"> constructor, Mockito throws </span><span style="font-size: 14px; color: blue;">MockitoException - org.mockito.exceptions.base.MockitoException</span><span style="font-size: 14px;"> and shows the </span><span style="font-size: 14px; font-weight: bold;">Negative value is not allowed here</span><span style="font-size: 14px;"> error. The following methods are used in conjunction with </span><span style="font-size: 14px; color: blue;">verify</span><span style="font-size: 14px;">:</span></div><div><br/></div><ul><li><div><span style="font-size: 14px;">times(int wantedNumberOfInvocations): This is invoked exactly </span><span style="font-size: 14px; font-style: italic;">N</span><span style="font-size: 14px;"> times. If the method is not invoked </span><span style="font-size: 14px; color: blue;">wantedNumberOfInvocations</span><span style="font-size: 14px;"> times, the test fails.</span></div></li><li><div><span style="font-size: 14px;">never(): This is never called or is called as </span><span style="font-size: 14px; color: blue;">times(0)</span><span style="font-size: 14px;">.</span></div></li><li><div><span style="font-size: 14px;">atLeastOnce(): This is invoked at least once. It works fine if the method is invoked multiple times, but fails if the method is not invoked.</span></div></li><li><div><span style="font-size: 14px;">atLeast(int minNumberOfInvocations): This is called at least </span><span style="font-size: 14px; font-style: italic;">N</span><span style="font-size: 14px;"> times. It works fine if the method is invoked more than </span><span style="font-size: 14px; color: blue;">minNumberOfInvocations</span><span style="font-size: 14px;"> times, but fails if the method is not called </span><span style="font-size: 14px; color: blue;">minNumberOfInvocations</span><span style="font-size: 14px;"> times.</span></div></li><li><div><span style="font-size: 14px;">atMost(int maxNumberOfInvocations): This is called at the most </span><span style="font-size: 14px; font-style: italic;">N</span><span style="font-size: 14px;"> times. It fails if the method is called more than </span><span style="font-size: 14px; color: blue;">minNumberOfInvocations</span><span style="font-size: 14px;"> times.</span></div></li><li><div><span style="font-size: 14px;">only(): This is used to verify that only one method is called on a mock. It fails if any other method is called on the mock object. In our example, if we use </span><span style="font-size: 14px; color: blue;">verify(request, only()).getParameter(anyString());</span><span style="font-size: 14px;">, the test will fail with the following output:</span></div></li><li><div><span style="font-size: 14px;">timeout(int millis): This is specified in a time range.</span></div></li></ul><div><br/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is the verifyZeroInteractions method in mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">verifyZeroInteractions (object, mocks)</span><span style="font-size: 14px;"> method verifies that no interactions happened on the given mocks. The following test code directly calls the </span><span style="font-size: 14px; color: blue;">verifyZeroInteractions</span><span style="font-size: 14px;"> and passes the two mock objects. Since no methods are invoked on the mock objects, the test passes.</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test public void verify_zero_interaction() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  verifyZeroInteractions(request,countryDao);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">This is useful if your code depends on two or more collaborators. For a given input, only one collaborator should handle the request while others should just ignore the request.</span></span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">verifyNoMoreInteractions (Object, mocks)</span> method checks if any of the given mocks have any unverified interaction. We can use this method after verifying a mock method to make sure that nothing else was invoked on the mock.</span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">This is generally not a good practice as it makes your tests overly brittle and you end up testing more than just what you care about. The following test code demonstrates the </span><span style="font-size: 14px; color: blue;">verifyNoMoreInteractions</span> method:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test public void verify_nomore_interaction() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  request.getParameter(&quot;page&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  request.getContextPath();</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  verify(request).getParameter(anyString());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //this will fail getContextPath() is not verified</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  verifyNoMoreInteractions(request);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how can you stub a method in order to return a dynamic value ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Stubbed methods return a hardcoded value but cannot return a dynamic on-the-fly result. Mockito framework offers callbacks to compute on-the-fly results.</span></span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito allows stubbing with the generic </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> interface; this is a callback. When a stubbed method on a mock object is invoked, the </span><span style="font-size: 14px; color: blue;">answer(InvocationOnMock invocation)</span><span style="font-size: 14px;"> method of the </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> object is called. This </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> object's </span><span style="font-size: 14px; color: blue;">answer()</span><span style="font-size: 14px;"> method returns the actual object. The syntax is similar to </span><span style="font-size: 14px; color: blue;">thenReturn()</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">thenThrow()</span><span style="font-size: 14px;">:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(mock.someMethod()).thenAnswer(new Answer() {…});</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Alternatively, we can also use the following syntax:</span></span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(mock.someMethod()).then(answer);</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">Answer</span> interface is defined as follows:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public interface Answer&lt;T&gt; {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    T answer(InvocationOnMock invocation) throws Throwable;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">InvocationOnMock</span><span style="font-size: 14px;"> argument is an important part of a callback. It gives you the arguments passed to the method and the mock object as well. The following methods of </span><span style="font-size: 14px; color: blue;">InvocationOnMock</span><span style="font-size: 14px;"> are used to get the arguments and the mock object:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">Object[] args = invocation.getArguments();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">Object mock = invocation.getMock();</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">retrieve</span><span style="font-size: 14px;"> method of </span><span style="font-size: 14px; color: blue;">CountryDao</span><span style="font-size: 14px;"> is stubbed. We'll create an </span><span style="font-size: 14px; color: blue;">answer</span><span style="font-size: 14px;"> object to dynamically sort the country list based on the input sort order.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you give an implementation of the Answer class ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">In test class, create a list for storing countries, and in the </span><span style="font-size: 14px; color: blue;">setUp</span> method, populate the list with countries. The following is the changed test code:</span></div><div><br/></div><div><span style="font-size: 14px;"> </span> <span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Before</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void setUp() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    ajaxController = new AjaxController(countryDao);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    countries = new ArrayList&lt;Country&gt;();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    countries.add(create(&quot;Argentina&quot;, &quot;AR&quot;, &quot;32&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    countries.add(create(&quot;USA&quot;, &quot;US&quot;, &quot;01&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    countries.add(create(&quot;Brazil&quot;, &quot;BR&quot;, &quot;05&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    countries.add(create(&quot;India&quot;, &quot;IN&quot;, &quot;91&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Write a new </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> class to sort the countries list based on the user input. The following example is the custom </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> class:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">class SortAnswer implements Answer&lt;Object&gt; {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Override</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public Object answer(InvocationOnMock invocation) throws Throwable {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    RetrieveCountryRequest request = (RetrieveCountryRequest) invocation.getArguments()[0];</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    final int order = request.getSortOrder().equals(SortOrder.ASC) ? 1: -1;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    final SortColumn col = request.getSortname();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    Collections.sort(countries, new Comparator&lt;Country&gt;() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">      public int compare(Country arg0, Country arg1) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        if (SortColumn.countryCode.equals(col))</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        return order * arg0.getCountryCode().compareTo(arg1.getCountryCode());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        if (SortColumn.iso.equals(col))</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        return order * arg0.getIso().compareTo(arg1.getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        return order * arg0.getName().compareTo(arg1.getName());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">      }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    });</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    return countries;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">answer</span><span style="font-size: 14px;"> method gets the request object and sorts the countries list based on the </span><span style="font-size: 14px; color: blue;">SortOrder</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">SortColumn</span><span style="font-size: 14px;"> attributes. The following test verifies the ascending and descending sorting:</span></div><div><br/></div><div><span style="font-size: 14px;"> </span><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void sorting_asc_on_iso() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    when(request.getParameter(anyString())).thenReturn(&quot;1&quot;, &quot;10&quot;, SortOrder.ASC.name(),   SortColumn.iso.name());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    when(countryDao.retrieve(isA(RetrieveCountryRequest.class))).thenAnswer(new SortAnswer());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    JsonDataWrapper&lt;Country&gt; response = ajaxController.retrieve(request);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;AR&quot;, response.getRows().get(0).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;BR&quot;, response.getRows().get(1).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;IN&quot;, response.getRows().get(2).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;US&quot;, response.getRows().get(3).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void sorting_desc_on_iso() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    when(request.getParameter(anyString())).thenReturn(&quot;1&quot;,       &quot;10&quot;,SortOrder.DESC.name(), SortColumn.iso.name());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    when(countryDao.retrieve(isA(RetrieveCountryRequest.class))).thenAnswer(new SortAnswer());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    JsonDataWrapper&lt;Country&gt; response = ajaxController.retrieve(request);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;AR&quot;, response.getRows().get(3).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;BR&quot;, response.getRows().get(2).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;IN&quot;, response.getRows().get(1).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertEquals(&quot;US&quot;, response.getRows().get(0).getIso());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is the design and architecture behind mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito applies the proxy design pattern to create mock objects. For concrete classes, Mockito internally uses CGLib to create proxy stubs. CGLib is used to generate dynamic proxy objects and intercept field access. The following URL talks about CGLib:</span></span></div><div><br/></div><div><span style="font-size: 14px;"><a href="https://github.com/cglib/cglib" style="font-size: 14px; color: rgb(7, 7, 7);">https://github.com/cglib/cglib</a></span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following sequence diagram depicts the call sequence. The </span><span style="font-size: 14px; color: blue;">ClassImposterizer</span><span style="font-size: 14px;"> class is a singleton class. This class has a </span><span style="font-size: 14px; color: blue;">createProxyClass</span><span style="font-size: 14px;"> method for generating a source using CGLib. Finally, it uses reflection to create an instance of the proxy class. Method calls are stubbed using the callback API of </span><span style="font-size: 14px; color: blue;">MethodInterceptor</span><span style="font-size: 14px;">.</span></div><div><br/></div><div><img src="mockito_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg" alt="Understanding the Mockito architecture" width="700"/></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">MethodInterceptor</span><span style="font-size: 14px;"> class acts as a Java reflection class, </span><span style="font-size: 14px; color: blue;">java.lang.reflect.InvocationHandler</span><span style="font-size: 14px;">. Any method call on a mock object (proxy) is handled by a </span><span style="font-size: 14px; color: blue;">MethodInterceptor</span><span style="font-size: 14px;"> instance.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">We'll create a custom mocking framework to handle external dependencies. We'll use the Java reflection framework's dynamic proxy object-creation API. The </span><span style="font-size: 14px; color: blue;">java.lang.reflect.Proxy</span><span style="font-size: 14px;"> method provides a </span><span style="font-size: 14px; color: blue;">Proxy.newProxyInstance(ClassLoader, Class, InvocationHandler)</span><span style="font-size: 14px;"> API to create dynamic proxy objects. The </span><span style="font-size: 14px; color: blue;">InvocationHandler</span><span style="font-size: 14px;"> interface has the following signature:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public interface InvocationHandler {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public abstract Object invoke(Object obj, Method method, Object aobj[])  throws Throwable;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">All method calls to a proxy object are redirected to the </span><span style="font-size: 14px; color: blue;">invoke</span> method.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what's the job of the methods doCallRealMethod and doNothing ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">doNothing()</span><span style="font-size: 14px;"> method does nothing. By default, when we create a mock object and call a </span><span style="font-size: 14px; color: blue;">void</span><span style="font-size: 14px;"> method on that mock object, the </span><span style="font-size: 14px; color: blue;">void</span><span style="font-size: 14px;"> method does not do anything, or rather, it is stubbed by default, but still, we stub void methods using </span><span style="font-size: 14px; color: blue;">doNothing()</span><span style="font-size: 14px;"> for void method chaining. If you need consecutive calls on a </span><span style="font-size: 14px; color: blue;">void</span><span style="font-size: 14px;"> method, the first call to throw an error, the next call to do nothing, and then the call after that to perform some logic using </span><span style="font-size: 14px; color: blue;">doAnswer()</span><span style="font-size: 14px;">, then follow the ensuing syntax:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  doThrow(new RuntimeException()).</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  doNothing().</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  doAnswer(someAnswer).</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(mock).someVoidMethod();</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">doCallRealMethod()</span> method is used when you want to call the real implementation of a method on a mock object. The following is the syntax:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">doCallRealMethod().when(mock).someVoidMethod();</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what's the job of the method doReturn ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">doReturn()</span><span style="font-size: 14px;"> method is like </span><span style="font-size: 14px; color: blue;">thenReturn()</span><span style="font-size: 14px;">, but this is used only when </span><span style="font-size: 14px; color: blue;">when(mock).thenReturn(return)</span><span style="font-size: 14px;"> cannot be used. The </span><span style="font-size: 14px; color: blue;">when().thenReturn()</span><span style="font-size: 14px;"> method is more readable than </span><span style="font-size: 14px; color: blue;">doReturn()</span><span style="font-size: 14px;">. Also, </span><span style="font-size: 14px; color: blue;">doReturn()</span><span style="font-size: 14px;"> is not type safe. The </span><span style="font-size: 14px; color: blue;">thenReturn</span><span style="font-size: 14px;"> method checks method return types and raises a compilation error if an unsafe type is passed. You can use </span><span style="font-size: 14px; color: blue;">doReturn()</span><span style="font-size: 14px;"> when working with spy objects. Here is the syntax for using the </span><span style="font-size: 14px; color: blue;">doReturn()</span><span style="font-size: 14px;"> test:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">doReturn(value).when(mock).method(argument);</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following code snippet provides an example of unsafe usage of </span><span style="font-size: 14px; color: blue;">doReturn</span>:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_do_return_is_not_safe() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(request.getServletPath()).thenReturn(&quot;/logon.do&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(&quot;/logon.do&quot;, request.getServletPath());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  doReturn(1.111d).when(request.getServletPath());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  request.getServletPath();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what is an argument captor ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">Verifying arguments using ArgumentCaptor</span></span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">An </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span> object verifies the arguments passed to a stubbed method. Sometimes, we create an object in our code under test and then pass it to a method on a mocked dependency, but never return it. Argument captors let us directly access these values provided to our mocks in order to examine them more closely. An </span><span style="font-size: 14px; font-weight: bold;">ArgumentCaptor</span><span style="font-size: 14px;"> object provides an API to test the computed value.</span> <span style="font-size: 14px; color: rgb(51, 51, 51);">An </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span><span style="font-size: 14px;"> object is defined as follows:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">ArgumentCaptor&lt;T&gt; argCaptor= ArgumentCaptor.forClass(T.class);</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Where </span><span style="font-size: 14px; color: blue;">T</span> is the type of argument, such as a string or a user-defined class. <span style="font-size: 14px; color: rgb(51, 51, 51);">The following syntax is used to capture arguments:</span></span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">verify(mockObject).methodA(argCaptor.capture());</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">If an </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span><span style="font-size: 14px;"> object captures arguments for multiple invocations, the captured values can be retrieved by calling the </span><span style="font-size: 14px; color: blue;">getAllValues()</span><span style="font-size: 14px;"> method. The </span><span style="font-size: 14px; color: blue;">getAllValues()</span><span style="font-size: 14px;"> method returns </span><span style="font-size: 14px; color: blue;">List&lt;T&gt;</span><span style="font-size: 14px;"> and the </span><span style="font-size: 14px; color: blue;">getValue()</span><span style="font-size: 14px;"> method returns </span><span style="font-size: 14px; color: blue;">T</span><span style="font-size: 14px;">, which is the last method invocation result. Here, </span><span style="font-size: 14px; color: blue;">T</span><span style="font-size: 14px;"> is the type of argument class, such as an integer or any Java class type.</span> <span style="font-size: 14px; color: rgb(51, 51, 51);">The following code uses an </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span><span style="font-size: 14px;"> to verify the argument passed into the </span><span style="font-size: 14px; color: blue;">lookUp</span><span style="font-size: 14px;"> method.</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">ArgumentCaptor&lt;String&gt; captor = ArgumentCaptor.forClass(String.class);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">verify(repository).lookUp(captor.capture());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">assertEquals(&quot;123&quot;, captor.getValue());</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how do you capture collection arguments in mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following example demonstrates how to capture collection arguments. Create an interface and add a method to accept a list of strings. The following is the code:</span></span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">interface Service{</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  void call(List&lt;String&gt; args);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Try to create an </span><span style="font-size: 14px; color: blue;">ArgumentCapture</span><span style="font-size: 14px;"> for the list of strings. You cannot create a class for </span><span style="font-size: 14px; color: blue;">List&lt;String&gt;.class</span><span style="font-size: 14px;">, so you can try to use </span><span style="font-size: 14px; color: blue;">List.class</span><span style="font-size: 14px;">. The following screenshot shows you the Java compilation error while converting </span><span style="font-size: 14px; color: blue;">List.class</span><span style="font-size: 14px;"> to </span><span style="font-size: 14px; color: blue;">List&lt;String&gt;</span><span style="font-size: 14px;">:</span></div><div><br/></div><div><img src="mockito_files/Image [2].jpg" type="image/jpeg" data-filename="Image.jpg" alt="Working with generic collection arguments" width="602"/></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following code snippet creates </span><span style="font-size: 14px; color: blue;">List.class</span><span style="font-size: 14px;"> and casts it to </span><span style="font-size: 14px; color: blue;">Class&lt;List&lt;String&gt;&gt;</span><span style="font-size: 14px;">, and passes it to </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span><span style="font-size: 14px;">. This will give you warnings about unsafe casts; you can suppress the warning by annotating the construct with </span><span style="font-size: 14px; color: blue;">@SuppressWarnings(&quot;unchecked&quot;)</span><span style="font-size: 14px;">:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_captures_collections() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Class&lt;List&lt;String&gt;&gt; listClass = (Class&lt;List&lt;String&gt;&gt;)(Class)List.class;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  ArgumentCaptor&lt;List&lt;String&gt;&gt; captor = ArgumentCaptor.forClass(listClass);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following test provides an example of such a use. Here, </span><span style="font-size: 14px; color: blue;">service</span><span style="font-size: 14px;"> is a mocked implementation of the </span><span style="font-size: 14px; color: blue;">Service</span><span style="font-size: 14px;"> interface:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test public void when_captures_collections(){</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Class&lt;List&lt;String&gt;&gt; listClass = (Class&lt;List&lt;String&gt;&gt;)(Class)List.class;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  ArgumentCaptor&lt;List&lt;String&gt;&gt; captor = ArgumentCaptor.forClass(listClass);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  service.call(Arrays.asList(&quot;a&quot;,&quot;b&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  verify(service).call(captor.capture());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertTrue(captor.getValue().</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  containsAll(Arrays.asList(&quot;a&quot;,&quot;b&quot;)));</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how can you use an argument capture with arrays and variables ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following example shows you how to capture an argument of type arrays or var-args (</span><span style="font-size: 14px; color: blue;">T... t</span>).</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Modify the </span><span style="font-size: 14px; color: blue;">MessageRepository</span><span style="font-size: 14px;"> class to accept variable arguments of strings as </span><span style="font-size: 14px; color: blue;">errorCodes</span><span style="font-size: 14px;">. The following is the modified code:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public interface MessageRepository {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  String lookUp(String... errorCode);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Create a test to pass an array to the </span><span style="font-size: 14px; color: blue;">lookUp</span> method and capture values. The following is the code snippet:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_capturing_variable_args() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  String[] errorCodes = {&quot;a&quot;,&quot;b&quot;,&quot;c&quot;};</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  ArgumentCaptor&lt;String&gt; captor = ArgumentCaptor.forClass(String.class);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  repository.lookUp(errorCodes);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  verify(repository).lookUp(captor.capture(),captor.capture(),captor.capture());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertTrue(captor.getAllValues().containsAll(Arrays.asList(errorCodes)));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how could you verify the invocation order inside a method ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito facilitates verification if interactions with a mock were performed in a given order using the </span><span style="font-size: 14px; color: blue;">InOrder</span><span style="font-size: 14px;"> API. It allows us to create an </span><span style="font-size: 14px; color: blue;">InOrder</span><span style="font-size: 14px;"> of mocks and verify the call order of all the calls of all the mocks.</span> <span style="font-size: 14px; color: blue;">InOrder</span><span style="font-size: 14px;"> is created with mock object using the following syntax:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">InOrder inOrder=inOrder(mock1,mock2,...mockN);</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Method invocation order is checked using the following syntax:</span></span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">inOrder.verify(mock1).methodCall1();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">inOrder.verify(mock2).methodCall2();</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">If </span><span style="font-size: 14px; color: blue;">methodCall2()</span><span style="font-size: 14px;"> of </span><span style="font-size: 14px; color: blue;">mock2</span><span style="font-size: 14px;"> is invoked before </span><span style="font-size: 14px; color: blue;">methodCall1()</span><span style="font-size: 14px;"> of </span><span style="font-size: 14px; color: blue;">mock1</span><span style="font-size: 14px;">, the test fails. The following test verifies the test order:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_inorder() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  request.getServletPath();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  service.call(Arrays.asList(&quot;a&quot;,&quot;b&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  InOrder inOrder=inOrder(request,service);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  inOrder.verify(service).call(anyList());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  inOrder.verify(request).getServletPath();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The test verifies that the </span><span style="font-size: 14px; color: blue;">call()</span><span style="font-size: 14px;"> method is invoked before the </span><span style="font-size: 14px; color: blue;">getServletPath()</span><span style="font-size: 14px;"> method, but the methods were invoked in reverse order, so the test will fail. The following screenshot demonstrates the error:</span></div><div><br/></div><div><img src="mockito_files/Image [3].jpg" type="image/jpeg" data-filename="Image.jpg" alt="Verifying an invocation order" width="481"/></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Reordering the verification sequence in the following manner fixes the test:</span></span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test public void when_inorder() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  request.getServletPath();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  service.call(Arrays.asList(&quot;a&quot;,&quot;b&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  InOrder inOrder=inOrder(request,service);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  inOrder.verify(request).getServletPath();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  inOrder.verify(service).call(anyList());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how do you create spy with mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">A Mockito spy allows us to use real objects instead of mocks by replacing some of the methods with stubbed ones. This behavior allows us to test the legacy code. The spy is useful for legacy code as you cannot invoke a few testing impediment methods from your code under test, and also, you cannot mock a class that needs to be tested. A spy can stub these testing impediments without mocking the code under test. A spy can stub the nontestable methods so that other methods can be tested easily. You can also use spies without doing any stubbing and just use them to verify interactions between two totally real objects.</span></span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Once an expectation is set for a method on a </span><span style="font-size: 14px; color: blue;">spy</span><span style="font-size: 14px;"> object, the </span><span style="font-size: 14px; color: blue;">spy</span><span style="font-size: 14px;"> object no longer returns the original value. It starts returning the stubbed value, but still exhibits the original behavior for the other methods that are not stubbed.</span> <span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito can create a spy for a real object. Unlike stubbing, when we use the spy object, real methods are called (unless a method was stubbed). Spy is also known as partial mock. The following is the declaration of </span><span style="font-size: 14px; color: blue;">spy</span><span style="font-size: 14px;">:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">SomeClass realObject = new RealImplemenation();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">SomeClass spyObject = spy(realObject);</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following is a self-explanatory example of </span><span style="font-size: 14px; color: blue;">spy</span>:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_spying_real_objects() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Error error = new Error();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  error.setErrorCode(&quot;Q123&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Error spyError = spy(error);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //call real method from  spy</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(&quot;Q123&quot;, spyError.getErrorCode());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //Changing value using spy</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  spyError.setErrorCode(null);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">//verify spy has the changed value</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(null, spyError.getErrorCode());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //Stubbing method</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(spyError.getErrorCode()).thenReturn(&quot;E456&quot;);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //Changing value using spy</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  spyError.setErrorCode(null);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //Stubbed method value E456 is returned NOT NULL</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNotEquals(null, spyError.getErrorCode());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //Stubbed method value E456</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(&quot;E456&quot;, spyError.getErrorCode());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what kind of side effects does have a spy object ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Spying real objects and calling real methods on a </span><span style="font-size: 14px; color: blue;">spy</span><span style="font-size: 14px;"> object has side effects; to immunize this side effect, use </span><span style="font-size: 14px; color: blue;">doReturn()</span><span style="font-size: 14px;"> instead of </span><span style="font-size: 14px; color: blue;">thenReturn()</span><span style="font-size: 14px;">.</span> <span style="font-size: 14px; color: rgb(51, 51, 51);">The following code describes the side effect of spying and calling </span><span style="font-size: 14px; color: blue;">thenReturn()</span><span style="font-size: 14px;">:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_doReturn_fails() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  List&lt;String&gt; spy = spy(list);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //impossible the real list.get(0) is called and fails</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //with IndexOutofBoundsException, as the list is empty</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(spy.get(0)).thenReturn(&quot;not reachable&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">spy</span><span style="font-size: 14px;"> object calls a real method when trying to stub </span><span style="font-size: 14px; color: blue;">get(index)</span><span style="font-size: 14px;">, and unlike the mock objects, the real method was called and it failed with an </span><span style="font-size: 14px; color: blue;">ArrayIndexOutOfBounds</span><span style="font-size: 14px;"> error. The following screenshot displays the failure message:</span></div><div><br/></div><div><img src="mockito_files/Image [4].jpg" type="image/jpeg" data-filename="Image.jpg" alt="Spying objects" width="537"/></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">This failure can be protected using </span><span style="font-size: 14px; color: blue;">doReturn()</span>, as shown is the following code:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test public void when_doReturn_fails() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  List&lt;String&gt; list = new ArrayList&lt;String&gt;();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  List&lt;String&gt; spy = spy(list);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  //doReturn fixed the issue</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  doReturn(&quot;now reachable&quot;).when(spy).get(0);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertEquals(&quot;now reachable&quot;, spy.get(0));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>what are the notations implemented by mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">We learned that Mockito supports the </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;"> annotation for mocking. Like </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;">, Mockito offers three useful annotations, namely, </span><span style="font-size: 14px; color: blue;">@Spy</span><span style="font-size: 14px;">, </span><span style="font-size: 14px; color: blue;">@Captor</span><span style="font-size: 14px;">, and </span><span style="font-size: 14px; color: blue;">@InjectMocks</span><span style="font-size: 14px;">:</span></div><ul><li><div><span style="font-size: 14px;">@Captor: This simplifies the creation of </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span><span style="font-size: 14px;">, and this is useful when the argument to capture is a horrible generic class</span></div></li><li><div><span style="font-size: 14px;">@Spy: This creates the spy of a given object; use it instead of <span style="font-size: 14px; color: blue;">spy(Object)</span></span></div></li><li><div><span style="font-size: 14px;">@InjectMocks: It injects mock or spy fields into tested objects automatically using </span><span style="font-size: 14px; font-weight: bold;">constructor</span><span style="font-size: 14px;"> injection, </span><span style="font-size: 14px; font-weight: bold;">setter</span><span style="font-size: 14px;"> injection, or </span><span style="font-size: 14px; font-weight: bold;">field</span><span style="font-size: 14px;"> injection</span></div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you give an example of the captor notation ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following example demonstrates the </span><span style="font-size: 14px; color: blue;">@Captor</span> annotation:</span></div><div><br/></div><div><span style="font-size: 14px;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px;">public class AnnotationTest {</span></div><div><br/></div><div><span style="font-size: 14px;">  @Captor</span></div><div><span style="font-size: 14px;">  ArgumentCaptor&lt;List&lt;String&gt;&gt; captor;</span></div><div><span style="font-size: 14px;">  @Mock Service service;</span></div><div><br/></div><div><span style="font-size: 14px;">  @Test</span></div><div><span style="font-size: 14px;">  public void when_captor_annotation_is_used() {</span></div><div><span style="font-size: 14px;">    service.call(Arrays.asList(&quot;a&quot;,&quot;b&quot;));</span></div><div><span style="font-size: 14px;">    verify(service).call(captor.capture());</span></div><div><span style="font-size: 14px;">    assertTrue(captor.getValue().containsAll(Arrays.asList(&quot;a&quot;,&quot;b&quot;)));</span></div><div><span style="font-size: 14px;">  }</span></div><div><span style="font-size: 14px;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The annotation creates the </span><span style="font-size: 14px; color: blue;">ArgumentCaptor</span><span style="font-size: 14px;"> object, and we don't need to typecast it to </span><span style="font-size: 14px; color: blue;">Class&lt;List&lt;String&gt;&gt;</span><span style="font-size: 14px;">.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you show an example of using the spy notation ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following example demonstrates the use of the </span><span style="font-size: 14px; color: blue;">@spy</span> annotation:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class SpyAnnotationTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Spy</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  ErrorHandlerImpl errorHandler;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void when_spy_annotation_is_used() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    assertNotNull(errorHandler);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">A </span><span style="font-size: 14px; color: blue;">Spy</span><span style="font-size: 14px;"> object of </span><span style="font-size: 14px; color: blue;">ErrorHandlerImpl</span><span style="font-size: 14px;"> is created automatically for </span><span style="font-size: 14px; color: blue;">errorHandler</span><span style="font-size: 14px;">. You cannot create a spy for an interface. The following error message pops up when we try to create a spy for the </span><span style="font-size: 14px; color: blue;">ErrorHandler</span><span style="font-size: 14px;"> interface:</span></div><div><br/></div><div><span style="font-size: 14px;"> </span> <span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Spy</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  ErrorHandler errorHandler;</span></div><div><br/></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following screenshot displays the error message:</span></span></div><div><br/></div><div><img src="mockito_files/Image [5].jpg" type="image/jpeg" data-filename="Image.jpg" alt="Exploring Mockito annotations" width="555"/></div><div><br/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>Can you show an example using the InjectMocks notation ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following example demonstrates the use of the </span><span style="font-size: 14px; color: blue;">@InjectMocks</span><span style="font-size: 14px;"> annotation. Here, we'll create a </span><span style="font-size: 14px; color: blue;">@spy</span><span style="font-size: 14px;"> annotation and two </span><span style="font-size: 14px; color: blue;">@mocks</span><span style="font-size: 14px;"> annotations. The </span><span style="font-size: 14px; color: blue;">@InjectMocks</span><span style="font-size: 14px;"> annotation sets the mocks and spy to the real object as a constructor injection.</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class InjectMocksAnnotationTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Mock LoginController loginController;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Mock MessageRepository repository;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Spy ErrorHandlerImpl errorHandler;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @InjectMocks</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  DemoController controller;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Mock HttpServletRequest request;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Mock HttpServletResponse response;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Mock RequestDispatcher dispatcher;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void when_mocks_are_injected() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    when(request.getServletPath()).thenReturn(&quot;/&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    when(request.getRequestDispatcher(anyString())).thenReturn(dispatcher);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    controller.doGet(request, response);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    verify(request).getRequestDispatcher(eq(&quot;login.jsp&quot;));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">DemoController</span><span style="font-size: 14px;"> constructor depends on three classes; the preceding example creates the mock and spy objects and injects them to the </span><span style="font-size: 14px; color: blue;">DemoController</span><span style="font-size: 14px;"> constructor.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how can you change default behaviours of mockito ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">We learned that nonstubbed methods of a mock object return default values, such as </span><span style="font-size: 14px; color: blue;">Null</span><span style="font-size: 14px;"> for an object and </span><span style="font-size: 14px; color: blue;">false</span><span style="font-size: 14px;"> for a Boolean. However, Mockito allows us to change the default settings to return other nondefault values; these are basically preconfigured answers. The following are settings that are allowed:</span></div><div><br/></div><ul><li><div><span style="font-size: 14px;">RETURNS_DEFAULTS: This is the default setting that returns </span><span style="font-size: 14px; color: blue;">null</span><span style="font-size: 14px;"> for an object, </span><span style="font-size: 14px; color: blue;">false</span><span style="font-size: 14px;"> for a Boolean, and so on.</span></div></li><li><div><span style="font-size: 14px;">RETURNS_SMART_NULLS: This returns </span><span style="font-size: 14px; font-style: italic;">smart nulls</span><span style="font-size: 14px;">, which are stubs that act like nulls (in that they throw exceptions if you try and call </span><span style="font-size: 14px; color: blue;">stub.anyMethod()</span><span style="font-size: 14px;">), but throw exceptions that are much more useful than normal </span><span style="font-size: 14px; color: blue;">NullPointerExceptions</span><span style="font-size: 14px;"> by giving you information on which call they came from and where.</span></div></li><li><div><span style="font-size: 14px;">RETURNS_MOCKS: This returns mock for objects and default value for primitives. If the object cannot be mocked (such as a final class), a </span><span style="font-size: 14px; color: blue;">Null</span><span style="font-size: 14px;"> value is returned.</span></div></li><li><div><span style="font-size: 14px;">RETURNS_DEEP_STUBS: This returns a deep stub. This is really important for legacy code where we need to stub the method chaining, for example, when Foo calls </span><span style="font-size: 14px; color: blue;">getBar().getTar().getName()</span><span style="font-size: 14px;">. Deep stubbing allows Foo to directly stub the </span><span style="font-size: 14px; color: blue;">getName()</span><span style="font-size: 14px;"> method to return a value. Otherwise, we have to stub Foo's </span><span style="font-size: 14px; color: blue;">getBar</span><span style="font-size: 14px;"> method to return a mock </span><span style="font-size: 14px; color: blue;">Bar</span><span style="font-size: 14px;"> object, stub the bar's </span><span style="font-size: 14px; color: blue;">getTar()</span><span style="font-size: 14px;"> method to return a mock </span><span style="font-size: 14px; color: blue;">Tar</span><span style="font-size: 14px;"> object, and finally, stub the Tar's </span><span style="font-size: 14px; color: blue;">getName</span><span style="font-size: 14px;"> method to return a value.</span></div></li><li><div><span style="font-size: 14px;">CALLS_REAL_METHODS: This calls the corresponding method from the real implementation of the mocked class.</span></div></li></ul><div><br/></div><div><br/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you show an example of the RETURNS_DEFAULTS setting ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following test case uses the </span><span style="font-size: 14px; color: blue;">RETURNS_DEFAULTS</span><span style="font-size: 14px;"> setting to return a </span><span style="font-size: 14px; color: blue;">NULL Bar</span><span style="font-size: 14px;"> object:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_default_settings() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Foo fooWithReturnDefault = Mockito.mock(Foo.class, Mockito.RETURNS_DEFAULTS);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  // default null is returned</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNull(fooWithReturnDefault.getBar());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you show an example of using the REtuRNS_SMART_NULLS setting ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The following test case uses the </span><span style="font-size: 14px; color: blue;">RETURNS_SMART_NULLS</span><span style="font-size: 14px;"> setting to return a smart </span><span style="font-size: 14px; color: blue;">NULL</span><span style="font-size: 14px;"> object:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_changing_default_settings_to_return_smartNULLS(){</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Foo fooWithSmartNull = Mockito.mock(Foo.class, Mockito.RETURNS_SMART_NULLS);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  // a smart null is returned</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNotNull(fooWithSmartNull.getBar());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  System.out.println(&quot;fooWithSmartNull.getBar() =&quot; + fooWithSmartNull.getBar());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following is the </span><span style="font-size: 14px; color: blue;">System.out</span> output:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">fooWithSmartNull.getBar() =SmartNull returned by this unstubbed method call on a mock:foo.getBar();</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you show an example of using the RETURNS_MOCKS setting ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following test case uses the </span><span style="font-size: 14px; color: blue;">RETURNS_MOCKS</span> setting to return a mock object hierarchy:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_changing_default_settings_to_return_mocks() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Foo fooWithReturnsMocks = Mockito.mock(Foo.class, Mockito.RETURNS_MOCKS);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  // a mock is returned</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Bar mockBar = fooWithReturnsMocks.getBar();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNotNull(mockBar);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNotNull(mockBar.getTar());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNotNull(mockBar.getTar().getName());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  System.out.println(&quot;fooWithReturnsMocks.getBar()=&quot; + mockBar);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  System.out.println(&quot;fooWithReturnsMocks.getBar().getTar().getName()={&quot; + mockBar.getTar().getName()+&quot;}&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">RETURNS_MOCKS</span><span style="font-size: 14px;"> setting populates the </span><span style="font-size: 14px; color: blue;">Foo</span><span style="font-size: 14px;"> object with a mocked </span><span style="font-size: 14px; color: blue;">Bar</span><span style="font-size: 14px;"> object. A mocked </span><span style="font-size: 14px; color: blue;">Bar</span><span style="font-size: 14px;"> object has a mocked </span><span style="font-size: 14px; color: blue;">Tar</span><span style="font-size: 14px;"> object and the mocked </span><span style="font-size: 14px; color: blue;">Tar</span><span style="font-size: 14px;"> object has an empty mocked string name. The following is the output:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">fooWithReturnsMocks.getBar()=Mock for Bar, hashCode: 1620275837</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">fooWithReturnsMocks.getBar().getTar().getName()={}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>can you show an example of use of the RETURNS_DEEP_STUBS setting ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following test case uses the </span><span style="font-size: 14px; color: blue;">RETURNS_DEEP_STUBS</span> setting to return a deep-stubbed object hierarchy:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public void when_returns_deep_stub() throws Exception {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  Foo fooWithDeepStub = Mockito.mock(Foo.class, Mockito.RETURNS_DEEP_STUBS);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  when(fooWithDeepStub.getBar().getTar().getName()).thenReturn(&quot;Deep Stub&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  // a deep stubbed mock is returned</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  System.out.println(&quot;fooWithDeepStub.getBar().getTar().getName()=&quot;+ fooWithDeepStub.getBar().getTar().getName());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  assertNotNull(fooWithDeepStub.getBar().getTar().getName());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">The </span><span style="font-size: 14px; color: blue;">RETURNS_DEEP_STUBS</span><span style="font-size: 14px;"> setting is very useful for legacy code. In the preceding example, we had to stub the </span><span style="font-size: 14px; color: blue;">getName()</span><span style="font-size: 14px;"> method of a </span><span style="font-size: 14px; color: blue;">Tar</span><span style="font-size: 14px;"> object, but to stub the method, we had to mock a series of other objects. Only when we used the </span><span style="font-size: 14px; color: blue;">RETURNS_DEEP_STUBS</span><span style="font-size: 14px;"> setting could the chaining of the method call stub the method and other objects.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following is the print output:</span></span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">fooWithDeepStub.getBar().getTar().getName()=Deep Stub</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">how can you create a mock inside mockito ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To create a mock of a given class using the </span><span style="font-size: 14px; color: blue;">Mockito</span><span style="font-size: 14px;"> static method, you have to call the static </span><span style="font-size: 14px; color: blue;">Mockito.mock(Class&lt;T&gt; classToMock)</span><span style="font-size: 14px;"> method with the type of class to mock.</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class MeanTaxFactorCalculatorTest {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  static final double TAX_FACTOR = 10;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  TaxService taxService = mock(TaxService.class);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  MeanTaxFactorCalculator systemUnderTest = new MeanTaxFactorCalculator(taxService);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void should_calculate_mean_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    given(taxService.getCurrentTaxFactorFor(any(Person.class))).willReturn(TAX_FACTOR);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    double meanTaxFactor = systemUnderTest.calculateMeanTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    then(meanTaxFactor).isEqualTo(TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;"> </span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Internally, Mockito calls the overloaded </span><span style="font-size: 14px; color: blue;">mock</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> method that takes the </span><span style="font-size: 14px; color: blue;">MockSettings</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> argument and executes it with a default answer set to the </span><span style="font-size: 14px; color: blue;">RETURNS_DEFAULT</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> value (in other words, returns zeroes, empty collections, null values, and so on.) Next, by means of the </span><span style="font-size: 14px; color: blue;">MockitoCore</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> class, a custom CGLIB proxy is created and returned to the user.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">how can you create a mock using annotation inside mockito ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Since Mockito integrates very nicely with JUnit (refer to </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch01.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 1</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Getting Started with Mockito</span><span style="font-size: 14px;">, for more details regarding both JUnit and TestNG configuration), let's remove the unnecessary code and make the test more readable. To do that, you have to perform the following steps:</span></div><div><br/></div><ol><li><div><span style="font-size: 14px;">Annotate your test with </span><span style="font-size: 14px; color: blue;">@RunWith(MockitoJUnitRunner.class)</span><span style="font-size: 14px;">.</span></div></li><li><div><span style="font-size: 14px;">Define the collaborators that you would like to mock.</span></div></li><li><div><span style="font-size: 14px;">Annotate those dependencies with </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;"> annotation.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Of course, this JUnit approach will work only if you haven't already annotated your test class with another </span><span style="font-size: 14px; color: blue;">@RunWith</span> annotation.</span></div><div><br/></div><div><span style="font-size: 14px; color: rgb(51, 51, 51);">Now, let's take a look at the test written for JUnit (remember that I'm using the </span><span style="font-size: 14px; color: blue;">BDDMockito.given(...)</span><span style="font-size: 14px;"> and AssertJ's </span><span style="font-size: 14px; color: blue;">BDDAssertions.then(...)</span><span style="font-size: 14px;"> static methods. Refer to </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch07.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 7</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Verifying Behavior with Object Matchers</span><span style="font-size: 14px;">, to learn how to work with AssertJ or how to do the same with Hamcrest's </span><span style="font-size: 14px; color: blue;">assertThat(...)</span><span style="font-size: 14px;">). Have a look at the following code:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class MeanTaxFactorCalculatorTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    static final double TAX_FACTOR = 10;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Mock TaxService taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @InjectMocks MeanTaxFactorCalculator systemUnderTest;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_calculate_mean_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        given(taxService.getCurrentTaxFactorFor(any(Person.class))).willReturn(TAX_FACTOR);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double meanTaxFactor = systemUnderTest.calculateMeanTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(meanTaxFactor).isEqualTo(TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">how can you create a mock with a different default answer ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To set a different default answer without annotations, you have to use the overloaded </span><span style="font-size: 14px; color: blue;">Mockito.mock(Class&lt;T&gt; classToMock, Answer defaultAnswer)</span> static method.</span></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">The following snippet shows an example of a test that uses the </span><span style="font-size: 14px; color: blue;">ThrowsExceptionClass</span> answer set on a mock as its default answer:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class MeanTaxFactorCalculatorTest {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  TaxService taxService = mock(TaxService.class, new ThrowsExceptionClass(IllegalStateException.class));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  MeanTaxFactorCalculator systemUnderTest = new MeanTaxFactorCalculator(taxService);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void should_throw_exception_when_calculating_mean_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // expect</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    try {     </span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">      systemUnderTest.calculateMeanTaxFactorFor(new Person());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">      fail(&quot;Should throw exception&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    } catch (IllegalStateException exception) {}</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;"> </span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How it works...</span></span></div><div><span style="font-size: 14px;">Mockito takes the passed answer type argument and creates </span><span style="font-size: 14px; color: blue;">MockitoSettings</span><span style="font-size: 14px;"> from it as follows:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public static &lt;T&gt; T mock(Class&lt;T&gt; classToMock, Answer defaultAnswer) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        return mock(classToMock, withSettings().defaultAnswer(defaultAnswer));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px;">In this way, the default mock's answer is changed to the custom one. In this way, if not previously stubbed, all of the mock's methods will, by default, execute the logic from the passed </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> implementation.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;">can you list some of the Answer implementations inside Mockito ?</span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Here is the list of additional, interesting Mockito </span><span style="font-size: 14px; color: blue;">Answer</span> implementations together with a short description (mind you, they are part of the Mockito internals, so I'm presenting them for you to understand what happens under the hood while using Mockito. Be cautious when using them):</span></div><div><br/></div><ul><li><div><span style="font-size: 14px;">Returns: It always returns the object passed in the constructor of this </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> implementation.</span></div></li><li><div><span style="font-size: 14px;">ReturnsEmptyValues: When creating a mock, all of its methods are stubbed as follows based on the method's return type: For primitives: It returns default Java-appropriate primitive values (0 for integer, false for boolean, and so on)For primitive wrappers: It returns the same values as for primitivesFor most commonly used collection types: It returns an empty collectionFor the </span><span style="font-size: 14px; color: blue;">toString()</span><span style="font-size: 14px;"> method: It returns the mock's nameFor </span><span style="font-size: 14px; color: blue;">Comparable.compareTo(T other)</span><span style="font-size: 14px;">: It returns 1 (meaning that the objects are not equal to each other)For anything else: It returns null</span></div></li><li><div><span style="font-size: 14px;">ReturnsMoreEmptyValues: This implementation extends the </span><span style="font-size: 14px; color: blue;">ReturnsEmptyValues</span><span style="font-size: 14px;"> functionality with the following additional default return types:For arrays: It returns an empty arrayFor strings: It returns an empty string (&quot;&quot;)Returns an empty array for methods that return arraysReturns an empty string (&quot;&quot;) for methods returning strings</span></div></li><li><div><span style="font-size: 14px;">ReturnsSmartNulls: If a </span><span style="font-size: 14px; color: blue;">NullPointerException</span><span style="font-size: 14px;"> gets thrown on mock, Mockito catches it and rethrows </span><span style="font-size: 14px; color: blue;">SmartNullPointerException</span><span style="font-size: 14px;"> with additional helpful messages. Additionally, it acts like </span><span style="font-size: 14px; color: blue;">ReturnsMoreEmptyValues</span><span style="font-size: 14px;">.</span></div></li><li><div><span style="font-size: 14px;">DoesNothing: This method always returns null for objects (non-primitive types) and default values for primitives.</span></div></li><li><div><span style="font-size: 14px;">CallsRealMethods: This method creates a partial mock by default, unstubbed methods delegate to real implementations.</span></div></li><li><div><span style="font-size: 14px;">ReturnsArgumentAt: This method returns an argument at a specified position of an array (for -1, it returns its last element).</span></div></li><li><div><span style="font-size: 14px;">ReturnsElementsOf: This method keeps returning subsequent elements of the collection that is passed in the constructor. Once it arrives at the tail of the collection, it will always return that value.</span></div></li><li><div><span style="font-size: 14px;">ReturnsDeepStubs: This method allows easy nested mock creation and method chain stubbing. Check </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch08.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 8</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Refactoring with Mockito</span><span style="font-size: 14px;">, for usage examples and suggestions why you should not use it.</span></div></li><li><div><span style="font-size: 14px;">ThrowsExceptionClass: This method throws the exception passed as the argument to the constructor of </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;"> for each method. Mockito will instantiate the exception for you.</span></div></li><li><div><span style="font-size: 14px;">ThrowsException: This method throws an instantiated exception passed to the constructor of </span><span style="font-size: 14px; color: blue;">Answer</span><span style="font-size: 14px;">.</span></div></li><li><div><span style="font-size: 14px;">ReturnsMocks: First, this method tries to return values such as the ones defined in </span><span style="font-size: 14px; color: blue;">ReturnsMoreEmptyValues</span><span style="font-size: 14px;"> and, if that fails, it tries to return a mock. Eventually, if this attempt fails at either of them, </span><span style="font-size: 14px; color: blue;">ReturnsMocks</span><span style="font-size: 14px;"> returns null. Please think twice before using this answer (or use it only to refactor some legacy code), since it clearly means that something is wrong with your design.</span></div></li></ul><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">NOTE</span></span> <span style="font-size: 14px;">Another interesting feature is that if you create a class called </span><span style="font-size: 14px; color: blue;">MockitoConfiguration</span><span style="font-size: 14px;"> that implements </span><span style="font-size: 14px; color: blue;">IMockitoConfiguration</span><span style="font-size: 14px;"> or extends the </span><span style="font-size: 14px; color: blue;">DefaultMockitoConfiguration</span><span style="font-size: 14px;"> class in the </span><span style="font-size: 14px; color: blue;">org.mockito.configuration</span><span style="font-size: 14px;"> package. You can then set a global answer for all your mocks. The following snippet shows what a Mockito configuration class should look like in order to change the default answer of any mock to </span><span style="font-size: 14px; color: blue;">ReturnsSmartNulls</span><span style="font-size: 14px;">:</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">How can you create a mock object with a different default answer using notations ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">If you want to pass a nondefault answer to the </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;"> annotated field you have to set the </span><span style="font-size: 14px; color: blue;">answer</span><span style="font-size: 14px;"> property with a proper value of the </span><span style="font-size: 14px; color: blue;">Answers</span><span style="font-size: 14px;"> enum on the </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;"> annotation.</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorInformationProviderTest {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Mock(answer = Answers.RETURNS_SMART_NULLS) TaxService taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @InjectMocks TaxFactorInformationProvider systemUnderTest;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_calculate_mean_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        String parsedIrsAddress = systemUnderTest.formatIrsAddress(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(parsedIrsAddress).isEqualTo(&quot;IRS:[]&quot;);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">By passing </span><span style="font-size: 14px; color: blue;">Answers.RETURNS_SMART_NULLS</span>, we've managed to define that if an unstubbed method returns a string, then from now on it will return an empty string by default. In that way, at the end, we get an empty value of the address.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">When the Mockito's </span><span style="font-size: 14px; color: blue;">MockitoJUnitRunner</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> runner logic is executed at the end of the day, it calls the </span><span style="font-size: 14px; color: blue;">MockitoAnnotations.initMocks</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> method. That is where the default </span><span style="font-size: 14px; color: blue;">AnnotationEngine</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> is used, which, if not overriden in the global Mockito configuration, is </span><span style="font-size: 14px; color: blue;">InjectingAnnotationEngine</span><span style="font-size: 14px; color: rgb(51, 51, 51);">. This engine delegates the processing of annotated elements to the </span><span style="font-size: 14px; color: blue;">DefaultAnnotationEngine</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> that has different </span><span style="font-size: 14px; color: blue;">FieldAnnotationProcessors</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> for different types of Mockito-related annotations. In this case, the </span><span style="font-size: 14px; color: blue;">MockAnnotationProcessor</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> is called, which instantiates a </span><span style="font-size: 14px; color: blue;">MockSettings</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> object on which the code calls methods matching the annotation parameters, such as </span><span style="font-size: 14px; color: blue;">extraInterfaces(...)</span><span style="font-size: 14px; color: rgb(51, 51, 51);">, </span><span style="font-size: 14px; color: blue;">name(...)</span><span style="font-size: 14px; color: rgb(51, 51, 51);">, and </span><span style="font-size: 14px; color: blue;">defaultAnswer(...)</span><span style="font-size: 14px; color: rgb(51, 51, 51);">. In the previous example, the </span><span style="font-size: 14px; color: blue;">ReturnsSmartNulls</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> answer coming from the passed </span><span style="font-size: 14px; color: blue;">Answers.RETURNS_SMART_NULLS</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> was passed to the aforementioned </span><span style="font-size: 14px; color: blue;">defaultAnswer(...)</span><span style="font-size: 14px; color: rgb(51, 51, 51);"> method of </span><span style="font-size: 14px; color: blue;">MockSettings</span><span style="font-size: 14px; color: rgb(51, 51, 51);">. That is why the code eventually behaves as we expected it to.</span></span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">how can you create mocks using custom settings ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To customize your mock's configuration via the </span><span style="font-size: 14px; color: blue;">MockitoSettings</span> interface, you have to perform the following steps:</span></div><ol><li><div><span style="font-size: 14px;">Create the </span><span style="font-size: 14px; color: blue;">mock(Class&lt;T&gt; classToMock, MockSettings mockSettings)</span><span style="font-size: 14px;"> method.</span></div></li><li><div><span style="font-size: 14px;">Pass the </span><span style="font-size: 14px; color: blue;">MockSettings</span><span style="font-size: 14px;"> object via the static </span><span style="font-size: 14px; color: blue;">withSettings()</span><span style="font-size: 14px;"> method as the second method's parameter.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class MeanTaxFactorCalculatorTest {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  static final double TAX_FACTOR = 10;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  TaxService taxService = mock(TaxService.class, withSettings().serializable());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  MeanTaxFactorCalculator systemUnderTest = new MeanTaxFactorCalculator(taxService);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  public void should_calculate_mean_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    given(taxService.getCurrentTaxFactorFor(any(Person.class))).willReturn(TAX_FACTOR);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    double meanTaxFactor = systemUnderTest.calculateMeanTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    then(meanTaxFactor).isEqualTo(TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    then(taxService).isInstanceOf(Serializable.class);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">  }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How it works...</span></span></div><div><br/></div><div><span style="font-size: 14px;">What Mockito does internally is that it calls the </span><span style="font-size: 14px; color: blue;">MockitoCore</span><span style="font-size: 14px;"> class that is the point of entry for creating mocks. Then, a mock is created using the provided </span><span style="font-size: 14px; color: blue;">MockitoSettings</span><span style="font-size: 14px;"> object.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">There's more...</span></span></div><div><span style="font-size: 14px;">If you are using annotations to create your mock, you also have some possibilities of customization. Take a look at the following </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;"> annotation's additional parameters:</span></div><ul><li><div><span style="font-size: 14px;">answer: This parameter is one of the predefined answers present in the </span><span style="font-size: 14px; color: blue;">Answers</span><span style="font-size: 14px;"> enum</span></div></li><li><div><span style="font-size: 14px;">name: This parameter is the name of the mock</span></div></li><li><div><span style="font-size: 14px;">extraInterfaces: This parameter specifies which additional interfaces the mock should implement</span></div></li></ul><div><br/></div><div><span style="font-size: 14px;">The following is an example of a </span><span style="font-size: 14px; color: blue;">@Mock</span><span style="font-size: 14px;"> annotated field containing all of the previously mentioned parameters (the probability that you will use more than one parameter, if any, is very small):</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Mock(answer = Answers.RETURNS_SMART_NULLS, extraInterfaces = {Iterable.class, Serializable.class}, name = &quot;Custom tax service mock&quot;)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxService taxService;</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">how can you create a mock object of a final class ?</span></span></div><div><br/></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">Mockito can't do this. In order to mock a final class you need to use PowerMock. To use PowerMock with JUnit, you have to perform the following steps:</span></span></div><ol><li><div><span style="font-size: 14px;">Annotate your test class with </span><span style="font-size: 14px; color: blue;">@RunWith(PowerMockRunner.class)</span><span style="font-size: 14px;">.</span></div></li><li><div><span style="font-size: 14px;">Provide all the classes that need to be prepared for testing (most likely bytecode manipulated) in the </span><span style="font-size: 14px; color: blue;">@PrepareForTest</span><span style="font-size: 14px;"> annotation (in the case of our scenario, it would be </span><span style="font-size: 14px; color: blue;">@PrepareForTest(TaxService.class)</span><span style="font-size: 14px;"> since </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> is a final class). In general, classes that need to be prepared for testing will include classes with final, private, static or native methods; classes that are final and that should be mocked; and also classes that should be returned as mocks on instantiation.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(PowerMockRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@PrepareForTest(TaxService.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorCalculatorTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    static final double TAX_FACTOR = 10000;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Mock TaxService taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @InjectMocks TaxFactorCalculator systemUnderTest;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_calculate_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        given(taxService.calculateTaxFactorFor(Mockito.any(Person.class))).willReturn(TAX_FACTOR);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactorForPerson = systemUnderTest.calculateTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactorForPerson).isEqualTo(TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><br/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div>how can I use PowerMock with TestNG ?</div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;">To use PowerMock with TestNG, you have to perform the following steps:</span></div><div><br/></div><ol><li><div><span style="font-size: 14px;">Make your class extend the </span><span style="font-size: 14px; color: blue;">PowerMockTestCase</span><span style="font-size: 14px;"> class.</span></div></li><li><div><span style="font-size: 14px;">Implement a method annotated with the </span><span style="font-size: 14px; color: blue;">@ObjectFactory</span><span style="font-size: 14px;"> annotation that returns an instance of the </span><span style="font-size: 14px; color: blue;">PowerMockObjectFactory</span><span style="font-size: 14px;"> class (this object factory will be used for the creation of all object instances in the test).</span></div></li><li><div><span style="font-size: 14px;">Provide all the classes that need to be prepared for testing (most likely bytecode manipulated) in the </span><span style="font-size: 14px; color: blue;">@PrepareForTest</span><span style="font-size: 14px;"> annotation (in the case of our scenario, it would be </span><span style="font-size: 14px; color: blue;">@PrepareForTest(TaxService.class)</span><span style="font-size: 14px;"> since </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> is a final class). This includes classes with final, private, static, or native methods; classes that are final and that should be mocked; and also classes that should be returned a mock on object instantiation.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px;">Let's take a look at the following JUnit test that will verify whether the tax factor is properly calculated (consult the introduction to the analogous JUnit example discussed earlier in terms of </span><span style="font-size: 14px; color: blue;">BDDMockito</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">BDDAssertions</span><span style="font-size: 14px;"> usage):</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@PrepareForTest(TaxService.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorCalculatorTestNgTest extends PowerMockTestCase {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    static final double TAX_FACTOR = 10000;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Mock TaxService taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @InjectMocks TaxFactorCalculator systemUnderTest;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_calculate_tax_factor() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        given(taxService.calculateTaxFactorFor(any(Person.class))).willReturn(TAX_FACTOR);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactorForPerson = systemUnderTest.calculateTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactorForPerson).isEqualTo(TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @ObjectFactory</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public IObjectFactory getObjectFactory() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        return new PowerMockObjectFactory();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How it works...</span></span></div><div><span style="font-size: 14px;">The internals of PowerMock go far beyond the scope of this recipe but the overall concept is that part of the logic of </span><span style="font-size: 14px; color: blue;">PowerMockRunner</span><span style="font-size: 14px;"> is to create a custom classloader and bytecode manipulation for the classes defined using the </span><span style="font-size: 14px; color: blue;">@PrepareForTest</span><span style="font-size: 14px;"> annotation in order to mock them and to use these mocks with the standard Mockito API. Due to bytecode manipulations, PowerMock can ignore a series of constraints of the Java language, such as extending final classes.</span></div><div><br/></div><div><br/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">How can you create spies with Mockito ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To create a spy of a given object using the Mockito API, you need to call the static </span><span style="font-size: 14px; color: blue;">Mockito.spy(T object)</span> method with the instantiated object for which you want to create a spy.</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessorTest {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxService taxService = spy(new TaxService());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxFactorProcessor systemUnderTest = new TaxFactorProcessor(taxService);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_return_default_tax_factor_for_person_from_undefined_country() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        doNothing().when(taxService).updateTaxData(anyDouble(), any(Person.class));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactor = systemUnderTest.processTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactor).isEqualTo(TaxService.DEFAULT_TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;">What happens in the test is that we first create a spy for the </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> instance (via the statically imported </span><span style="font-size: 14px; color: blue;">Mockito.spy(...)</span><span style="font-size: 14px;"> method), and next we create the system under test. In the body of our test, in the </span><span style="font-size: 14px; color: blue;">//given</span><span style="font-size: 14px;"> section, we are stubbing our spy so that it does nothing when the </span><span style="font-size: 14px; color: blue;">updateTaxData(...)</span><span style="font-size: 14px;"> method is called (don't worry if you haven't seen the stubbing syntax of spies before. You can read more about it in </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch05.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 5</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Stubbing Behavior of Spies</span><span style="font-size: 14px;">). In the </span><span style="font-size: 14px; color: blue;">//when</span><span style="font-size: 14px;"> section, we are executing the application logic, and in the </span><span style="font-size: 14px; color: blue;">//then</span><span style="font-size: 14px;"> part, we are verifying whether the processed tax factor is the default one from the application.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How it works...</span></span></div><div><span style="font-size: 14px;">Mockito internally runs the following when you execute the static </span><span style="font-size: 14px; color: blue;">spy</span><span style="font-size: 14px;"> method:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public static &lt;T&gt; T spy(T object) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        return mock((Class&lt;T&gt;) object.getClass(), withSettings()</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">                .spiedInstance(object)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">                .defaultAnswer(CALLS_REAL_METHODS));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 14px;">You can see that a spy is in fact a mock that by default calls real methods. Additionally, the </span><span style="font-size: 14px; color: blue;">MockitoSpy</span><span style="font-size: 14px;"> interface is added to that mock.</span></div><div><br/></div><div><span style="font-size: 14px;">There are some gotchas regarding spy initialization with Mockito. Mockito creates a shallow copy of the original object so that tested code won't see or use the original object. That's important to know since any interactions on the original object will not get reflected on the spy, and vice versa (if you want to interact directly with the original object, you need to use the </span><span style="font-size: 14px; color: blue;">AdditionalAnswers.delegateTo(...)</span><span style="font-size: 14px;"> answer. To check how to stub methods with a custom answer, check </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch04.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 4</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Stubbing Behavior of Mocks</span><span style="font-size: 14px;">, or </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch05.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 5</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Stubbing Behavior of Spies</span><span style="font-size: 14px;">, for an explanation of a mock or spy's method stubbing.)</span></div><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px;">Another issue is final methods. Mockito can't stub final methods, so when you try to stub them, you will not even see a warning message and a real implementation will be called. Refer to </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch05.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 5</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Stubbing Behavior of Spies</span><span style="font-size: 14px;">, for more information on this. PowerMock related recipes to see how to deal with those methods (remember that using PowerMock suggests that there is most likely something really wrong with your code base, so you should use it with extreme caution).</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">How can you create a spy using a custom configuration ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To create a spy with a custom configuration, you need to perform the following steps:</span></span></div><ol><li><div><span style="font-size: 14px;">Call the static </span><span style="font-size: 14px; color: blue;">Mockito.mock(...)</span><span style="font-size: 14px;"> method and provide a custom configuration.</span></div></li><li><div><span style="font-size: 14px;">As for the custom configuration, add </span><span style="font-size: 14px; color: blue;">MockSettings.spiedInstance(T object)</span><span style="font-size: 14px;"> and </span><span style="font-size: 14px; color: blue;">MockSettings.defaultAnswer(Mockito.CALLS_REAL_METHODS)</span><span style="font-size: 14px;"> to create a spy of the given object.</span></div></li><li><div><span style="font-size: 14px;">To add more configurations, call additional </span><span style="font-size: 14px; color: blue;">MockSettings</span><span style="font-size: 14px;"> methods.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessorTest {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxService taxService = mock(TaxService.class, withSettings().serializable().spiedInstance(new TaxService()).defaultAnswer(CALLS_REAL_METHODS));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxFactorProcessor systemUnderTest = new TaxFactorProcessor(taxService);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_return_default_tax_factor_for_person_from_undefined_country() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        doNothing().when(taxService).updateTaxData(anyDouble(), any(Person.class));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactor = systemUnderTest.processTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactor).isEqualTo(TaxService.DEFAULT_TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxService).isInstanceOf(Serializable.class);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">NOTE</span></span></div><div><span style="font-size: 14px;">Mockito doesn't provide a standard way of spying with a custom configuration for a reason. In the vast majority of cases, you shouldn't have the need to do it.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How it works...</span></span></div><div><span style="font-size: 14px;">The body of the test is pretty straightforward and self-explanatory. The last assertion, regarding verification whether the mock implements the </span><span style="font-size: 14px; color: blue;">serializable</span><span style="font-size: 14px;"> interface, is done only to prove that the mock works as it is supposed to (don't write that in the real test code). The most interesting part, however, is the mock creation part, as follows:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">TaxService taxService = mock(TaxService.class,withSettings().serializable().spiedInstance(new TaxService()).defaultAnswer(CALLS_REAL_METHODS));</span></div><div><br/></div><div style="margin-bottom:20px;"><span style="font-size: 14px;">Since a spy is nothing but a mock that calls real implementations by default, we can create it manually, as presented in the test. The additional configuration in our case was to make the mock serializable.</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">how could you create a spy using annotations ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">To profit from Mockito's annotations, you need to perform the following steps:</span></span></div><ol><li><div><span style="font-size: 14px;">For JUnit, annotate your test class with </span><span style="font-size: 14px; color: blue;">@RunWith(MockitoJUnitRunner.class)</span><span style="font-size: 14px;">. For TestNG, copy the necessary TestNG listeners and annotate your test class with </span><span style="font-size: 14px; color: blue;">@Listeners(MockitoTestNGListener.class)</span><span style="font-size: 14px;">. Refer to </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch01.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 1</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Getting Started with Mockito</span><span style="font-size: 14px;">, for more details on the TestNG setup.</span></div></li><li><div><span style="font-size: 14px;">Annotate the object you want to create a spy for with the </span><span style="font-size: 14px; color: blue;">@Spy</span><span style="font-size: 14px;"> annotation.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessorTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Spy TaxService taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @InjectMocks TaxFactorProcessor systemUnderTest;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_return_default_tax_factor_for_person_from_undefined_country() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        doNothing().when(taxService).updateTaxData(anyDouble(), any(Person.class));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactor = systemUnderTest.processTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactor).isEqualTo(TaxService.DEFAULT_TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How it works...</span></span></div><div><span style="font-size: 14px;">The creation of spies based on annotations works exactly the same as the mocks presented in the </span><span style="font-size: 14px; font-style: italic;">Creating Mocks with annotations</span><span style="font-size: 14px;"> recipe of </span><a href="https://learning.oreilly.com/library/view/mockito-cookbook/9781783982745/ch02.html" style="font-size: 14px; color: rgb(7, 7, 7);">Chapter 2</a><span style="font-size: 14px;">, </span><span style="font-size: 14px; font-style: italic;">Creating Mocks</span><span style="font-size: 14px;">. Please refer to that chapter for more details.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">There's more...</span></span></div><div><span style="font-size: 14px;">Let's take another look at the </span><span style="font-size: 14px; color: blue;">@Spy</span><span style="font-size: 14px;"> annotated field from our test:</span> <span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Spy TaxService taxService</span></div><div><span style="font-size: 14px;">What if you want to create a spy of an object that you want to instantiate in a special way? What if, in our example, </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> doesn't have a default constructor and we need to provide some explicit value to initialize it?</span></div><div><br/></div><div><span style="font-size: 14px;">Before we answer that question, let's check how Mockito works for spy initialization. If you annotate a field with </span><span style="font-size: 14px; color: blue;">@Spy</span><span style="font-size: 14px;">, Mockito will initialize it if its zero argument constructor can be found. The scope of the constructor doesn't need to be public; it can be private too. What Mockito can't do is instantiate local or inner interfaces and classes. Coming back to the question, how can we create a spy and provide its initialization parameters? You need to explicitly call the object's constructor as follows:</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@Spy TaxService taxService = new TaxService(&quot;Some value&quot;);</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">How could you create a partial mock ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div style="margin-top:12px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">For this recipe, we will reuse the example from the previous recipe, but let's take another look at it. Our system under test for this recipe will be a </span><span style="font-size: 14px; color: blue;">TaxFactorProcessor</span><span style="font-size: 14px;"> class that interacts with a </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> class in order to calculate the tax factor and update the tax data of a given person. Have a look at the following code:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessor {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public static final double INVALID_TAX_FACTOR = -1;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    private final TaxService taxService;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public TaxFactorProcessor(TaxService taxService) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        this.taxService = taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public double processTaxFactorFor(Person person) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        try {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            double taxFactor = taxService.calculateTaxFactorFor(person);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            taxService.updateTaxData(taxFactor, person);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            return taxFactor;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        } catch (Exception e) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            System.err.printf(&quot;Exception [%s] occurred while trying to calculate tax factor for person [%s]%n&quot;, e, person.getName());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            return INVALID_TAX_FACTOR;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;">We will test our system to check that </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> performs computations but does not call a web service in our unit test.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How to do it...</span></span></div><div><span style="font-size: 14px;">In order to create a partial mock, you need to perform the following steps:</span></div><ol><li><div><span style="font-size: 14px;">Create a mock (either via code or annotations).</span></div></li><li><div><span style="font-size: 14px;">Stub the method execution so that it calls a real method (we want to execute the real logic).</span></div></li></ol><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessorTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Mock TaxService taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @InjectMocks TaxFactorProcessor systemUnderTest;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_return_default_tax_factor_for_person_from_undefined_country() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        given(taxService.calculateTaxFactorFor(any(Person.class))).willCallRealMethod();</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactor = systemUnderTest.processTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactor).isEqualTo(TaxService.DEFAULT_TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51);">How can you create a partial mock of a final class ?</span></span></div></td></tr><tr><td style="width: 1236px; padding: 8px; border: 1px solid;"><div><span style="font-size: 14px;">Our system under test, the </span><span style="font-size: 14px; color: blue;">TaxFactorProcessor</span><span style="font-size: 14px;"> class, as shown in the following code:</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessor {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public static final double INVALID_TAX_FACTOR = -1;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    private final TaxService taxService;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public TaxFactorProcessor(TaxService taxService) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        this.taxService = taxService;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public double processTaxFactorFor(Person person) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        try {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            double taxFactor = taxService.calculateTaxFactorFor(person);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            taxService.updateTaxData(taxFactor, person);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            return taxFactor;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        } catch (Exception e) {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            System.err.printf(&quot;Exception [%s] occurred while trying to calculate tax factor for person [%s]%n&quot;, e, person.getName());</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">            return INVALID_TAX_FACTOR;</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;">We will test our system to check that </span><span style="font-size: 14px; color: blue;">TaxService</span><span style="font-size: 14px;"> performs computations but does not call a web service in our unit test.</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">How to do it...</span></span></div><div><span style="font-size: 14px;">To delegate all method executions to the provided object, you need to perform the following steps:</span></div><ol><li><div><span style="font-size: 14px;">Instantiate the object that you want to delegate calls to.</span></div></li><li><div><span style="font-size: 14px;">Create a mock whose default answer will be </span><span style="font-size: 14px; color: blue;">AdditionalAnswers.delegatesTo(T delegate)</span><span style="font-size: 14px;">.</span></div></li></ol><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">@RunWith(MockitoJUnitRunner.class)</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">public class TaxFactorProcessorTest {</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    FinalTaxService finalTaxService = new FinalTaxService();</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxService taxService = mock(TaxService.class,delegatesTo(finalTaxService));</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    TaxFactorProcessor systemUnderTest = new TaxFactorProcessor(taxService);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    @Test</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    public void should_return_default_tax_factor_for_person_from_undefined_country() {</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // given</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        doNothing().when(taxService).updateTaxData(anyDouble(), any(Person.class));</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // when</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        double taxFactor = systemUnderTest.processTaxFactorFor(new Person());</span></div><div><br/></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        // then</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">        then(taxFactor).isEqualTo(FinalTaxService.DEFAULT_TAX_FACTOR);</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">    }</span></div><div><span style="font-size: 14px; font-family: &quot;Source Code Pro&quot;, monospace;">}</span></div><div><br/></div><div><span style="font-size: 14px;"><span style="font-weight: bold; font-size: 14px; color: green;">There's more...</span></span></div><div><span style="font-size: 14px;">You may ask yourself this question: how does this solution differ from the standard spy? When Mockito creates a spy, this is what occurs:</span></div><ul><li><div><span style="font-size: 14px;">The object that is wrapped with the spy is used only when the mock is created. Next, the spied instance state gets copied to the spy.</span></div></li><li><div><span style="font-size: 14px;">The spy contains all states from the spied instance.</span></div></li><li><div><span style="font-size: 14px;">When you invoke a method on the spy, it gets invoked on the spy and not on the spied instance.</span></div></li><li><div><span style="font-size: 14px;">When you call a method on a spy, and internally that method calls another method of the spy, both of them can be stubbed or you can perform the verification of execution of those methods.</span></div></li></ul><div><br/></div><div><span style="font-size: 14px;">If you use the </span><span style="font-size: 14px; color: blue;">delegatesTo(...)</span><span style="font-size: 14px;"> solution, then what happens is that you just delegate the execution from the mock to the real object. When you call a method on that mock, and internally that method calls another method of the mock, you can neither stub nor verify the method execution of that mock.</span></div><div><br/></div><div><span style="font-size: 14px;">In other words, the mock with the default answer set to </span><span style="font-size: 14px; color: blue;">delegatesTo(...)</span><span style="font-size: 14px;"> can do less than a spy. On the other hand, if you have a final class, then you will not be able to create a spy using just Mockito. To achieve this, you will need to use PowerMock, and we will discuss those cases in the next recipe.</span></div><div><br/></div><div><br/></div></td></tr></tbody></table><div><br/></div></div></span>
</div></body></html> 