<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308716 (en-US, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="454"/>

<div>
<span><div><h2><span style="font-weight: bold;">10 - Flyweight Pattern</span></h2><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="width: 846px; padding: 8px; border: 1px solid;"><div><span style="font-weight: bold;">D:   what is the gof definition of the flyweight pattern ? What you need to consider when using the flyweight pattern ?</span></div></td></tr><tr><td style="width: 846px; padding: 8px; border: 1px solid;"><div>R: Use sharing to support large numbers of fine-grained objects efficiently.</div><div>In their famous book <span style="font-style: italic;">Design Patterns: Elements of Reusable Object-Oriented Software</span> (Addison-Wesley, 1995), the Gang of Four (GoF) wrote about flyweights as follows:</div><blockquote><div><span style="font-style: italic;">A flyweight is a shared object that can be used in multiple contexts simultaneously. The flyweight acts as an independent object in each context—it’s indistinguishable from an instance of the object that’s not shared. Flyweights cannot make assumptions about the context in which they operate.</span></div></blockquote><div>When you consider flyweight pattern, you need to remember following points:</div><ul><li><div>The pattern is useful when you need a large number of similar objects that are unique in terms of only a few parameters and most of the stuffs are common in general.</div></li><li><div>A flyweight is an object. It tries to minimize memory usage by sharing data as much as possible with other similar objects. Sharing objects may allow their usage at fine granularities with minimum costs.</div></li><li><div>Two common terms are used in this context: extrinsic and intrinsic. An <span style="font-style: italic;">intrinsic</span> state is stored/shared in the flyweight object, and it is independent of flyweight’s context. On the other hand, an extrinsic state varies with flyweight’s context, which is why they cannot be shared. Client objects maintain the extrinsic state, and they need to pass this to a flyweight. Note that, if required, clients can also compute the extrinsic state on the fly when using flyweights.</div></li><li><div>Experts suggest that while implementing this pattern, we should make intrinsic states immutable.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   can you show an UML diagram of the flyweight pattern ?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: In the following example, I used three different types of objects: small, large, and fixed-size robots. These robots have two states: “robotTypeCreated” and “color”. The first one can be shared among “similar” objects, so it is an <span style="font-style: italic;">intrinsic</span> state. The second one (color) is supplied by the client and it varies with the context. So, it is an <span style="font-style: italic;">extrinsic</span> state in this example.</div><div>For the fixed-size robots, it does not matter which color is supplied by the client. For these robots, I am ignoring the extrinsic state, so you can conclude that these fixed-size robots are representing <span style="font-style: italic;">unshared flyweights</span> .</div><div>In this implementation, the robotFactory class caches these flyweights and provides a method to get them.</div><div>Lastly, these objects are similar. So, once a particular robot is created, you do not want to repeat the process from scratch. Instead, the next time onward, you will try to use these flyweights to serve your needs. Now go through the code with the comments for your ready reference.</div><div><br/></div><div>Figure <a href="https://learning.oreilly.com/library/view/java-design-patterns/9781484240786/html/395506_2_En_10_Chapter.xhtml#Fig1">10-1</a> shows the class diagram.</div><div style="text-align: center;"><img src="10 - Flyweight Pattern_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-font-smoothing: antialiased; border: 0px; height: 30.62em; max-width: 100%; vertical-align: middle; margin: 0px; padding: 2px;" width="596"/></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>D: can you show an implementation of the flyweight pattern ?</div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: </div><div>Here’s the implementation.</div><div><br/></div><div><font face="Source Code Pro">package jdp2e.flyweight.demo;</font></div><div><font face="Source Code Pro">import java.util.Map;</font></div><div><font face="Source Code Pro">import java.util.HashMap;</font></div><div><font face="Source Code Pro">import java.util.Random;</font></div><div><font face="Source Code Pro">interface Robot</font></div><div><font face="Source Code Pro">{</font></div><div><font face="Source Code Pro">   //Color comes from client.It is extrinsic.</font></div><div><font face="Source Code Pro">   void showMe(String color);</font></div><div><font face="Source Code Pro">}</font></div><div><font face="Source Code Pro">//A shared flyweight implementation</font></div><div><font face="Source Code Pro">class SmallRobot implements Robot</font></div><div><font face="Source Code Pro">{</font></div><div><font face="Source Code Pro">   /*</font></div><div><font face="Source Code Pro">    * Intrinsic state.</font></div><div><font face="Source Code Pro">    * It is not supplied by client.</font></div><div><font face="Source Code Pro">    * So, it is independent of the flyweight’s context.</font></div><div><font face="Source Code Pro">    * This can be shared across.</font></div><div><font face="Source Code Pro">    * These data are often immutable.</font></div><div><font face="Source Code Pro">    */</font></div><div><font face="Source Code Pro">   private final String robotTypeCreated;</font></div><div><font face="Source Code Pro">   public SmallRobot()</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">          robotTypeCreated=&quot;A small robot created&quot;;</font></div><div><font face="Source Code Pro">          System.<span style="font-style: italic;">out</span>.print(robotTypeCreated);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">   @Override</font></div><div><font face="Source Code Pro">   public void showMe(String color)</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.print(&quot; with &quot; +color + &quot; color&quot;);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">}</font></div><div><font face="Source Code Pro">//A shared flyweight implementation</font></div><div><font face="Source Code Pro">class LargeRobot implements Robot</font></div><div><font face="Source Code Pro">{</font></div><div><font face="Source Code Pro">   /*</font></div><div><font face="Source Code Pro">    * Intrinsic state.</font></div><div><font face="Source Code Pro">    * It is not supplied by client .</font></div><div><font face="Source Code Pro">    * So, it is independent of the flyweight’s context.</font></div><div><font face="Source Code Pro">    * This can be shared across.</font></div><div><font face="Source Code Pro">    * These data are often immutable.</font></div><div><font face="Source Code Pro">    */</font></div><div><font face="Source Code Pro">   private final String robotTypeCreated;</font></div><div><font face="Source Code Pro">   public LargeRobot()</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       robotTypeCreated=&quot;A large robot created&quot;;</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.print(robotTypeCreated);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">   @Override</font></div><div><font face="Source Code Pro">   public void showMe(String color)</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.print(&quot; with &quot; + color + &quot; color&quot;);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">}</font></div><div><font face="Source Code Pro">//An unshared flyweight implementation</font></div><div><font face="Source Code Pro">class FixedSizeRobot implements Robot</font></div><div><font face="Source Code Pro">{</font></div><div><font face="Source Code Pro">   /*</font></div><div><font face="Source Code Pro">    * Intrinsic state.</font></div><div><font face="Source Code Pro">    * It is not supplied by client.</font></div><div><font face="Source Code Pro">    * So, it is independent of the flyweight’s context.</font></div><div><font face="Source Code Pro">    * This can be shared acorss.</font></div><div><font face="Source Code Pro">    */</font></div><div><font face="Source Code Pro">   private final String robotTypeCreated;</font></div><div><font face="Source Code Pro">   public FixedSizeRobot()</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       robotTypeCreated=&quot;A robot with a fixed size created&quot;;</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.print(robotTypeCreated);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">   @Override</font></div><div><font face="Source Code Pro">   //Ingoring the extrinsic state argument</font></div><div><font face="Source Code Pro">   //Since it is an unshared flyweight</font></div><div><font face="Source Code Pro">   public void showMe(String color)</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.print(&quot; with &quot; + &quot; blue (default) color&quot;);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">}</font></div><div><font face="Source Code Pro">class RobotFactory</font></div><div><font face="Source Code Pro">{</font></div><div><font face="Source Code Pro">   static Map&lt;String, Robot&gt; <span style="font-style: italic;">robotFactory</span> = new HashMap&lt;String, Robot&gt;();</font></div><div><font face="Source Code Pro">   public int totalObjectsCreated()</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       return <span style="font-style: italic;">robotFactory</span>.size();</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">   public static synchronized Robot getRobotFromFactory(String robotType) throws Exception</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       Robot robotCategory = <span style="font-style: italic;">robotFactory</span>.get(robotType);</font></div><div><font face="Source Code Pro">       if(robotCategory==null)</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           switch (robotType)</font></div><div><font face="Source Code Pro">           {</font></div><div><font face="Source Code Pro">           case &quot;small&quot;:</font></div><div><font face="Source Code Pro">               System.<span style="font-style: italic;">out</span>.println(&quot;We do not have Small Robot at present.So we are creating a small robot now.&quot;) ;</font></div><div><font face="Source Code Pro">               robotCategory = new SmallRobot();</font></div><div><font face="Source Code Pro">               break;</font></div><div><font face="Source Code Pro">           case &quot;large&quot;:</font></div><div><font face="Source Code Pro">               System.<span style="font-style: italic;">out</span>.println(&quot;We do not have Large Robot at present.So we are creating a large robot now.&quot;);</font></div><div><font face="Source Code Pro">               robotCategory = new LargeRobot();</font></div><div><font face="Source Code Pro">               break;</font></div><div><font face="Source Code Pro">           case &quot;fixed&quot;:</font></div><div><font face="Source Code Pro">               System.<span style="font-style: italic;">out</span>.println(&quot;We do not have fixed size at present. So we are creating a fixed size robot now.&quot;);</font></div><div><font face="Source Code Pro">               robotCategory = new FixedSizeRobot();</font></div><div><font face="Source Code Pro">               break;</font></div><div><font face="Source Code Pro">           default:</font></div><div><font face="Source Code Pro">               throw new Exception(&quot; Robot Factory can create only small ,large or fixed size robots&quot;);</font></div><div><font face="Source Code Pro">           }</font></div><div><font face="Source Code Pro">           <span style="font-style: italic;">robotFactory</span>.put(robotType,robotCategory);</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">       else</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           System.<span style="font-style: italic;">out</span>.print(&quot;\n \t Using existing &quot;+ robotType +&quot; robot and coloring it&quot; );</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">       return robotCategory;</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">}</font></div><div><font face="Source Code Pro">public class FlyweightPatternExample {</font></div><div><font face="Source Code Pro">   public static void main(String[] args) throws Exception {</font></div><div><font face="Source Code Pro">       RobotFactory robotFactory = new RobotFactory();</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.println(&quot;\n***Flyweight Pattern Example ***\n&quot;);</font></div><div><font face="Source Code Pro">       Robot myRobot;</font></div><div><font face="Source Code Pro">       //Here we are trying to get 3 Small type robots</font></div><div><font face="Source Code Pro">       for (int i = 0; i &lt; 3; i++)</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           myRobot = RobotFactory.<span style="font-style: italic;">getRobotFromFactory</span>(&quot;small&quot;);</font></div><div><font face="Source Code Pro">           /*</font></div><div><font face="Source Code Pro">           Not required to add sleep().But it is included to</font></div><div><font face="Source Code Pro">           increase the probability of getting a new random number</font></div><div><font face="Source Code Pro">           to see the variations in the output .</font></div><div><font face="Source Code Pro">            */</font></div><div><font face="Source Code Pro">           Thread.<span style="font-style: italic;">sleep</span>(1000);</font></div><div><font face="Source Code Pro">           //The extrinsic property color is supplied by the client code.</font></div><div><font face="Source Code Pro">           myRobot.showMe(<span style="font-style: italic;">getRandomColor</span>());</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">       int numOfDistinctRobots = robotFactory.totalObjectsCreated();</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.println(&quot;\n Till now, total no of distinct robot objects created: &quot; + numOfDistinctRobots);</font></div><div><font face="Source Code Pro">       //Here we are trying to get 5 Large type robots</font></div><div><font face="Source Code Pro">       for (int i = 0; i &lt; 5; i++)</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           myRobot = RobotFactory.<span style="font-style: italic;">getRobotFromFactory</span>(&quot;large&quot;);</font></div><div><font face="Source Code Pro">           /*</font></div><div><font face="Source Code Pro">           Not required to add sleep().But it is included to</font></div><div><font face="Source Code Pro">           increase the probability of getting a new random number</font></div><div><font face="Source Code Pro">           to see the variations in the output.</font></div><div><font face="Source Code Pro">            */</font></div><div><font face="Source Code Pro">           Thread.<span style="font-style: italic;">sleep</span>(1000);</font></div><div><font face="Source Code Pro">           //The extrinsic property color is supplied by the client code.</font></div><div><font face="Source Code Pro">           myRobot.showMe(<span style="font-style: italic;">getRandomColor</span>());</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">       numOfDistinctRobots = robotFactory.totalObjectsCreated();</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.println(&quot;\n Till now, total no of distinct robot objects created: &quot; + numOfDistinctRobots);</font></div><div><font face="Source Code Pro">       //Here we are trying to get 4 fixed sizerobots</font></div><div><font face="Source Code Pro">       for (int i = 0; i &lt; 4; i++)</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           myRobot = RobotFactory.<span style="font-style: italic;">getRobotFromFactory</span>(&quot;fixed&quot;);</font></div><div><font face="Source Code Pro">           /*</font></div><div><font face="Source Code Pro">           Not required to add sleep().But it is included to</font></div><div><font face="Source Code Pro">           increase the probability of getting a new random number</font></div><div><font face="Source Code Pro">           to see the variations in the output.</font></div><div><font face="Source Code Pro">            */</font></div><div><font face="Source Code Pro">           Thread.<span style="font-style: italic;">sleep</span>(1000);</font></div><div><font face="Source Code Pro">           //The extrinsic property color is supplied by the client code.</font></div><div><font face="Source Code Pro">           myRobot.showMe(<span style="font-style: italic;">getRandomColor</span>());</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">       numOfDistinctRobots = robotFactory.totalObjectsCreated();</font></div><div><font face="Source Code Pro">       System.<span style="font-style: italic;">out</span>.println(&quot;\n Till now, total no of distinct robot objects created: &quot; + numOfDistinctRobots);</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">   static String getRandomColor()</font></div><div><font face="Source Code Pro">   {</font></div><div><font face="Source Code Pro">       Random r = new Random();</font></div><div><font face="Source Code Pro">       /* I am simply checking the random number generated that can be either an even number or an odd number. And based on that we are choosing the color. For simplicity, I am using only two colors-red and green</font></div><div><font face="Source Code Pro">        */</font></div><div><font face="Source Code Pro">       int random = r.nextInt();</font></div><div><font face="Source Code Pro">       if (random % 2 == 0)</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           return &quot;red&quot;;</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">       else</font></div><div><font face="Source Code Pro">       {</font></div><div><font face="Source Code Pro">           return &quot;green&quot;;</font></div><div><font face="Source Code Pro">       }</font></div><div><font face="Source Code Pro">   }</font></div><div><font face="Source Code Pro">}</font></div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">I notice some similarities between a singleton pattern and a flyweight pattern. Can you highlight the key differences between them?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: The singleton pattern helps you maintain only one required object in the system. In other words, once the required object is created, you cannot create more. You need to reuse the existing object.</div><div>The flyweight pattern is generally concerned about a large number of similar (which can be heavy) objects, because they may occupy big blocks of memory. So, you try to create a smaller set of template objects that can be configured on the fly to complete the creation of the heavy objects. These smaller and configurable objects are called flyweights. You can reuse them in your application to appear that you have many large objects. This approach helps you reduce the consumption of big chunks of memory. Basically, flyweights make one look like many. This is why the GoF tells us: <span style="font-style: italic;">A flyweight is a shared object that can be used in multiple contexts simultaneously. The flyweight acts as an independent object in each context — it’s indistinguishable from an instance of the object that’s not shared</span>.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">Can you observe any impact due to multithreading?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: If you are creating objects with new operators in a multithreaded environment, you may end up with multiple unwanted objects (similar to singleton patterns). The remedy is similar to the way you handle multithreaded environment in a singleton pattern.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">What are the</span> <span style="font-weight: bold;">advantages</span> <span style="font-weight: bold;">of using flyweight design patterns?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R:</div><ul><li><div>You can reduce memory consumptions of heavy objects that can be controlled identically.</div></li><li><div>You can reduce the total number of “complete but similar objects” in the system.</div></li><li><div>You can provide a centralized mechanism to control the states of many “virtual” objects.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">What are the</span> <span style="font-weight: bold;">challenges</span> <span style="font-weight: bold;">associated with using flyweight design patterns?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R:</div><ul><li><div>In this pattern, you need to take the time to configure these flyweights. The configuration time can impact the overall performance of the application.</div></li><li><div>To create flyweights, you extract a common template class from the existing objects. This additional layer of programming can be tricky and sometimes hard to debug and maintain.</div></li><li><div>You can see that logical instances of a class cannot behave differently from other instances.</div></li><li><div>The flyweight pattern is often combined with singleton factory implementation and to guard the singularity, additional cost is required (e.g., you may opt for a synchronized method or double-checked locking, but each of them are costly operations).</div></li></ul></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">Can I have non-shareable flyweight interface?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><b>R: </b>Yes. A flyweight interface does not enforce that it needs to always be shareable. In some cases, you may have non-shareable flyweights with concrete flyweight objects as children. In our example, you saw the use of non-shareable flyweights using fixed-size robots.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">Since intrinsic data of flyweights are the same, I can share them. Is this correct?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><b>R: </b>Yes.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span> <span style="color: rgb(0, 0, 0); font-family: &quot;Segoe UI&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: bold; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">How do clients handle the extrinsic data of these flyweights?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><b>R: </b>They need to pass the information (states) to the flyweights. Clients either manage the data or compute them on the fly.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">Extrinsic data is not shareable. Is this correct?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><b>R: </b>Yes.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">You said that I should try to make intrinsic states immutable. How can I achieve that?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><b>R: </b>Yes, for thread safety and security, experts suggest that you implement that. In this case, it is already implemented. In Java, you must remember that String objects are inherently immutable.</div><div>Also, you may notice that in the concrete flyweights (SmallRobot, LargeRobot, FixedSizeRobot), there are no setter methods to set/modify the value of robotTypeCreated. When you supply the data only through a constructor and there are no setter methods, you are following an approach that promotes immutability.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>D: <span style="font-weight: bold;">You have tagged the final keyword with the intrinsic state robotTypeCreated to achieve immutability. Is this correct?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><b>R: </b>You need to remember that <span style="font-style: italic;">final</span> and <span style="font-style: italic;">immutability</span> are not synonymous. In the context of design patterns, the word <span style="font-style: italic;">immutability</span> generally means that once created, you cannot change the state of the object. Although the keyword final can be applied to a class, a method, or a field, the aim is different.</div><div>The final field can help you construct a thread-safe immutable object without synchronization, and it provides safety in a multithreaded environment. So, I used it in this example.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">The</span> <span style="font-weight: bold;">getRobotFromFactory() method</span> <span style="font-weight: bold;">is synchronized here to provide thread safety. Is this understanding correct?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: Exactly. In a single-threaded environment, it is not required.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D:   </span><span style="font-weight: bold;">The getRobotFromFactory() method is static here. Is that mandatory?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: No. You can implement a non-static factory method also. You may often notice the presence of a singleton factory with flyweight pattern implementations.</div></td></tr></tbody></table><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 846px;"></col></colgroup><tbody><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div><span style="font-weight: bold;">D: What is the role</span> <span style="font-weight: bold;">of “RobotFactory” in this implementation?</span></div></td></tr><tr><td style="border: 1px solid rgb(204, 204, 204); width: 846px; padding: 8px;"><div>R: It caches flyweights and provides a method to get them. In this example, there are many objects that can be shared. So, storing them in a central place is always a good idea.</div></td></tr></tbody></table><div><br/></div></div></div><div><br/></div></span>
</div></body></html> 