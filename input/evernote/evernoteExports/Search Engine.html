<html>
<head>
  <title>Evernote Export</title>
  <basefont face="Segoe UI" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (it-IT, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Segoe UI;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="411"/>

<div><span><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the entry points of search engine ?</div></td></tr><tr><td><ul><li><div style="text-align:justify;margin-bottom:10px;"><b>OF</b> (search, searchRoomAvailability, getAccommodationDetail)</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b>MAPI</b> (search)</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b>edreams-site</b> (getSearchResults)</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What are the dependencies with other modules of search engine ?</div></td></tr><tr><td><ul><li><div style="text-align:justify;margin-bottom:10px;">VisitEngine</div></li><li><div style="text-align:justify;margin-bottom:10px;">GeoService</div></li><li><div style="text-align:justify;margin-bottom:10px;">ItineraryGateway</div></li><li><div style="text-align:justify;margin-bottom:10px;">AccommodationGateway</div></li><li><div style="text-align:justify;margin-bottom:10px;">PricingEngine</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What are the database dependencies of search engine ?</div></td></tr><tr><td><ul><li><div style="text-align:justify;margin-bottom:10px;">Oracle</div></li><li><div style="text-align:justify;margin-bottom:10px;">Cassandra</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of Itinerary Gateway, its purpose and the classes involved ?</div></td></tr><tr><td><div style="text-align:justify;"><b><span style="color: rgb(0, 0, 0);">ItineraryGateway (IG)</span></b><span style="color: rgb(0, 0, 0);"> is a module from </span><b><span style="color: rgb(0, 0, 0);">Suppliers Team</span></b><span style="color: rgb(0, 0, 0);"> and its main responsibility (from SearchEngine point of view) is to </span><b><span style="color: rgb(0, 0, 0);">perform itinerary searches against providers</span></b><span style="color: rgb(0, 0, 0);">.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The classes involved in the connection and usage of ItineraryGateways are:</span></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;"><b><i>ItineraryGatewayController</i></b>: controller for ItineraryGateway service</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>ItineraryGatewayRequestConverter</i></b>: converter that converts the <i>ItineraryGatewaySearchCriteria</i> objects from SE domain, to <i>ItinerarySearchRequest</i> objects of IG domain. It is used in <i>ItineraryGatewayController</i> to obtain the request for IG service.</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>ItineraryGatewayResultsConverter</i></b>: converter that converts the <i>ItinerarySearchResult</i> object from IG domain to <i>ItineraryGatewaySearchResultsItem</i> object of SE domain. It is used in <i>ItineraryGatewayController</i> to convert the results of IG service.</div></li></ul><div style="text-align:justify;"><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The </span><i><span style="color: rgb(0, 0, 0);">ItineraryGatewayController</span></i><span style="color: rgb(0, 0, 0);"> uses an instance of </span><b><i><span style="color: rgb(0, 0, 0);">ItineraryGatewayApiService</span></i></b><span style="color: rgb(0, 0, 0);">. This instance is configured using the new procedure introduced in new rest-utils version. The properties </span><b><span style="color: rgb(0, 0, 0);">ItineraryGatewayApiService.properties</span></b><span style="color: rgb(0, 0, 0);"> in </span><i><span style="color: rgb(0, 0, 0);">com/odigeo/rest/utils/url/configuration</span></i><span style="color: rgb(0, 0, 0);"> defines the endpoint of the service. The service is registered in the </span><i><span style="color: rgb(0, 0, 0);">ContextListener</span></i><span style="color: rgb(0, 0, 0);"> class, and a default </span><i><span style="color: rgb(0, 0, 0);">ServiceConfiguration</span></i><span style="color: rgb(0, 0, 0);"> is specified. Then, the service can be injected in any class of the project when required, as it is done in </span><i><span style="color: rgb(0, 0, 0);">ItineraryGatewayController</span></i><span style="color: rgb(0, 0, 0);">.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of Accomodation Gateway, its purpose and the classes involved ?</div></td></tr><tr><td><div style="text-align:justify;"><b><span style="color: rgb(0, 0, 0);">AccommodationGateway (AG)</span></b><span style="color: rgb(0, 0, 0);"> is a module from </span><b><span style="color: rgb(0, 0, 0);">Vacations Team</span></b><span style="color: rgb(0, 0, 0);"> and its main responsibility (from SearchEngine point of view) is to </span><b><span style="color: rgb(0, 0, 0);">perform accommodation searches against providers</span></b><span style="color: rgb(0, 0, 0);">.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The classes involved in the connection and usage of AccommodationGateways are:</span></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;"><b><i>AccommodationGatewayController</i></b>: controller for AccommodationGateway service</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>AccommodationGatewayRequestConverter</i></b>: converter that converts the <i>ItineraryGatewaySearchCriteria</i> objects from SE domain, to <i>AccommodationDealsRequest</i> objects of AG domain. It is used in <i>AccommodationGatewayController</i> to obtain the request for AG service.</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>AccommodationGatewayResultsConverter</i></b>: converter that converts the <i>AccommodationDeals</i> object from IG domain to <i>AccommodationGatewaySearchResultsItem</i> object of SE domain. It is used in <i>AccommodationGatewayController</i> to convert the results of AG service.</div></li></ul><div style="text-align:justify;"><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">Besides the search operation, the </span><i><span style="color: rgb(0, 0, 0);">AccommodationGatewayController</span></i><span style="color: rgb(0, 0, 0);"> also supports </span><b><span style="color: rgb(0, 0, 0);">retrieveAccommodationDetail</span></b><span style="color: rgb(0, 0, 0);"> and </span><b><span style="color: rgb(0, 0, 0);">retrieveRoomDeals</span></b><span style="color: rgb(0, 0, 0);">.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The </span><i><span style="color: rgb(0, 0, 0);">AccommodationGatewayController</span></i><span style="color: rgb(0, 0, 0);"> uses an instance of </span><b><i><span style="color: rgb(0, 0, 0);">AccommodationGatewaySearchService</span></i></b><span style="color: rgb(0, 0, 0);">. This instance is configured using the new procedure introduced in new rest-utils version. The properties </span><b><span style="color: rgb(0, 0, 0);">AccommodationGatewaySearchService.properties</span></b><span style="color: rgb(0, 0, 0);"> in </span><i><span style="color: rgb(0, 0, 0);">com/odigeo/rest/utils/url/configuration</span></i><span style="color: rgb(0, 0, 0);"> defines the endpoint of the service. The service is registered in the </span><i><span style="color: rgb(0, 0, 0);">ContextListener</span></i><span style="color: rgb(0, 0, 0);"> class, and a default </span><i><span style="color: rgb(0, 0, 0);">ServiceConfiguration</span></i><span style="color: rgb(0, 0, 0);"> is specified. Then, the service can be injected in any class of the project when required, as it is done in </span><i><span style="color: rgb(0, 0, 0);">AccommodationGatewayController</span></i><span style="color: rgb(0, 0, 0);">.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of the Price Engine, its purpose and the classes involved ?</div></td></tr><tr><td><div style="text-align:justify;"><b><span style="color: rgb(0, 0, 0);">PricingEngine (PE)</span></b><span style="color: rgb(0, 0, 0);"> is a module from </span><b><span style="color: rgb(0, 0, 0);">Revenue/Pricing Team</span></b><span style="color: rgb(0, 0, 0);"> and its main responsibility (from SearchEngine point of view) is to </span><b><span style="color: rgb(0, 0, 0);">apply the correct pricing to the search results</span></b><span style="color: rgb(0, 0, 0);"> obtained by search-engine.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The classes involved in the connection and usage of PricingEngine are:</span></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;"><b><i>FaresController</i></b>: generic controller for PricingEngine service</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>FareItineraryFaresController</i></b>: controller for PricingEngine service for product itinerary</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>FareAccommodationFaresController</i></b>: controller for PricingEngine service for product accommodation</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>PricingServiceMapper</i></b>: generic mapper that converts the requests objects from SE domain to requests objects of PE.</div></li><li><div style="text-align:justify;margin-bottom:10px;"><b><i>ItineraryPricingServiceMapper</i></b>: mapper that generates the <i>ItineraryRequest</i> object of PE domain from the searchCriteria and results of SE domain. It is used in <i>FareItineraryFaresController</i> and <i>FareAccommodationFaresController</i> to create the requests for PricingEngine service.</div></li></ul><div style="text-align:justify;"><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The </span><i><span style="color: rgb(0, 0, 0);">FareItineraryFaresController</span></i><span style="color: rgb(0, 0, 0);"> and </span><i><span style="color: rgb(0, 0, 0);">FareAccommodationFaresController</span></i><span style="color: rgb(0, 0, 0);"> use instances of </span><b><i><span style="color: rgb(0, 0, 0);">PricingEngineApiService</span></i></b><span style="color: rgb(0, 0, 0);">. This instance is configured using the new procedure introduced in new rest-utils version. The properties </span><b><span style="color: rgb(0, 0, 0);">PricingEngineApiService.properties</span></b><span style="color: rgb(0, 0, 0);"> in </span><i><span style="color: rgb(0, 0, 0);">com/odigeo/rest/utils/url/configuration</span></i><span style="color: rgb(0, 0, 0);"> defines the endpoint of the service. The service is registered in the </span><i><span style="color: rgb(0, 0, 0);">ContextListener</span></i><span style="color: rgb(0, 0, 0);"> class, and a default </span><i><span style="color: rgb(0, 0, 0);">ServiceConfiguration</span></i><span style="color: rgb(0, 0, 0);"> is specified. Then, the service can be injected in any class of the project when required, as it is done in </span><i><span style="color: rgb(0, 0, 0);">FareItineraryFaresController</span></i><span style="color: rgb(0, 0, 0);"> and </span><i><span style="color: rgb(0, 0, 0);">FareAccommodationFaresController</span></i><span style="color: rgb(0, 0, 0);">.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of how visit engine works ?</div></td></tr><tr><td><div style="text-align:justify;"><span style="color: rgb(51, 51, 51);">Currently initSession dapi request must be called as first step in the booking flow. With modularization flow the visit must be created in VisitEngine before calling any dapi request.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(51, 51, 51);">The visit data is stored as a serialized string called visitInformation since there is not a visit storage yet. This parameter is currently built in VisiEngine from a OF request, passed inside the search request, saved in Cassandra searchResults storage and retrieved from edreams-site selection step. In the future this parameter will be included in selection dapi request.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(51, 51, 51);">The visitInfomation value is used to get all visit data calling new visitEngine module.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of the search engine module and its competencies ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Search will be performed before calling edreams-site dapi. Once the search is done, we will call from edreams-site to he new searchEngine module to retrieve the search results of a given searchId. The searchId is included in the dapi selection request.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(0, 0, 0);">For hotel products, the searchEngine module manages search, search room availability and get accommodation detail operations. When edreams-site call the searchEngine module the search results retrieved contains all information related to the hotel (search results and room availability)</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Search engine contract (searchengine-api) will be included as a dependency of edreams-site. The version of this project is related to the version of the searchengine project deployed where the search is done.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you explain the differences with the original dapi search and the new one where modularization is involved within the booking flow process ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">With modularization we are replacing InitSession and Search dapi requests of edreams-site.</span></div><ul><li><div>Basic dapi booking flow: InitSession, Search, CreateShoppingCart, AddPersonalInfo, ConfirmBooking</div></li><li><div>Modularization basic dapi flow: CreateShoppingCart, AddPersonalInfo, ConfirmBooking</div></li></ul><div><br/></div><img src="Search Engine_files/image.png" type="image/png" data-filename="image.png"/></td></tr></tbody></table><div style="text-align:start;"><b><span style="color: rgb(23, 43, 77);"><span style="--en-markholder:true;"><br/></span></span></b></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you explain the initSession step of the booking flow process ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">InitSession</span></b></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">There is some information related to the booking process stored in the http session (testTokenSet, interfaceClient, marketingPortal, website, locale...) in the initSession step. This point will be moved to createShoppingCart step since this information will come from the visitEngine. From searchResult we will get the visitInformation and we will call VisitEngine module.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Visit must be initilized in VisitEngine module before calling edreams-site.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">If the visit can't be retrieved from the VisitEngine the booking flow is stopped.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you explain the search step of the booking flow process ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">Search</span></b></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Search must be performed before calling edreams-site dapi and it will be retrieved from the search results storage (Cassandra) when we call to edreams-site dapi. The search result will remain in the storage for a limited period of time.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">If the searchId can't be retrieved from the SearchEngine the booking flow is stopped.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the createShoppingCart step of the booking flow process ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">CreateShoppingCart</span></b></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">The first dapi call to edreams-site in a basic dapi booking flow is the CreateShoppingCart. This request must contain a searchId from a search performed in the searchEngine module.</span></div><div><br/></div><ul><li><div>This dapi step builds the shoppingCart. The shoppingCart contains shoppingItems with itineraries/accommodations created from the search step.</div></li><li><div>Currently itinerary/acccommodation objects contains data related to the search, product building and extra data needed for selection and next steps.</div><div><br/></div></li><li><div>In modularization project we define the itinerary/accommodation data required to complete a booking from selection flow. All the information related to search will be removed.</div></li><li><div>Currently old dapi search flow and modularization search flow will coexists, so old model has to be maintained.</div></li><li><div>The selection booking flow is the same for dapi search and searchEngine search, the search results model is also the same for both modules. It produces we are mapping searchEngine result to old dapi model.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the requestFareLocker step in the booking flow process ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">RequestFareLocker </span></b></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">In this step it's also performed a selection of the itinerary to check if repricing is produced against provider and the repriced itinerary is used to build lock api request.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">RequestFareLocker can be also the first call to edreams-site dapi if there is a trip lock. The same validations and session settings must be done as it's in createShoppingCart. </span></div></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you exaplin the RegisterUserLoginOperation step of the booking flow process</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">RegisterUserLoginOperation</span></b></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">This dapi operation can be called at any moment of the dapi booking flow and it sets the userLoginId in the baseSession, the searchHandler and in the shoppingCart if exists. In modularization flow we only need to set this parameter to session and shoppingCart.</span></div></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What could be the possible next step in the booking flow process ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(0, 51, 102);">Possible next steps</span></b></div><div><br/></div><ul><li><div>Delete InitSession and Search dapi operations</div></li><li><div>Refactor current FareItinerary model of edeams-site: FareItinerary and Itinerary model is currently connected. In the future the FareItineary model will be simplified and not connected with Itinerary</div></li><li><div>Refactor search criteria object and reduce its usage in edreams-site</div></li><li><div>Identity and delete edreams-site objects related to search domain <span style="color: rgb(0, 51, 102);">after dapi search operation will be deleted.</span></div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is the operation of search engine that is called from edreams-site ? What does it contain ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">SearchEngine operation called from edreams-site is getSearchResults. This operation returns the results of a previous search in search-engine and this response is defined in the search-engine-api project. The model of this project is based on the current SearchResults model in edreams-site. It contains the searchCriteria and a reduction of the FareItinerary model for flights and the AccommodationSearchResultItem for hotels.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the constraints that search engine has related to edreams-site and its model ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">SearchEngine model has to be mapped to edreams-site model. The mapping process is done using mapping apis (dozer, orika). In e</span><span style="color: rgb(0, 51, 102);">dreams-site c</span>urrently we can find<span style="color: rgb(0, 51, 102);"> some classes defined to be instantiated for concrete usages with a specific constructor or builder, so we can find some problems to do a mapping against edreams-site model. </span>To solve mappings problems we have to use the customization options of the mapping api. You can find all mapping customization classes at com.odigeo.util.orika.converters package.</div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">We started this mappings with dozer api and changed to orika api due to a performance optimization.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(0, 51, 102);"><span style="--en-markholder:true;"><br/></span></span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is a search criteria ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(0, 51, 102);">SearchCriteria: The searchCriteria is part of the searchResults. It's built in searchEngine and it's also used in lots of points in all the steps of the booking flow. In addition, it is duplicated in several classes of edreams-site. To reduce the storage size un Cassandra it is defined only once in search-engine model and in edreams-site it is created in a post mapping proccess to populate all the information in the objects of the searchResults that it's needed.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>hwo can be used the data created in the search step ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(0, 51, 102);">In modularization flow, when we create data in search step and we need to use this data in selection step we have two options to use this .</span></div><div><br/></div><ul><li><div>Create the data in search step and recreate the same data in selection step. Example: insurances in hubFareItineary.</div></li><li><div>Create the data in search, add it to searchEngine storage and map to edreams-site.</div></li></ul><div><br/></div><div style="text-align:start;"><span style="color: rgb(0, 51, 102);">The data modified in selection or nexts steps in edreams-site can't be used in search searchEngine. This case can be produced, for example, if user comes back to search after a failed selection.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is the job of itineraryGateway during the search step ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Search and selection steps are done with Itinerary gateways integration (IG). Search in SearchEgine produces a fareItinerary object that contains an attribute called fareProviderItineraryId representing the model of the IG module that is needed in the next booking steps against the provider. The creation of the ItineraryShoppingItem from the fareItineary is done by calling the IG module with this fareProviderItineraryId. The result of IG selection call will provide all the information to build an itineraryShoppingItem of edreams-site.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">From selection step, next dapi steps must follow the same behavior.</span></div></td></tr></tbody></table><div><br/></div><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is the metasearch repricing and why it's done ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">In first release of modularization project metasearch flow is not going to change to reduce the impact in frontend side. In the future, the flow will be reduced by deleting the second search from frontend to edreams-site because we will try to do the selection directly with the first search from mapi. This change have to be analyzed because it can impact in metasearch repricing and also the impact in the storage to maintain mapi searchresult.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Following the same flow as we do currently we have to check also the repricing in selection step between the selected fareItineary and the itinerary created in the shoppingCart. This repricing with dapi search flow is calculated from data stored in MetasearchEngineSelectionHelper object. In modularization we can't access this object since it's part of dapi search searchHandler, so we need to add some information of first mapi search (searchId, partnerWebsite, selectedItineraryIndex...) from the searchEngine to edreams-site. This data is included in MetasearchClickoutInfo object inside searchCriteria.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);"> </span></div><div><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184569611/metasearch%20seq.jpg?version=3&amp;modificationDate=1501598794000&amp;api=v2"></img></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the different implementations of the sessionHandler ? Can you write an UML diagram ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">SessionHandler &amp; SearchHandler refactor</span></b></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);"> </span></div><div><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184569611/diagram%20sessionHandler.png?version=1&amp;modificationDate=1504186141000&amp;api=v2"></img><div><br/></div><div style="text-align:start;"><br/></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">Now we have different SearchHandlers from dapi search and searchEngine module search. Implementations of AbstractSearchHandler are dapi searchHandlers in charge of searching and managing search results (old dapi search). Implementations of AbstractSearchResultsHandler are only responsible of manage search results (modularization flow).</span><span style="color: rgb(0, 0, 0);"> In the future when old dapi search will be deprecated all the classes related to dapì search will be removed.</span></div><div><br/></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);"> </span></div><div><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184569611/diagramSearchHandler.png?version=2&amp;modificationDate=1504175290000&amp;api=v2"></img><div style="text-align:start;"><span style="color: rgb(51, 51, 51);"> </span></div></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how search engine checks if a session is expired ?</div></td></tr><tr><td><div style="text-align:start;"><b><span style="color: rgb(51, 51, 51);">Expired session</span></b></div><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">In dapi search flow a sessionHandler is defined as an attribute of the session and we check this session attribute exists for detecting not expired sessions in next dapi steps. InitSession dapi request sets this session attribute so it must be called always before other dapi requests. In modularization the session will be initialized in createShoppingCart dapi request and we will use the searchResultsContainer session attribute to do this check.</span></div></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>How can we add a new parameter to the getSearchResults response ?</div></td></tr><tr><td><div style="text-align:justify;"><a href="https://jira.odigeo.com/wiki/display/KB/How+to+add+new+parameters+to+getSearchResults+response" rev="en_rl_none">How to add new parameters to getSearchResults response</a></div><div style="text-align:start;"><br/></div><div><br/></div><div><br/></div><div style="text-align:justify;">When new parameters are added in search results and they are necessary in steps after search (selection, booking…), these parameters should be added to the <b>getSearchResults</b> response. These are the steps to follow:</div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">The new parameter/class should be added in the <b>search-engine internal module</b>. The internal-module is used internally in the search-engine. Note that any new parameter outside the SearchEngine domain will have to be returned by other modules such as ItineraryGateway, AccommodationGateway, PricingEngine… in this case, the parameter should be mapped into the internal model using the existing results converters for each module (see <a href="https://jira.odigeo.com/wiki/display/KB/Connection+with+other+modules" rev="en_rl_none">Connection with other modules</a>). If the parameter belongs to the search-engine domain, then it can be directly added to the internal module.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">The changes in the internal model should be replicated in the <b>Cassandra storage model</b>. This model can be found under the package <i>com.odigeo.searchengine.searchresults</i>. Use the same package structure and names for the classes in the storage model.</div></li></ul><div><br/></div><ul><li><div><u>Serializer classes should be modified according to changes in cassandra storage model. Serializers can be found under the package </u><i><u>com.odigeo.util.serialization.serializer.storage.</u></i><u>(see </u><a href="https://jira.odigeo.com/wiki/display/KB/Modify+cassandra+storage+serializers" rev="en_rl_none"><u>Modify cassandra storage serializers</u></a><u>)</u></div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">If new classes have been added to the storage model, these classes should be added to the properties file <b>serializator.properties</b> in <i>com/odigeo/util/serialization</i> of <i>model-layer</i> in <i>search-engine</i> project.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">The Orika mapping defined in <b><i>SearchResultsStorageTranslator</i> </b>should be modified as required to adapt the changes done. Note that the definition of the mapping for this translator are actually in the <i>SearchResultsStorageMapper</i> class.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">After adapting the <i>SearchResultsStorageTranslator</i>, adapt also the <b><i>SearchResultsStorageTranslatorTest</i></b><i> </i>that checks the integrity and correctness of the mapping.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">In <i>search-engine-api</i> project modify the <b>model of the search-engine-api client</b> in <i>contract</i> module. Replicate the changes done in the storage model to the GetSearchResults model found under package <i>com.odigeo.searchengine.v1.searchresults</i> of <i>contract</i> module in <i>search-engine-api</i> project.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">After modifying the GetSearchResults model, modify also the <b>mock builders</b> in search-engine-api project: the same modifications done in classes of the contract should be done in the builder classes of the mock module in search-engine-api.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">Again in search-engine project, modify the <b>mapping between storage model and GetSearchResults model</b> to adapt your changes. This mapping is done by the <b><i>SearchResultsClientTranslator</i></b><i> </i>class, with the actual mappings defined in the <i>SearchResultsClientMapper</i>.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">If your changes modify classes of accommodation, there is an extra step to be done. The mapping implemented in <b><i>StorageToSearchResultsTranslator</i></b><i> </i>class, with the actual mappings in <i>StorageToSearchResultsMapper</i>, should be also modified to adapt the changes.</div></li></ul><div style="text-align:justify;"><br/></div><div style="text-align:start;"><br/></div><div style="text-align:justify;">NOTA BENE: Any new parameter added to DAPI should be added as well to the Search-Engine response.</div></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how can we  add a new parameter to the searchEngine response ?</div></td></tr><tr><td><div style="text-align:justify;">Any new parameter added to DAPI should be added as well to the Search-Engine response. To add a new parameter to search-engine SOAP response, follow these steps:</div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">Modify the Client model in search-engine-api project: add or modify the required parameters in the Client model, which can be found in<i> com/odigeo/searchengine/v1/responses</i> and <i>com/odigeo/searchengine/v1/requests</i> of <i>contract</i> module in <i>search-engine-api</i> project. Take into account that the correponding XML annotations should be added, as they are required to convert the classes of the contract to the XML response.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">Modify the mock builders in search-engine-api project: the same modifications done in classes of the contract should be done in the builder classes of the mock module in search-engine-api.</div></li></ul><div style="text-align:justify;"><br/></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">Add or modify the converters in search-engine project: the classes implementing the interface <i>com.odigeo.searchengine.v1.convert.Converter</i> are the classes that convert the internal model of search-engine to the Client model. The changes done in the Client model should be adapted in the corresponding adapters. If an existing parameter have been modified in an existing class, find the converter of the existing class and add the mapping for the new parameter. If a new parameter have been added in an existing class, find the converter of the existing class and add the mapping for the new parameter. If a new class have been added, create a new converter to convert the new class from the internal model to the Client model. Then use this converter in the required class, which might be in another converter or in a class that directly populates the response.</div></li></ul></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the methods that a client can do with the platform ?</div></td></tr><tr><td><div style="text-align:start;">As detailed in parent page, this client will offer to edreams-site and other search engine service consumers the following methods.</div><div><br/></div><ul><li><div>search:</div></li><ul><li><div>In search engine service, port search operation taking into account that it must store all data later needed by new SearchHandler implementations (see below), so this data can be used later when calling GetSearchResults</div></li></ul></ul><div><br/></div><ul style=""><ul><li><div>In edreams-site, modify all CreateShoppingCart.createSelectionHandler methods:</div></li><ul><li><div>Depending on A/B active (new module in use or not), assign to selectionHandler a new instance of a new class inheriting from current final implementations of SelectionHandler:</div></li><ul><li><div>Discuss whether SelectionHandler.cancelPreviousShoppingCartOrBookingIfCanBeCancelled should be implemented or not.</div></li><li><div>Implement SelectionHandler.select as follows. THIS CAN BE DONE IN WAVES IF WE START SENDING SEARCH RESULTS OF APPROPRIATE KIND TO CASSANDRA.</div></li><ul><li><div>Port implementation of ItinerarySelectionHandler but SearchHandler will be a new subtype of ItineraryWebSearchHandler that will retrieve search results on demand from Search Engine service.</div></li><ul><li><div>That new subtype will override appropriate methods, such as getFilterItinerariesResult, getItineraryPriceEstimationHelper, getSearchResults, createExtraSearchData, getUserIp, getProxyIp, getMetasearchEngineSelectionHelper, getItinerarySelectionRequest, getSearchSelectionRequest</div></li></ul><li><div>Port implementation of AccommodationSelectionHandler but SearchHandler will be a new subtype of AccommodationSelectionHandler that will retrieve search results on demand from Search Engine service:</div></li><ul><li><div>That new subtype will override appropriate methods, such as <b>getRoomGroupDealList</b>, getAccommodationSearchCriteria, createExtraSearchData, getSearchResults, getUserIp, getProxyIp, processSelectionError.</div></li><li><div>getRoomGroupDealList currently is populated from searchRoomAvailability call. </div></li><li><div> We should make sure we keep data integrity here.</div></li></ul><li><div>Port implementation of DynPackSelectionHandler but SearchHandler will be a new subtype of DynPackSearchHandler that will retrieve search results on demand from Search Engine service:</div></li><ul><li><div>That new subtype will override appropriate methods, such as getSearchCriteria, createItineraryExtraSearchData, getSearchResults, getRoomGroupDealList, processSelectionError, getOriginalItineraryResults, getPreSelectedFareItinerary.</div></li></ul><li><div>Port implementation of UpsellDynpackSelectionHandler but SearchHandler's will be a new subtype of ItineraryWebSearchHandler and AccommodationSearchHandler that will retrieve search results on demand from Search Engine service:</div></li><ul><li><div>These new subtypes will override appropriate methods as detailed in previous points. </div></li></ul></ul></ul></ul></ul></ul><div><br/></div><ul><li><div>searchRoomAvailability:</div></li><ul><li><div>In search engine service, port searchRoomAvailability from edreams-site and store the results. </div></li><li><div> Pending to define how to retrieve these stored results, in a single call to GetSearchResults or with an additional call to another new method (GetRoomAvailabilityResults). </div><div><br/></div></li></ul><li><div>getAccommodationDetails:</div></li><ul><li><div>In search engine service, port getAccommodationDetails from edreams-site.</div><div><br/></div></li></ul><li><div>GetSearchResults:</div></li><ul><li><div>In search engine service, this method should return all data stored for the search (see above). This data is required to do a createShoppingCart.</div></li></ul></ul></td></tr></tbody></table><h1 style="text-align:justify;"></h1><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the differences within the internal model of search engine and the model of edsite ?</div></td></tr><tr><td><div style="text-align:justify;"><b>Internal model</b></div><div style="text-align:justify;">Model that SE uses internally in its server-side implementation. This model describes the structure of itinerary and accommodation requests and results in search time. It is similar to the model in edreams-site. The main difference is that SE model does not know about “provider” concepts, because they do not belong to the SE domain (they belong to ItineraryGateway domain). More specifically, the class FareProviderItinerary and its implementations of edreams-site are equivalent to a single class in SE: <b>ItineraryGatewaySearchResultsItem</b>. The same happens at Segment and Section level, where only one class is used in SE: ItineraryGatewaySegment and ItineraryGatewaySection respectively.</div><div><br/></div><div style="text-align:justify;">The classes of the internal model can be found (mostly) in the packages</div><ul><li><div>com.odigeo.product.itinerary.searchengine</div></li><li><div>com.odigeo.searchengine</div></li></ul><div style="text-align:justify;">of <i>model-layer</i> in <i>search-engine </i>project.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you explain the role of the cassandra storage system and its model ?</div></td></tr><tr><td><div style="text-align:justify;"><b>Cassandra Storage model</b></div><div style="text-align:justify;">Model used to store the search results in the <b>Cassandra</b> database. This model is more simplified than the internal model, as it only contains the information required to perform a selection on the search results. This model uses representations of objects rather than the whole object when possible (i.e. id instead of the object).</div><div><br/></div><div style="text-align:justify;">The classes of the cassandra storage model can be found in the package</div><div><br/></div><ul><li><div>com.odigeo.searchengine.searchresults</div><div><br/></div></li></ul><div style="text-align:justify;">of <i>model-layer</i> in  <i>search-engine </i>project.</div><div><br/></div><div style="text-align:justify;">Once search operation is done and the search results are ready, these results are stored in Cassandra database. The results of search operation in SE are defined by the internal model. The internal model is converted to Cassandra storage model using Dozer. This conversion is implemented in the following class: <b>SearchResultsStorageTranslator</b></div><div><br/></div><div style="text-align:justify;">In some operations of SE, such as searchRoomAvailability and getAccommodationDetail, it is necessary to obtain the search results from Cassandra to perform the operation and calculate the response. The operations need the search results defined by the internal model, as the SE implementation uses the internal model. The Cassandra Storage model is converted to the internal model using Dozer. This conversion only applies for accommodation, since it is never necessary to do such conversion for itinerary classes. It is implemented in the following class: <b>StorageToSearchResultsTranslator</b></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the model of the getSearchResults operation ?</div></td></tr><tr><td><div style="text-align:justify;"><b>GetSearchResults model</b></div><div style="text-align:justify;">Model used in the getSearchResults operation response. This model describes the results of a search and contains all the necessary information to perform a selection on that search, and it is defined in the search-engine-api contract. It is exactly (or almost exactly) the same as Cassandra Storage model. This was the approach taken in the first version of SE, but these models do not need to be the same in the future.</div><div><br/></div><div style="text-align:justify;">The classes of GetSearchResults model can be found in the package</div><div><br/></div><ul><li><div>com.odigeo.searchengine.v1</div></li></ul><div style="text-align:justify;">of <i>search-engine-contract</i> module in <i>search-engine-api</i> project.</div><div><br/></div><div style="text-align:justify;">To obtain the search results to be returned in the getSearchResults operation, SE gets the search results from Cassandra and converts them to the GetSearchResults model. This conversion is done using Dozer and it is implemented in the following class: <b>SearchResultsClientTranslator</b></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the client model ?</div></td></tr><tr><td><div style="text-align:justify;"><b>Client model</b></div><div style="text-align:justify;">Model used in SOAP responses of search, searchRoomAvailabilty and getAccommmodationDetail operations. This model is equals to the model used by DAPI (v25) in its responses.</div><div><br/></div><div style="text-align:justify;">The classes of Client model can be found in the packages</div><div><br/></div><ul><li><div>com.odigeo.searchengine.v1.requests</div></li><li><div>com.odigeo.searchengine.v1.responses</div></li></ul><div style="text-align:justify;">of <i>search-engine-contract</i> module in <i>search-engine-api</i> project.</div><div><br/></div><div style="text-align:justify;">Again, the operation of SE work internally with the internal model. When using SOAP operations, the internal model needs to be converted to Client model to create the responses. This conversion is done “manually” using<b> “converter” classes</b> (classes implementing the interface com.odigeo.searchengine.v1.convert.Converter). These converters can be found in the package com.odigeo.searchengine.v1.convert of web-layer in search-engine project.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you write the diagram of the various models used in the platform ? How are they related between each other ?</div></td></tr><tr><td><div><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184555900/SE%20models.png?version=1&amp;modificationDate=1498827897000&amp;api=v2"></img></td></tr></tbody></table><div><br/></div><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the various operations of search engine ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(51, 51, 51);">SEARCH ENGINE OPERATIONS:</span></div><div style="text-align:justify;"><b><span style="color: rgb(0, 0, 0);">Search Engine (SE)</span></b><span style="color: rgb(0, 0, 0);"> is a module of </span><b><span style="color: rgb(0, 0, 0);">CORE Team</span></b><span style="color: rgb(0, 0, 0);"> and its responsibility is to perform the “Search” operation that was implemented in DAPI. It supports Itinerary, Dynpack and Accommodation Search. The old DAPI operation that are implemented in SE are:</span></div><div><br/></div><ul><li><div style="text-align:justify;margin-bottom:10px;">Search (itinerary, accommodation, dynpack)</div></li><li><div style="text-align:justify;margin-bottom:10px;">SearchRoomAvailabilty</div></li><li><div style="text-align:justify;margin-bottom:10px;">GetAccommodationDetail</div></li></ul><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The operations SearchRoomAvailabilty and GetAccommodationDetail of SE are the same than DAPI operations. The Search operation offers the same functionality that DAPI Search operation, but excluding</span></div><ul><li><div style="text-align:justify;margin-bottom:10px;">QA Mode</div></li><li><div style="text-align:justify;margin-bottom:10px;">TestConfiguration</div></li></ul><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">which are not available in the first version of the module.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how does search engine manage the session data ?</div></td></tr><tr><td><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">Unlike DAPI, Search Engine </span><b><span style="color: rgb(0, 0, 0);">does not maintain a session for the search</span></b><span style="color: rgb(0, 0, 0);"> operation (there is no InitSession operation in SE). However, it is necessary to pass a </span><b><span style="color: rgb(0, 0, 0);">VisitInformation</span></b><span style="color: rgb(0, 0, 0);"> object in the request to be able to perform the search.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">The VisitInformation is an object given by the </span><a href="https://jira.odigeo.com/wiki/display/DEV/Visit+Engine+Overview" rev="en_rl_none"><span style="color: rgb(0, 82, 204);">VisitEngine </span></a>module in the response of InitializeVisit operation, and it contains the information of the visit. It is reusable, so you can use the same VisitInformation object for multiple searches.</div><div><br/></div><div style="text-align:justify;"><br/></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">SE offers the operations in SOAP protocol to reduce the complexity of migrating from DAPI client to SearchEngine client.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">SE also offers the operations (search, searchRoomAvailability, getAccommodationDetail) in REST protocol.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">A new REST operation has been added: </span><b><span style="color: rgb(0, 0, 0);">getSearchResults</span></b><span style="color: rgb(0, 0, 0);">. This operation returns the results of a search identified by searchId.</span></div><div><br/></div><div style="text-align:justify;"><span style="color: rgb(0, 0, 0);">To use the mentioned operations in SOAP and REST protocols, SOAP client and REST client are implemented.</span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of the steps involved when performing a search in the search engine module ?</div></td></tr><tr><td><div style="text-align:start;"><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184555894/SearchEngine%20search%20flow%20extended.png?version=1&amp;modificationDate=1501667528000&amp;api=v2"></img></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of the various steps when eprforming a getAccomodationDetail operation ?</div></td></tr><tr><td><div style="text-align:start;"><span style="color: rgb(0, 0, 0);"><span style="--en-markholder:true;"><br/></span></span></div><img src="https://jira.odigeo.com/wiki/download/attachments/184555894/SearchRoomAvailability.png?version=1&amp;modificationDate=1501667544000&amp;api=v2"></img><div style="text-align:start;"><br/></div><div style="text-align:start;"><br/></div><div style="text-align:start;"><br/></div><div style="text-align:start;"><br/></div><div><span style="color: rgb(0, 0, 0);"> </span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of the various steps while proforming the searchRoomAvailability operation ?</div></td></tr><tr><td><div><span style="color: rgb(0, 0, 0);"> </span></div><div><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184555894/GetAccommodationDetails.png?version=1&amp;modificationDate=1501667544000&amp;api=v2"></img><div style="text-align:start;"><br/></div><div style="text-align:start;"><br/></div><div style="text-align:start;"><br/></div><div><span style="color: rgb(0, 0, 0);"> </span></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an explanation of the steps involved in the getSearchResults operation ?</div></td></tr><tr><td><div><span style="color: rgb(0, 0, 0);"><span style="--en-markholder:true;"><br/></span></span></div><div><span style="color: rgb(0, 0, 0);"> </span></div><div><br/></div><img src="https://jira.odigeo.com/wiki/download/attachments/184555894/GetSearchResults%20%282%29.png?version=1&amp;modificationDate=1501667543000&amp;api=v2"></img></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you list the various step of the itinerary search flow ?</div></td></tr><tr><td><img src="Search Engine_files/image [1].png" type="image/png" data-filename="image.png" width="764.8266983032227"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you explain the model of the search strategy system ?</div></td></tr><tr><td><img src="Search Engine_files/image [2].png" type="image/png" data-filename="image.png" width="583.0085258483887"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the role of the SearchStrategy class inside the search strategy system ?</div></td></tr><tr><td><div>SearchStrategy</div><ul><li><div>Object to generate provider searches given a specific searchCriteria for itinerary</div></li><li><div>Associated with a SearchStrategyItineraryBuilder that is used to combine the provider results from the provider searches and generate Itineraries</div></li><li><div>Examples: Amadeus, LowCost, CrossFaring, Hub, SmartHub, OWasRT, Hiding</div></li><li><div>FI_SEARCH_STRATEGIES: id, description, strategy type id </div></li><ul><li><div>AMADEUS: agent, iata, service, credentials suite; XFARECOMB: strategy id A and B; MDEST: allowed strategy; HUB: hub id; OWRT: sub strategy id; HIDING: used strategy, is hiding</div></li><li><div>LOWCOST, GALILEO, XFARING</div></li></ul><li><div>FI_SEARCH_STRATEGY_TYPES: id, store class name, description</div></li></ul></td></tr><tr><td><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the role of the SearchPattern class inside the search strategy system ?</div></td></tr><tr><td><div>SearchPattern</div><div>● Pattern that groups a set of search strategies</div><div>● Example: Default + XLC-LC Iata ES, Hub London</div><div>● FI_SEARCH_PATTERNS: id, description</div><div>● FI_SEARCH_PATTERN_STRATEGIES: pattern id, associated strategies id</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the role of the SearchCriteriaSet class inside the search strategy system ?</div></td></tr><tr><td><div>SearchCriteriaSet</div><div>● Set of conditions to decide if a search pattern suite can be used for a given search criteria</div><div>● Checks conditions such as: admits all websites/mktPortals or only a specific set, admits</div><div>itineraries/dynpack, specific interface/market/client</div><div>●</div><div>FI_SEARCH_CRITERIA_SETS: id, site, admits all countries/all portals/flight/dynpack, route</div><div>market, interface, distribution client, priority order, test, ...</div><div>○</div><div>FI_SEARCH_CRITERIA_SETS_CSITES (website list), FI_SEARCH_CRITERIA_SET_PORTALS (mktPortal list)</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the role of the SearchPatternSuite class inside the search strategy system ?</div></td></tr><tr><td><div>SearchPatternsSuite</div><div>●</div><div>Suite that contains an active search pattern and the search criteria set that should be</div><div>matched to use it</div><div>● It also contains a set of alternative search patterns that are used for a control search</div><div>● A suite can be activated or deactivated</div><div>● Example: ES - ES S/ All /Xfaring, Dynpack IATA SITE</div><div>● FI_SEARCH_PATTERNS_SUITES: id, search criteria set id, active pattern, control search</div><div>percentage, isTest, isModTestAB, isDeleted, activation/deactivation date, description</div><div>●</div><div>FI_SEARCH_PATTERNS_PER_SUITE (load alternative search patterns): suite id, pattern ids</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you explain the usage of the search strategies with its various input and outputs ?</div></td></tr><tr><td><img src="Search Engine_files/image [3].png" type="image/png" data-filename="image.png" width="547.0085258483887"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the various step involved in the calculate searches phase ?</div></td></tr><tr><td><img src="Search Engine_files/image [4].png" type="image/png" data-filename="image.png" width="594.0085258483887"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the various step involved in the product building step ?</div></td></tr><tr><td><img src="Search Engine_files/image [5].png" type="image/png" data-filename="image.png" width="597.0085258483887"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What are the class involved in the search straegy system ?</div></td></tr><tr><td><img src="Search Engine_files/image [6].png" type="image/png" data-filename="image.png" width="631.0085258483887"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how does search engine apply strategies while searching ? Can you give a brief explanation of the steps involved ?</div></td></tr><tr><td><div style="text-align:start;">When doing an itinerary search in our platform, we apply the search strategies model to calculate which provider searches have to be sent to provider. This phase is called <b>calculate searches</b>.</div><div><br/></div><div style="text-align:start;">The search strategies model is also used to build the itineraries that will be returned to the user using the results of the provider searches. This phase is called <b>product building</b> or <b>build results</b>.</div><div><br/></div><div style="text-align:start;">In both the calculate searches and product building phase there are some conditions that prevent us to generate provider searches and build specific results. </div><div><br/></div><div style="text-align:start;"><b>Calculate searches</b></div><div style="text-align:start;">In this step the strategies are used to generate the provider searches that will be sent to provider. Each strategy has a different logic that will lead to different provider searches. Each strategy has also its own conditions to decide if they are applied or not, and also if they generate the provider searches. </div><div><br/></div><div style="text-align:start;"><b>Product building or build itineraries</b></div><div style="text-align:start;">In this step the results of the provider searches generated in calculate searches are combined to build the user itineraries. Each strategy has a different logic to combine the itineraries. Each strategy has also its own conditions to decide if the itineraries are built or not. </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>generally speaking what are conditions and restrictions for strategies ?</div></td></tr><tr><td><div style="text-align:start;">Conditions and restrictions for strategies</div><div style="text-align:start;">The conditions and restrictions are different for each strategy, and depend also on the step (calculate searches and product building). The conditions/restrictions of the calculate searches step will decide if the strategy is used, that is, if searches are generated using the strategy. The conditions/restrictions for the product building step will decide if specific results are built or not using the strategy.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What are the conditions and restrictions for the low cost strategy ?</div></td></tr><tr><td><div style="text-align:start;">LowCost</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><ul><li><div>No conditions. LowCost searches are always generated when the strategy is used.</div></li></ul><div style="text-align:start;"><b>Conditions for product building</b></div><ul><li><div>No conditions. LowCost results are always returned. </div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the amadeus strategy ?</div></td></tr><tr><td><div style="text-align:start;">Amadeus</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><div style="text-align:start;">All this conditions should be satisfied in order to generate provider searches with the Amadeus strategy. If any of these conditions is not satisfied, then the Amadeus strategy will not be used to generate searches. These conditions are based on the searchCriteria specified for the user.</div><div><br/></div><ul><li><div>allowed by calendar: there restrictions related to the outbound date. The restriction depend on the Agent used in the search. These restrictions are configured in the CalendarConf.propertes and the *.csv files. More information about calendar restrictions <a href="https://jira.odigeo.com/wiki/display/KB/Conditions+in+search+strategies#Conditionsinsearchstrategies-CalendarRestrictions" rel="nofollow" rev="en_rl_none">here</a>. </div></li><li><div>main search product of the search should be flight</div></li><li><div>searches for more than one year not allowed.: departure date of last segment shouldn't be greater than one year in the future.</div></li><li><div>combination of IATA and middleOffice should be allowed. Some combinations are not allowed. The default middleOffice (website → default agent → default middleOffice) with the middleOffice associated with the credentialsSuite used. The middleOffices should be equals, or the combination should be allowed. The combination is allowed if both middleOffice are contained in the list of supportedMiddleOffices = 2, 8, 9, 10 (CredentialsSuiteWebsiteCriteriaManager.properties).</div></li><li><div>search should be allowed by Gds service: for normal Amadeus strategy, the search can't contain all segments as airShuttle (at least one segment no airShuttle); for Amadeus LongHaul strategy, search can't be multisegment and can't contain airShuttle segments. </div></li></ul><div style="text-align:start;"><b>Conditions for product building</b></div><ul><li><div>No conditions. Amadeus results are always returned. </div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the crossfaring strategy  in the search step ?</div></td></tr><tr><td><div style="text-align:start;">CrossFaring</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><div style="text-align:start;">For normal crossfaring (2 segments, outgoing and ingoing), the conditions to apply the strategy and calculate searches:</div><div><br/></div><ul><li><div>search should be of type Round Trip</div></li><li><div>search can't contain all segments as airShuttle (at least one segment no airShuttle)</div></li></ul><div style="text-align:start;">For crossfaring multisegment (2 not-circular segments or more than 2 segments):</div><div><br/></div><ul><li><div>search should be of type MultiSegment</div></li><li><div>search can't have more than 4 legs (number of legs &lt;= 4)</div></li><li><div>search is enables by website: the website of the search is not in the list of disabled websites. The list of disabled websites in which crossfaring multidestination can't be applied (CrossFaringMultiDestinationRulesManager.properties): </div><div><br/></div><div>disabledWebsites=\</div><div>                    GOIT, GODE, GONL, GOPT, GOES, GOGB, B2B01, OPAU, OPSE, OPNO,\</div><div>                    OPDK, OPFI, OPPL, OPPLC, OPUKC, OPFRC, OPDEC, OPNL, OPCH, OPES, OPPT, TLUK, TLDE, TLES, TLFR, TLIT, TLPL, TLHU,\</div><div>                    TLSE, TLNO, TLDK, TLFI, TLIS, TLGB, TLSEC, TLNOC, TLDKC, TLFIC</div></li></ul><div style="text-align:start;">In crossfaring strategy the original searchCriteria is splitted into several separated searchCriterias, one for each leg. For each of these searchCriterias we apply strategies (substrategies) to do the search. The substrategies that can be used are configured in Oracle database.</div><div><br/></div><div style="text-align:start;">For normal crossfaring the substrategies are configured in the table FI_SEARCH_STRATEGIES_XFARECOMB.</div><div><br/></div><div style="text-align:start;">For Multisegment crossfaring the substrategies are configured in the table: FI_SEARCH_STRATEGIES_MDEST</div><div><br/></div><div style="text-align:start;">For  both normal and multisegment crossfaring, the substrategies to apply (coming from database configuration) should also be allowed as crossfaring substrategies. </div><div><br/></div><ul><li><div>substrategy should not be specifically excluded (code flow)</div></li><li><div>substrategy should be allowed by calendar restrictions (only for Gds strategies): check that the calendar restrictions by agent and website do not apply. Restrictions are configured in csv files for each agent and website. The csv file to be used is specified in CalendarConf.properties. </div></li><li><div>substrategy should be allowed in crossfaring. All the strategies are always allowed as substrategies of crossfaring, except OneWayAsRoundTrip strategy. OneWayAsRoundTrip is not allowed when the departureDate and arrivalDate of the search are in the same date, and when there is a Saturday between the departureDate and the arrivalDate.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the crossfaring while doing the product building ?</div></td></tr><tr><td><div style="text-align:start;"><b>Conditions for product building</b></div><div style="text-align:start;">When crossfaring strategy is used we eventually receive the provider results associated with the searches calculated in crossfaring strategy. Those results correspond to the searches generated by the substrategies (they will be OW results, not RT) and the product building is needed to combine the results and generate itineraries for the user.</div><div><br/></div><div style="text-align:start;">The crossfaring mixer is used to generate the itineraries, using the results built for each substrategy. The results of each substrategy are sorted and filtered by the FilterRepeatedFareItineraryComparator before being combined. See <a href="https://jira.odigeo.com/wiki/display/KB/Conditions+in+search+strategies#Conditionsinsearchstrategies-FilterRepeatedFareItineraryComparator" rel="nofollow" rev="en_rl_none">here</a> the behavior of FilterRepeatedFareItineraryComparator. For crossfaring mixer, the comparator doesn't used any configurationItem, so it compares the provider price (pure comparison), the eTicket, the gdsService, the number of providers, the comission and the iata. Besides, only a certain number of results from each substrategy are used. Only the first N results are taken, and this number is configured in CrossFaringRulesManager.properties and is 50.</div><div><br/></div><div style="text-align:start;">Once the lists of itineraries for each leg of the crossfaring are sorted, then the combinations are generated. They are generated in order, so we make sure that the first combination generated is gonna be the best according to the criteria of our comparator. </div><div><br/></div><div style="text-align:start;">The resulting combinations are checked to see if they are allowed:</div><div><br/></div><ul><li><div>substrategies used to generate each combination should be allowed. For normal crossfaring, the allowed substrategies are configured in database, table FI_SEARCH_STRATEGIES_XFARECOMB. For crossfaring multisegment, the allowed substrategies are configured in database, table FI_SEARCH_STRATEGIES_MDEST.</div></li><li><div>check that all the itineraries of the combination can be combined among them (mayBeCrossfaredWith). Check the details of these conditions <a href="https://jira.odigeo.com/wiki/display/KB/Conditions+in+search+strategies#Conditionsinsearchstrategies-mayBeCrossFaredWith" rel="nofollow" rev="en_rl_none">here</a>.</div></li></ul><div style="text-align:start;">Finally, combinations generated are filtered to discard those combinations with time overlapping problems. Combinations with potential overlapping problems are:</div><div><br/></div><ul><li><div>no air shuttle segment in combination</div></li><li><div>departureDate of one segment separated less than 60 hours from arrivalDate of previous segment. </div></li></ul><div style="text-align:start;">If the filter is applied, we discard all the combinations where:</div><div><br/></div><ul><li><div>arrival and departure date of 2 consecutive segments is separated less than 2 hours. </div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the hub strategy ?</div></td></tr><tr><td><div style="text-align:start;">Hub</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><div style="text-align:start;">The conditions to apply and calculate the searches in a Hub strategy are as follows:</div><div><br/></div><ul><li><div>have a valid insurance for the website used. The websites with hub insurances are configured in properties file HubCrossFareRulesManager.properties.</div><div><br/></div><div>hubInsurancePolicyNumbers =\</div><div>  ES=NEWHUB162,\</div><div>  FR=NEWHUB162,\</div><div>  DE=NEWHUB162,\</div><div>  PT=NEWHUB162,\</div><div>  GB=NEWHUB162,\</div><div>  IT=NEWHUB162,\</div><div>  CH=NEWHUB162,\</div><div>  GOFR=NEWHUB162,\</div><div>  GOGB=NEWHUB162,\</div><div>  GODE=NEWHUB162,\</div><div>  GOES=NEWHUB162,\</div><div>  GOIT=NEWHUB162,\ </div><div>  GOPT=NEWHUB162,\</div><div>  OPCH=NEWHUB162,\</div><div>  OPFR=NEWHUB162,\</div><div>  OPDE=NEWHUB162,\</div><div>  OPAT=NEWHUB162,\</div><div>  OPGB=NEWHUB162,\</div><div>  OPIT=NEWHUB162,\</div><div>  TLGB=NEWHUB162,\</div><div>  TLPL=NEWHUB162,\</div><div>  TLFI=NEWHUB162,\</div><div>  TLNO=NEWHUB162,\</div><div>  TRSE=NEWHUB162,\</div><div>  TRNO=NEWHUB162,\</div><div>  TRDK=NEWHUB162,\</div><div>  TRFI=NEWHUB162,\</div><div>  TRIS=NEWHUB162,\</div><div>  TRGB=NEWHUB162,\</div><div>  TRDE=NEWHUB162,\</div><div>  OPSE2=NEWHUB162,\</div><div>  OPNO2=NEWHUB162,\</div><div>  OPDK2=NEWHUB162,\</div><div>  OPFI2=NEWHUB162,\</div><div>  OPPL2=NEWHUB162,\</div><div>  DEFAULT=</div></li><li><div style="margin-bottom:10px;">departure and arrival city should be different from Hub city used</div></li><li><div style="margin-bottom:10px;">we should have valid substrategies for the origin to hub segment</div></li><li><div style="margin-bottom:10px;">we should have valid substrategies for the hub to destination segment</div></li><li><div style="margin-bottom:10px;">the search criteria should be accepted for hub strategy:</div></li><ul><li><div style="margin-bottom:10px;">no children and no infants in the search</div></li><li><div style="margin-bottom:10px;">no MultiSegment search</div></li><li><div style="margin-bottom:10px;">dates range is accepted: departure dates of consecutive segments, separated at least 2 days</div></li><li><div style="margin-bottom:10px;">no resident search</div></li></ul></ul><div style="text-align:start;"><br/></div><div style="text-align:start;"><b>Conditions for product building</b></div><div style="text-align:start;">When hub strategy is used, the provider results will be eventually delivered to the substrategies used in origin-to-hub subsearch and hub-to-destination subsearch. Then the hub strategy applies its logic to build itineraries out of these subsearches and generate itinerary results for the user. </div><div><br/></div><div style="text-align:start;">To be able to build the results there should be a valid, mandatory insurance available for the website. As this is a condition already checked in the calculate searches step, this condition will probably be satisfied. </div><div><br/></div><div style="text-align:start;">The hub itineraries are created using a mixer that combines results from origin-to-hub with hub-to-destination (HubItineraryMixer.java#mixItineraries). Before building the combinations, the mixer filters the results of origin-to-hub and hub-to-destination according to the following conditions:</div><div><br/></div><ul><li><div>discards results that cause circular itineraries: originToHub finishing in final destination (user arrival), hubToDestination finshing in departure (user departure)</div></li><li><div>the mixer will create a certain number combinations (for hub, 5 combinations maximum)</div></li></ul><div style="text-align:start;">When the mixer creates combinations to generate the results, certain conditions should be satisfied:</div><div><br/></div><ul><li><div>for a combination to be added to the results, the value of eTicket (Gds parameter) should be the same for origin-to-hub and hub-to-destination itineraries</div></li><li><div>origin-to-hub itinerary may be crossfared with hub-to-destination itinerary. More details <a href="https://jira.odigeo.com/wiki/display/KB/Conditions+in+search+strategies#Conditionsinsearchstrategies-mayBeCrossFaredWith" rel="nofollow" rev="en_rl_none">here</a>. </div></li><li><div>when creating the Hub result, segments should not have circular itineraries (repeated origins)</div></li><li><div>when creating the Hub result, only the segments that satisfy the connection time condition are allowed. </div></li><ul><li><div>a valid connection time for the Hub should be configured for our route departure-arrival in FI_HUB_CONNECTION_TIMES</div></li><li><div>arrival time of origin-to-hub and departure time of hub-to-destination should be separated at least by connection time configured</div></li></ul></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the smarthub strategy ?</div></td></tr><tr><td><div style="text-align:start;">SmartHub</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><div style="text-align:start;">The conditions to apply and calculate the searches in a SmartHub strategy are as follows:</div><div><br/></div><ul><li><div>no multisegment search</div></li><li><div>allowed flow:</div></li><ul><li><div>search from OneFront (no clickout)</div><div>OR</div></li><li><div>search from Meta (MAPI search or clickout) AND active AB Test (TFC_TFC59)</div></li></ul><li><div>configured smartHubRule (table FI_SMART_HUB_RULE in database) matching the criteria of the search</div></li><li><div>have a valid insurance for the website used. The websites with hub insurances are configured in properties file HubCrossFareRulesManager.properties. (see Hub section for more details)</div></li><li><div>the smartHubRule selected has valid, enabled definition. Definitions are filtered by weekdays (table FI_SMART_HUB_DEFINITION_DOW in database),  and by active providers in search (table FI_SMART_HUB_DEF_PROVIDERS in database). Both conditions should be satisfied by the search criteria of the search. </div></li></ul><div style="text-align:start;">The logic to calculate searches depend on the substrategies used. In SmartHub, allowed substrategies also include crossfaring (besides simple strategies), that was not included as substrategy in Hub.</div><div><br/></div><div style="text-align:start;"><b>Conditions for product building</b></div><div style="text-align:start;">When smarthub strategy is used, the provider results will be eventually delivered to the substrategies used in origin-to-hub subsearch and hub-to-destination subsearch. The smartHub itineraries are created using a DynamicHub strategy, which behaves as a Hub but receives its configuration in a dynamic way (not from fixed configuration in database). The behavior of SmartHub can be normal hub, hub with crossfaring as substrategy, or crossfaring of hubs. </div><div><br/></div><div style="text-align:start;">The results of the dynamic hub are sorted by provider price and departure date using the FareItineraryFareComparator. In this order, we add results to the final list according to the following conditions:</div><div><br/></div><ul><li><div style="margin-bottom:10px;">Add itineraries to the list of results until we get the maximum number of resutls for smarthub (5)</div></li><li><div style="margin-bottom:10px;">The results should have less than 4 PNRs in total per itinerary (less than 4 simple itineraries per smarthub itinerary)</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the oneWayAsRoundTrip strategy ?</div></td></tr><tr><td><div style="text-align:start;">OneWayAsRoundTrip</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><div style="text-align:start;">There is only one condition to apply OneWayAsRoundTrip strategy:</div><div><br/></div><ul><li><div>search should be OW (one way)</div></li></ul><div style="text-align:start;">In this strategy, a roundTrip search is created from the original oneWay search. To do that, we create a second inbound segment with a inbound date calculated according to a database configuration. The OneWayAsRoundTrip strategy uses substrategies to generate the provider searches of this new roundTrip search. The allowed substrategies are configured in column SEARCH_STRATEGY_ID_SUB of table FI_SEARCH_STRATEGIES_OWRT.</div><div><br/></div><div style="text-align:start;"><b>Conditions for product building</b></div><div style="text-align:start;">When OneWayAsRoundTrip strategy is used, the substrategies will eventually receive their provider results. The provider results (roundtrip) will be encapsulated inside OneWayAsRoundTrip itinerary, because somehow will need to &quot;modify&quot; the itinerary that we return to the user in order to show just the oneWay result that user expects.</div><div><br/></div><div style="text-align:start;">The condition for this itinerary results from substrategies to be used as OneWayAsRoundTrip results are:</div><div><br/></div><ul><li><div>only itineraries of simple substrategies are considered</div></li><li><div>itineraries that do not contain any carrier of the blackList OWasRT configured in OneWayAsRoundTripConfiguration.properties. There is a static blacklist of carriers, a blacklist of carriers by Iata (so it depends on the iata used in the Amadeus itinerary being processed), and a blacklist of carrier by website (depends on the website of the search). Also, the greylist of carriers is considered as blacklist if the Interface of the search doesn't support OWasRT. The list of interfaces that support OWasRT is also configured in the properties file.</div><div><br/></div><div>acceptedProviders=1A,AF</div><div>maximumResults = 20</div><div>testTokenMatchersConf=\</div><div>  1=20,2=5</div><div>minDaysOff = 22</div><div>inboundDayOfWeek = WEDNESDAY</div><div> </div><div>greyListAirlines=OK OU AY</div><div>iataGreyListAirlines=</div><div>websiteGreyListAirlines=\</div><div>ES=US BD,\</div><div>IT=US BD,\</div><div>PT=US BD,\</div><div>FR=US BD,\</div><div>UK=US BD,\</div><div>DE=US BD,\</div><div>CH=US BD,\</div><div>TR=US BD,\</div><div>GB=US BD</div><div> </div><div>iataBlackListAirlines=</div><div> </div><div>crossFaringBlackListAirlines=BD</div><div>crossFaringIataBlackListAirlines=\</div><div>  ES=OS,\</div><div>  IT=OS BD</div><div>crossFaringWebsiteBlackListAirlines=</div><div> </div><div>#Interface where OWASRT grey list applies, for other interfaces, greylisted carriers are considered blacklisted</div><div>greyListInterfaces=1,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21</div></li><li><div>the maximum size of results list returned is 20 (configured also in the properties file). Only the first 20 results are returned (sorted by provider price and departure date with the FareItineraryFareComparator)</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the conditions and restrictions for the hiding strategy ?</div></td></tr><tr><td><div style="text-align:start;">Hiding</div><div style="text-align:start;"><b>Conditions for calculate searches</b></div><div style="text-align:start;">The only condition to apply Hiding strategy is:</div><ul><li><div>search should not be multisegment</div></li></ul><div><br/></div><div>The hiding strategy consists of using two different sets of substrategies to do the same search: main and hiding.</div><div>Hiding substrategies are supposed to be cheaper than main substrategies, so in the product building we try to replace the results from main substrategy with results from hding substrategies. To apply the hiding substrategies there are also different conditions to be satisfied. See all the details here: <a href="https://docs.google.com/document/d/1Tanywbjtw8VVgFKbBgrS7e16J6F5a6plxZCl1zCDqEY/edit?usp=sharing" rel="nofollow" rev="en_rl_none">Hiding strategy</a></div><div style="text-align:start;"><br/></div><div style="text-align:start;"><b>Conditions for product building</b></div><div style="text-align:start;">There are no specific conditions. The results are always built.</div><div style="text-align:start;">If the strategy is used, at least the main substrategies have been launched, so the their results will be built. </div><div style="text-align:start;">Instead, results of hiding substrategies are only built if certain conditions are satisfied. These are internal conditions of Hiding strategy and its logic and can be found here:  <a href="https://docs.google.com/document/d/1Tanywbjtw8VVgFKbBgrS7e16J6F5a6plxZCl1zCDqEY/edit?usp=sharing" rel="nofollow" rev="en_rl_none">Hiding strategy</a></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is the fitlterRepeatedFareItineraryComparator ? What are the criterias that uses ?</div></td></tr><tr><td><div style="text-align:start;"><b>FilterRepeatedFareItineraryComparator</b></div><div style="text-align:start;">This comparator is used to sort a list of fareItineraries according to a set of conditions.</div><div><br/></div><div style="text-align:start;">This comparator receives certain configuration from database. The configuration is encapsulated inside a FilterRepeatedConfigurationItem, and specifies the following parameters: higherPriorityProviderCode, lowerPriorityProviderCode, threshold, applyPerPassenger, websiteCode, carrierCode, testName, partitionNumber. These are parameters that will be used in the specific comparison used.</div><div><br/></div><div style="text-align:start;">The comparison to sort the itineraries takes into account:</div><div><br/></div><ul><li><div><b>compareProviderPrice</b>: compare provider price and give priority to the cheaper. </div><div>If certain conditions apply for the itineraries we are comparing, we apply a threshold to the provider price before comparing. (FilterRepeatedFareItineraryComparator.applyThreshold)</div><div>These conditions are checked in the ItineraryGatewaySearchResultsItems (provider itineraries) of the itinerary. </div><div>Carrier and higherPriorityProviderCode of the filterRepeatedConfigurationItem should match the values of the provider itinerary.</div></li><li><div><b>compareEticket</b>: gives priority to the eticket true</div></li><li><div><b>compareGdsService</b>: gives priority to Gds itineraries with NORMAL GdsService type</div></li><li><div><b>compareProviders</b>: gives priority to lower number of providers in the itinerary; if same number of providers, gives priority to providers that match (more times) the higherPriorityProviderCode of the FilterRepeatedConfigurationItem</div></li><li><div><b>commissionComparator.compare</b>: gives priority to itinerary with higher minimumCommission</div></li><li><div><b>repeatedFareItineraryIataComparator.compareIata</b>: gives priority to itineraries whose Gds provider itineraries have (more times) the Iata equals to default Iata of website</div><div>   if same priority, check country (agent country of the used iata should match the default country of the website)</div><div>   if same priority, check brand (brand of used credentials suite should match brand of the website)</div></li></ul><div style="text-align:start;">With this criteria we sort the list of itineraries.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What is the filterRepeatedFareItinerary ? What is his job  and how it does it ?</div></td></tr><tr><td><div style="text-align:start;"><b>FilterRepeatedFareItineraries</b></div><div style="text-align:start;">Filter to detect and filter the repeated fare itineraries of the results list. </div><div><br/></div><div style="text-align:start;">First step is to load the list of FilterRepeatedConfigurationItem that will be used for this search. The configuration items are stored in database, in the table IT_FILTER_REPEATED_CONF. According to the test token of the current search, a list of items is loaded. </div><div><br/></div><div style="text-align:start;">For each item, we then sort the list of itineraries to filter, and then filter the fare itineraries that are detected as duplicated. </div><div style="text-align:start;">The sorting of the list is done using a FilterRepeatedFareItineraryComparator configured with each of the configuration items retrieved in the first step.</div><div><br/></div><div style="text-align:start;"><br/></div><div><br/></div><div style="text-align:start;">The filter the duplicates we need to see if these itinerary is eligible to be duplicated.</div><div><br/></div><div style="text-align:start;">Eligible to have duplicates if:</div><div><br/></div><ul><li><div>1 or 2 segments AND (some Gds flight OR itinerary matching a condition in IT_FILTER_REPEATED_CONF)</div><div>The conditions:</div></li><ul><li><div>provider codes of itinerary contain higherPriorityProviderCode or lowerPriorityProviderCode,</div></li><li><div>carrier of first segment of outbound equals to carrierCode (if informed), website of search criteria matches website (if informed),</div></li><li><div>test token of search criteria matches test token (if informed)</div></li></ul></ul><div style="text-align:start;">If the itineraries are eligible to have duplicates, then we check which &quot;combinations of segments&quot; inside the itinerary are not yet included in the list of results, and we include those. The &quot;combinations of segments&quot; that are duplicated (already included in the list of results) are discarded. </div><div><br/></div><div style="text-align:start;">To detect that two itineraries have duplicated &quot;combinations of segments&quot; we compare the sectionIds of all their sections. The sectionId of a flight section contains the carrierId and the flightNumber; the sectionId of a train section contains the trainNumber. The comparision is done at segment level, so we don't directly detect itineraries as duplicated but segments and segment combinations. </div><div><br/></div><div style="text-align:start;">If all these sectionIds are the same, then the itineraries contain potentially duplicated combinations of segments.</div><div><br/></div><div style="text-align:start;">In this case, the comparator is used to check that both itineraries, the itinerary and the repeated itinerary satisfy the conditions that we say before (provider codes, carriers, website and test token). If the itineraries satisfy the conditions, then we detect which combinations of segments are not yet in the list of results (if any) and we add it.</div><div><br/></div><div style="text-align:start;">When all the configuration items have been applied to sort and filter duplicates, the list of results contain only itineraries that do not have any repeated segment combination. The itineraries that used to have repeated segment combinations with other itineraries have been filtered, keeping only those combinations that are not repeated.</div><div><br/></div><div style="text-align:start;">Detailed information about the point of the flow where the filter is applied here: <a href="https://jira.odigeo.com/wiki/display/KB/Filter+of+Repeated+Itineraries" rev="en_rl_none">Filter of Repeated Itineraries</a>.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is the mayBeCrossFaredWith function ? Can you give an explanation of its purpose and how it works ?</div></td></tr><tr><td><div style="text-align:start;"><b>mayBeCrossFaredWith</b></div><div style="text-align:start;">This is a method of the FareItinerary that returns true or false to indicate if the fareItinerary1 can be combined (crossfared) with another fareItinerary2 to build a composite itinerary.</div><div><br/></div><div style="text-align:start;">The decision about allowed combination depends on the type of each itinerary (fareItinerary1 + fareItinerary2): </div><div><br/></div><div style="text-align:start;"><b><u>simple+simple:</u></b></div><div><br/></div><div style="text-align:start;">Check that itineraries are compatible:</div><div><br/></div><ul><li><div>agentSelector of itinerary1 is compatible with agentSelector of itinerary2: agentSelector should accept all agents OR agentSelector of itinerary2 should specifically accept the preferredAgent of agentSelector of itinerary1 (accepts all or same preferred agent)</div><div><br/></div></li><li><div>Gds provider of itinerary1 is compatible with Gds provider of itinerary 2: both providers are not forbidden, and the combination of the 2 providers is not forbidden. Forbidden providers and forbidden combinations are specified in CrossFaringMultiDestinationRulesManager.properties</div><div>forbiddenGdsProviderPairs = 1A1G, U2U2M, 1AAG, 1GAG forbiddenProviders = DEFAULT=GOV G1S G3 LLG</div><div>self cross faring: 1A, TF, FR, AG</div></li><li><div>MiddleOfficeSelector of itinerary2 is compatible with itinerary1: middleOfficeSelector should accept all middleOffices OR middleOfficeSelector of itinerary2 should specifically accept the preferredMiddleOffice of itinerary1 (accepts all or same preferred middleOffice)</div></li></ul><div><br/></div><div>Check that mayBeCrossFaredWithSpecific in both directions (fareItinerary1 mayBeCrossFaredWithSpecific fareItinerary2 AND fareItinerary2 mayBeCrossFaredWithSpecific fareItinerary1)</div><div>The logic of this method depends on the provider</div><ul><li><div>LowCost: always true (crossfared with all)</div></li><li><div>Train: always true (crossfared with all)</div></li><li><div>Amadeus: false si manual issue &amp; xf with lowcost</div><div>xf with other Amadeus should not be manualIssue, and have same Iata and have same Gds service and have same price type (DEFAULT, TOUR_OPERATOR, LIGHT, MIRROR)</div></li><li><div>TravelFusion: false if provider component null</div><div>carriers should be compatible: test for allow xf in equal carriers</div></li></ul><div><br/></div><div><b><u>simple+ANY_NOT_SIMPLE:</u></b></div><div>check that the other itinerary mayBeCrossFaredWith the simple itinerary</div><div><b><u>crossfaring+simple:</u></b></div><div>check all the simple itineraries that compose the crossfaring mayBeCrossFaredWith the simple.</div><div><b><u>crossfaring+crossfaring:</u></b></div><div>if both crossfaring itineraries are not multiGds, true.</div><div>if one of the crossfarings is multiGds, then check all the simple fare itineraries of the crossfaring to see that mayBeCrossFaredWith the other crossfaring.</div><div><b><u>hub+ANY:</u></b></div><div>false, hub cannot be crossfared with any itinerary</div><div><b><u>oneWayAsRoundTrip+ANY:</u></b></div><div>check that the other itinerary mayBeCrossFaredWith the Simple itineary that is contained in the OWasRT itinerary.</div><div><b><u>smartHub+smartHub:</u></b></div><div>true, SmartHubFareItinerary can NOT be cross fared with any itinerary but SmartHubFareItinerary</div><div><b><u>smartHub+ANY_NOT_SMARTHUB:</u></b></div><div>false, SmartHubFareItinerary can NOT be cross fared with any itinerary but SmartHubFareItinerary</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the json of the IGSearchResults response ?</div></td></tr><tr><td><div><b>IGSearchResults</b></div><div>Location in code: ItineraryGatewayController.search. Converter: IGSearchResultsDataConverter</div><div>Used in executeProductCategorySearches: launch searches (ProductCategorySearchController.search)</div><div>Track <b>return</b>: it prints searchResults from IG: total of ProductGatewaySearchCriteria, total of ItineraryGatewaySearchResultsItems, number of ProductGatewaySearchCriteria by type(Amadeus or LowCost), for each ProductGatewaySearchCriteria: number of ItineraryGatewaySearchResultsItems by type(Amadeus or LowCost)</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;totalProductGatewaySearchCriteria&quot; : 5,</div><div>    &quot;totalItineraryGatewaySearchResultsItems&quot; : 141,</div><div>    &quot;numProductGatewaySearchCriteriaByType&quot; : {</div><div>        &quot;AmadeusGatewaySearchCriteria&quot; : 4,</div><div>        &quot;LowCostGatewaySearchCriteria&quot; : 1</div><div>    },</div><div>    &quot;trackingProductGatewaySearchCriteriaList&quot; : [{</div><div>            &quot;type&quot; : &quot;AmadeusGatewaySearchCriteria&quot;,</div><div>            &quot;numResults&quot; : 23</div><div>        }, {</div><div>            &quot;type&quot; : &quot;LowCostGatewaySearchCriteria&quot;,</div><div>            &quot;numResults&quot; : 0</div><div>        }, {</div><div>            &quot;type&quot; : &quot;AmadeusGatewaySearchCriteria&quot;,</div><div>            &quot;numResults&quot; : 23</div><div>        }, {</div><div>            &quot;type&quot; : &quot;AmadeusGatewaySearchCriteria&quot;,</div><div>            &quot;numResults&quot; : 23</div><div>        }, {</div><div>            &quot;type&quot; : &quot;AmadeusGatewaySearchCriteria&quot;,</div><div>            &quot;numResults&quot; : 72</div><div>        }</div><div>    ]</div><div>}</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the json of the odirating response ? </div></td></tr><tr><td><div><b><span style="font-family: inherit;"><span style="font-size: 30px;">ODIRATING</span></span></b></div><div>Location in code: RankCriteriaController.processAndSendInfoToTrackingSystem. Converter: RankCriteriaConverter</div><div>Used in postProcess</div><div>Track <b>invoke</b>: it prints brand and market of website and fareItineraries list: number of bags included, freeCancellation of bags, cabinClass, flightType, info of segments: departure and arrival airport, departure and arrival city, departure and arrival time, seats available, flight duration, duration stopovers, number of stopovers</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div> &quot;brand&quot; : &quot;ED&quot;,</div><div> &quot;market&quot; : &quot;ES&quot;,</div><div> &quot;itineraries&quot; : [{</div><div> &quot;segments&quot; : {</div><div> &quot;0&quot; : [{</div><div> &quot;depAirport&quot; : &quot;GRO&quot;,</div><div> &quot;destAirport&quot; : &quot;RTM&quot;,</div><div> &quot;depCity&quot; : &quot;GRO&quot;,</div><div> &quot;destCity&quot; : &quot;RTM&quot;,</div><div> &quot;depTime&quot; : &quot;27/07/2018 09:20:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;27/07/2018 11:15:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 1,</div><div> &quot;flightDuration&quot; : 115,</div><div> &quot;numStopovers&quot; : 0,</div><div> &quot;durStopovers&quot; : 0</div><div> }</div><div> ],</div><div> &quot;1&quot; : [{</div><div> &quot;depAirport&quot; : &quot;RTM&quot;,</div><div> &quot;destAirport&quot; : &quot;GRO&quot;,</div><div> &quot;depCity&quot; : &quot;RTM&quot;,</div><div> &quot;destCity&quot; : &quot;GRO&quot;,</div><div> &quot;depTime&quot; : &quot;04/08/2018 07:55:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;04/08/2018 09:45:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 9,</div><div> &quot;flightDuration&quot; : 110,</div><div> &quot;numStopovers&quot; : 0,</div><div> &quot;durStopovers&quot; : 0</div><div> }, {</div><div> &quot;depAirport&quot; : &quot;RTM&quot;,</div><div> &quot;destAirport&quot; : &quot;GRO&quot;,</div><div> &quot;depCity&quot; : &quot;RTM&quot;,</div><div> &quot;destCity&quot; : &quot;GRO&quot;,</div><div> &quot;depTime&quot; : &quot;04/08/2018 17:40:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;04/08/2018 19:30:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 9,</div><div> &quot;flightDuration&quot; : 110,</div><div> &quot;numStopovers&quot; : 0,</div><div> &quot;durStopovers&quot; : 0</div><div> }</div><div> ]</div><div> },</div><div> &quot;cabinClass&quot; : [&quot;ECONOMIC_DISCOUNTED&quot;],</div><div> &quot;flightType&quot; : [&quot;LC&quot;],</div><div> &quot;bagsIncluded&quot; : 0,</div><div> &quot;freeCancellation&quot; : false</div><div> }, {</div><div> &quot;segments&quot; : {</div><div> &quot;0&quot; : [{</div><div> &quot;depAirport&quot; : &quot;GRO&quot;,</div><div> &quot;destAirport&quot; : &quot;RTM&quot;,</div><div> &quot;depCity&quot; : &quot;GRO&quot;,</div><div> &quot;destCity&quot; : &quot;RTM&quot;,</div><div> &quot;depTime&quot; : &quot;27/07/2018 09:20:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;27/07/2018 11:15:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 1,</div><div> &quot;flightDuration&quot; : 115,</div><div> &quot;numStopovers&quot; : 0,</div><div> &quot;durStopovers&quot; : 0</div><div> }</div><div> ],</div><div> &quot;1&quot; : [{</div><div> &quot;depAirport&quot; : &quot;EIN&quot;,</div><div> &quot;destAirport&quot; : &quot;GRO&quot;,</div><div> &quot;depCity&quot; : &quot;EIN&quot;,</div><div> &quot;destCity&quot; : &quot;GRO&quot;,</div><div> &quot;depTime&quot; : &quot;04/08/2018 09:10:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;04/08/2018 11:10:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 3,</div><div> &quot;flightDuration&quot; : 120,</div><div> &quot;numStopovers&quot; : 0,</div><div> &quot;durStopovers&quot; : 0</div><div> }</div><div> ]</div><div> },</div><div> &quot;cabinClass&quot; : [&quot;TOURIST&quot;, &quot;ECONOMIC_DISCOUNTED&quot;],</div><div> &quot;flightType&quot; : [&quot;LC&quot;],</div><div> &quot;bagsIncluded&quot; : 0,</div><div> &quot;freeCancellation&quot; : false</div><div> }, {</div><div> &quot;segments&quot; : {</div><div> &quot;0&quot; : [{</div><div> &quot;depAirport&quot; : &quot;GRO&quot;,</div><div> &quot;destAirport&quot; : &quot;RTM&quot;,</div><div> &quot;depCity&quot; : &quot;GRO&quot;,</div><div> &quot;destCity&quot; : &quot;RTM&quot;,</div><div> &quot;depTime&quot; : &quot;27/07/2018 10:35:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;27/07/2018 22:50:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 8,</div><div> &quot;flightDuration&quot; : 735,</div><div> &quot;numStopovers&quot; : 4,</div><div> &quot;durStopovers&quot; : 435</div><div> }</div><div> ],</div><div> &quot;1&quot; : [{</div><div> &quot;depAirport&quot; : &quot;EIN&quot;,</div><div> &quot;destAirport&quot; : &quot;GRO&quot;,</div><div> &quot;depCity&quot; : &quot;EIN&quot;,</div><div> &quot;destCity&quot; : &quot;GRO&quot;,</div><div> &quot;depTime&quot; : &quot;04/08/2018 09:10:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;arrivalTime&quot; : &quot;04/08/2018 11:10:<a href="https://jira.odigeo.com/wiki/display/KB/00.000" rev="en_rl_none">00.000</a> +0200&quot;,</div><div> &quot;seatsAvailable&quot; : 3,</div><div> &quot;flightDuration&quot; : 120,</div><div> &quot;numStopovers&quot; : 0,</div><div> &quot;durStopovers&quot; : 0</div><div> }</div><div> ]</div><div> },</div><div> &quot;cabinClass&quot; : [&quot;BUSINESS&quot;, &quot;TOURIST&quot;, &quot;ECONOMIC_DISCOUNTED&quot;],</div><div> &quot;flightType&quot; : [&quot;LC&quot;, &quot;REG&quot;],</div><div> &quot;bagsIncluded&quot; : 0,</div><div> &quot;freeCancellation&quot; : false</div><div> }</div><div> ]</div><div>}</div><div> </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the json involved in the search operation ?</div></td></tr><tr><td><div><b>search</b></div><div>Location in code: SearchEngine.search. Converter: SearchDataConverter</div><div>Used in search method in SearchEngine</div><div>Track <b>invoke</b>: it prints searchCriteria: searchId, visitId, marketingTrackingInfo, isDynpackSearch, adultsNumber, childrenNumber, iataCode and geoNodeId departure, iataCode and geoNodeId arrival, productCategory with departureDate, productCategory with arrivalDate</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;departureLocation&quot; : 9646,</div><div>    &quot;searchId&quot; : &quot;7085586500&quot;,</div><div>    &quot;visitId&quot; : &quot;1327753785&quot;,</div><div>    &quot;numAdults&quot; : 1,</div><div>    &quot;searchMarketingChannel&quot; : {</div><div>        &quot;marketingChannelId&quot; : 18,</div><div>        &quot;searchMarketingChannelId&quot; : 18,</div><div>        &quot;marketingChannelError&quot; : 0,</div><div>        &quot;searchMarketingChannelError&quot; : 0</div><div>    },</div><div>    &quot;isDynPack&quot; : false,</div><div>    &quot;ITINERARY_arrivalDate&quot; : &quot;04/09/2018&quot;,</div><div>    &quot;numChildren&quot; : 0,</div><div>    &quot;ITINERARY_departureDate&quot; : &quot;31/08/2018&quot;,</div><div>    &quot;arrivalLocationIata&quot; : &quot;BIO&quot;,</div><div>    &quot;arrivalLocation&quot; : 9655,</div><div>    &quot;departureLocationIata&quot; : &quot;BCN&quot;</div><div>}</div><div>Track <b>return</b>: it prints searchResults: number of results, description of suite, description of criteriaSet, description of activeSearchPattern, whether it has strategy hub or not, whether it has strategy smart hub or not, whether it has strategy long haul or not, results by strategy, results by provider, results by carrier, number of strategy types, number of strategies, number of providers, info of fare itineraries: departure, destination, strategyId, strategyDescription, strategyType, apparentPrice, apparentPriceCurrency, apparentPrice in eur, flightsIds, carriersId, providerIds, number of itineraryProviders, number of itineraryProviders from cache</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;results&quot; : 216,</div><div>    &quot;searchPatternSuite&quot; : &quot;DEFAULT SUITE&quot;,</div><div>    &quot;criteriaSet&quot; : &quot;DEFAULT&quot;,</div><div>    &quot;hasHubStrategy&quot; : true,</div><div>    &quot;hasSmartHubStrategy&quot; : true,</div><div>    &quot;hasLongHaulStrategy&quot; : true,</div><div>    &quot;resultsByStrategyType&quot; : {</div><div>        &quot;LowCost&quot; : 8,</div><div>        &quot;Cross faring LowCost strategy&quot; : 5,</div><div>        &quot;Amadeus normal strategy&quot; : 34,</div><div>        &quot;Hub strategy&quot; : 3,</div><div>        &quot;Cross faring strategy&quot; : 166</div><div>    },</div><div>    &quot;resultsByStrategy&quot; : {</div><div>        &quot;11&quot; : 3,</div><div>        &quot;1&quot; : 19,</div><div>        &quot;4&quot; : 8,</div><div>        &quot;5&quot; : 166,</div><div>        &quot;117&quot; : 5,</div><div>        &quot;42&quot; : 15</div><div>    },</div><div>    &quot;resultsByProvider&quot; : {</div><div>        &quot;1A&quot; : 203,</div><div>        &quot;TF&quot; : 14,</div><div>        &quot;VY&quot; : 109</div><div>    },</div><div>    &quot;resultsByCarrier&quot; : {</div><div>        &quot;VY&quot; : 109,</div><div>        &quot;UX&quot; : 79,</div><div>        &quot;IB&quot; : 151,</div><div>        &quot;9B&quot; : 1,</div><div>        &quot;FR&quot; : 14</div><div>    },</div><div>    &quot;strategyTypesCount&quot; : 5,</div><div>    &quot;strategiesCount&quot; : 6,</div><div>    &quot;providersCount&quot; : 3,</div><div>    &quot;itineraries&quot; : [{</div><div>            &quot;dep&quot; : &quot;BCN&quot;,</div><div>            &quot;dest&quot; : &quot;SDR&quot;,</div><div>            &quot;strategyId&quot; : 4,</div><div>            &quot;strategyDescription&quot; : &quot;Lowcost normal strategy&quot;,</div><div>            &quot;strategyType&quot; : &quot;LowCost type&quot;,</div><div>            &quot;apparentPriceInEUR&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/75.92," rev="en_rl_none">75.92,</a></div><div>            &quot;apparentPrice&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/75.92," rev="en_rl_none">75.92,</a></div><div>            &quot;apparentPriceCurrency&quot; : &quot;EUR&quot;,</div><div>            &quot;numItiProviderItems&quot; : 1,</div><div>            &quot;numItiProviderItemsFromCache&quot; : 0,</div><div>            &quot;providers&quot; : [&quot;VY&quot;],</div><div>            &quot;carriers&quot; : [&quot;VY&quot;],</div><div>            &quot;flights&quot; : [&quot;VY 1592&quot;, &quot;VY 1591&quot;]</div><div>        }, {</div><div>            &quot;dep&quot; : &quot;BCN&quot;,</div><div>            &quot;dest&quot; : &quot;SDR&quot;,</div><div>            &quot;strategyId&quot; : 117,</div><div>            &quot;strategyDescription&quot; : &quot;Cross Faring LowCost normal strategy&quot;,</div><div>            &quot;strategyType&quot; : &quot;Cross faring LowCost strategy type&quot;,</div><div>            &quot;apparentPriceInEUR&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/78.36," rev="en_rl_none">78.36,</a></div><div>            &quot;apparentPrice&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/78.36," rev="en_rl_none">78.36,</a></div><div>            &quot;apparentPriceCurrency&quot; : &quot;EUR&quot;,</div><div>            &quot;numItiProviderItems&quot; : 2,</div><div>            &quot;numItiProviderItemsFromCache&quot; : 1,</div><div>            &quot;providers&quot; : [&quot;TF&quot;, &quot;VY&quot;],</div><div>            &quot;carriers&quot; : [&quot;VY&quot;, &quot;FR&quot;],</div><div>            &quot;flights&quot; : [&quot;VY 1592&quot;, &quot;FR 6385&quot;]</div><div>        }, {</div><div>            &quot;dep&quot; : &quot;BCN&quot;,</div><div>            &quot;dest&quot; : &quot;SDR&quot;,</div><div>            &quot;strategyId&quot; : 5,</div><div>            &quot;strategyDescription&quot; : &quot;Cross Faring normal strategy&quot;,</div><div>            &quot;strategyType&quot; : &quot;Cross faring strategy type&quot;,</div><div>            &quot;apparentPriceInEUR&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/107.06," rev="en_rl_none">107.06,</a></div><div>            &quot;apparentPrice&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/107.06," rev="en_rl_none">107.06,</a></div><div>            &quot;apparentPriceCurrency&quot; : &quot;EUR&quot;,</div><div>            &quot;numItiProviderItems&quot; : 2,</div><div>            &quot;numItiProviderItemsFromCache&quot; : 1,</div><div>            &quot;providers&quot; : [&quot;1A&quot;, &quot;VY&quot;],</div><div>            &quot;carriers&quot; : [&quot;VY&quot;],</div><div>            &quot;flights&quot; : [&quot;VY 1592&quot;, &quot;VY 1429&quot;]</div><div>        }, {</div><div>            &quot;dep&quot; : &quot;BCN&quot;,</div><div>            &quot;dest&quot; : &quot;SDR&quot;,</div><div>            &quot;strategyId&quot; : 5,</div><div>            &quot;strategyDescription&quot; : &quot;Cross Faring normal strategy&quot;,</div><div>            &quot;strategyType&quot; : &quot;Cross faring strategy type&quot;,</div><div>            &quot;apparentPriceInEUR&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/110.76," rev="en_rl_none">110.76,</a></div><div>            &quot;apparentPrice&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/110.76," rev="en_rl_none">110.76,</a></div><div>            &quot;apparentPriceCurrency&quot; : &quot;EUR&quot;,</div><div>            &quot;numItiProviderItems&quot; : 2,</div><div>            &quot;numItiProviderItemsFromCache&quot; : 1,</div><div>            &quot;providers&quot; : [&quot;1A&quot;, &quot;VY&quot;],</div><div>            &quot;carriers&quot; : [&quot;VY&quot;, &quot;UX&quot;],</div><div>            &quot;flights&quot; : [&quot;VY 1592&quot;, &quot;UX 7505&quot;, &quot;UX 6060&quot;]</div><div>        }, {</div><div>            &quot;dep&quot; : &quot;BCN&quot;,</div><div>            &quot;dest&quot; : &quot;BIO&quot;,</div><div>            &quot;strategyId&quot; : 117,</div><div>            &quot;strategyDescription&quot; : &quot;Cross Faring LowCost normal strategy&quot;,</div><div>            &quot;strategyType&quot; : &quot;Cross faring LowCost strategy type&quot;,</div><div>            &quot;apparentPriceInEUR&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/129.47," rev="en_rl_none">129.47,</a></div><div>            &quot;apparentPrice&quot; : <a href="https://jira.odigeo.com/wiki/display/KB/129.47," rev="en_rl_none">129.47,</a></div><div>            &quot;apparentPriceCurrency&quot; : &quot;EUR&quot;,</div><div>            &quot;numItiProviderItems&quot; : 2,</div><div>            &quot;numItiProviderItemsFromCache&quot; : 1,</div><div>            &quot;providers&quot; : [&quot;TF&quot;, &quot;VY&quot;],</div><div>            &quot;carriers&quot; : [&quot;VY&quot;, &quot;FR&quot;],</div><div>            &quot;flights&quot; : [&quot;VY 1432&quot;, &quot;FR 6385&quot;]</div><div>        }</div><div>    ]</div><div>}</div><div> </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the json involved in the dynpack search result tracking operation ?</div></td></tr><tr><td><div><br/></div><div><b>DynpackSearchResultsTracking</b></div><div>Location in code: DynPackProcessorSearchResultLog.processSearchResultLog. Converter: DynpackSearchResultsTrackingConverter</div><div>Used in process dynpack search results, after search in SearchEngine</div><div>Track <b>invoke</b>: geoNodeId and name of arrival flight, geoNodeId and name of accomodation destination, whether it has results for ProductCategory Itinerary or not, whether it has results for ProductCategory Accomodation or not, whether it has results for ProductCategory Itinerary and ProductCategory Accomodation or not</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;accommodationLocationGeoNode&quot; : 9646,</div><div>    &quot;accommodationLocationName&quot; : &quot;Barcelona&quot;,</div><div>    &quot;flightLocationGeoNode&quot; : 9646,</div><div>    &quot;flightLocationName&quot; : &quot;Barcelona&quot;,</div><div>    &quot;accommodation&quot; : true,</div><div>    &quot;flights&quot; : true,</div><div>    &quot;isCorrectSearch&quot; : true</div><div>}</div><div> </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the json involved in the rest-accomodationDetail operation ?</div></td></tr><tr><td><div><b>rest-accommodationDetail</b></div><div>Location in code: SearchEngineServiceRestController.getAccommodationDetails. Converter: AccommodationDataConverter</div><div>Used in call DAPI getAccommodationDetails</div><div>Track <b>invoke</b>: searchId and dealKey</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;searchId&quot; : &quot;7086486527&quot;,</div><div>    &quot;dealKey&quot; : &quot;0&quot;</div><div>}</div><div> </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the json involved in the getSearchResutl operation ?</div></td></tr><tr><td><div><b>getSearchResult</b></div><div>Location in code: SearchEngineServiceRestController.getSearchResults. Converter: SearchResultDataConverter</div><div>Used in call DAPI getSearchResult</div><div>Track <b>invoke</b>: searchId, fareItineraryIndex and accommodationDealKey</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;searchId&quot; : &quot;7085586501&quot;,</div><div>    &quot;fareItineraryIndex&quot; : &quot;1&quot;,</div><div>    &quot;accommodationDealKey&quot; : &quot;null&quot;</div><div>}</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an explanation of the json involved in the rest-search operation ?</div></td></tr><tr><td><div><b>rest-search</b></div><div>Location in code: SearchEngineServiceRestController.search. Converter: SearchRestDataConverter</div><div>Used in call DAPI search</div><div>Track <b>invoke</b>: searchRequest</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;searchRequest&quot; : {</div><div>        &quot;segmentRequests&quot; : [{</div><div>                &quot;departure&quot; : {</div><div>                    &quot;iataCode&quot; : &quot;BCN&quot;,</div><div>                    &quot;geoNodeId&quot; : 9646</div><div>                },</div><div>                &quot;destination&quot; : {</div><div>                    &quot;iataCode&quot; : &quot;BIO&quot;,</div><div>                    &quot;geoNodeId&quot; : 9655</div><div>                },</div><div>                &quot;date&quot; : 1535673600000,</div><div>                &quot;time&quot; : &quot;0000&quot;,</div><div>                &quot;timeWindow&quot; : null</div><div>            }, {</div><div>                &quot;departure&quot; : {</div><div>                    &quot;iataCode&quot; : &quot;BIO&quot;,</div><div>                    &quot;geoNodeId&quot; : 9655</div><div>                },</div><div>                &quot;destination&quot; : {</div><div>                    &quot;iataCode&quot; : &quot;BCN&quot;,</div><div>                    &quot;geoNodeId&quot; : 9646</div><div>                },</div><div>                &quot;date&quot; : 1536019200000,</div><div>                &quot;time&quot; : &quot;0000&quot;,</div><div>                &quot;timeWindow&quot; : null</div><div>            }</div><div>        ],</div><div>        &quot;includedCarriers&quot; : [],</div><div>        &quot;mandatoryCarriers&quot; : [],</div><div>        &quot;excludedCarriers&quot; : [],</div><div>        &quot;excludedRoutes&quot; : [],</div><div>        &quot;externalSelectionRequest&quot; : null,</div><div>        &quot;corporateCodes&quot; : [],</div><div>        &quot;cabinClass&quot; : &quot;TOURIST&quot;,</div><div>        &quot;numAdults&quot; : 1,</div><div>        &quot;numChildren&quot; : 0,</div><div>        &quot;numInfants&quot; : 0,</div><div>        &quot;resident&quot; : false,</div><div>        &quot;searchMainProductType&quot; : &quot;FLIGHT&quot;,</div><div>        &quot;directFlightsOnly&quot; : false,</div><div>        &quot;dynpackSearch&quot; : false,</div><div>        &quot;membershipFee&quot; : false,</div><div>        &quot;sortCriteria&quot; : &quot;MINIMUM_PURCHASABLE_PRICE&quot;,</div><div>        &quot;mainAirportsOnly&quot; : false,</div><div>        &quot;maxSize&quot; : 500,</div><div>        &quot;upsell&quot; : null</div><div>    },</div><div>    &quot;activeProvidersInSearch&quot; : null,</div><div>    &quot;buypath&quot; : 71,</div><div>    &quot;marketingTrackingInfo&quot; : {</div><div>        &quot;id&quot; : null,</div><div>        &quot;utmSource&quot; : null,</div><div>        &quot;utmCampaign&quot; : &quot;&quot;,</div><div>        &quot;utmMedium&quot; : &quot;no_GA&quot;,</div><div>        &quot;utmContent&quot; : &quot;&quot;,</div><div>        &quot;utmTerm&quot; : &quot;&quot;,</div><div>        &quot;utmClickId&quot; : &quot;&quot;,</div><div>        &quot;traUtmSource&quot; : null,</div><div>        &quot;traUtmCampaign&quot; : null,</div><div>        &quot;traUtmMedium&quot; : null,</div><div>        &quot;traUtmContent&quot; : null,</div><div>        &quot;traUtmTerm&quot; : null,</div><div>        &quot;traUtmClickId&quot; : null,</div><div>        &quot;marketingChannelId&quot; : null,</div><div>        &quot;searchMarketingChannelId&quot; : null,</div><div>        &quot;marketingTrackingCookie&quot; : null,</div><div>        &quot;customMarketingTrackingCookie&quot; : null,</div><div>        &quot;marketingChannelError&quot; : null,</div><div>        &quot;searchMktTrackingCookie&quot; : null,</div><div>        &quot;searchMarketingChannelError&quot; : null,</div><div>        &quot;marketingPortal&quot; : &quot;EDR_ES&quot;</div><div>    }</div><div>}</div><div>Track <b>return</b>: searchResponse</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;searchId&quot; : 7085586500,</div><div>    &quot;externalSelectionResponse&quot; : &quot;null&quot;</div><div>}</div><div> </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an explanation of the json involved in the rest-searchRoomAvailability operation ?</div></td></tr><tr><td><div><b>rest-searchRoomAvailability</b></div><div>Location in code: SearchEngineServiceRestController.searchRoomAvailability. Converter: AccommodationDataConverter</div><div>Used in call DAPI searchRoomAvailability</div><div>Track <b>invoke</b>: searchId and dealKey</div><div><br/></div><div style="padding-left:40px;"><b>Example:</b></div><div><br/></div><div>{</div><div>    &quot;searchId&quot; : &quot;7086186514&quot;,</div><div>    &quot;dealKey&quot; : &quot;0&quot;</div><div>}</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the flow of the search operation ? How many steps are involved ?</div></td></tr><tr><td><div>The flow of search-engine for the search operation, more specifically, the part of the search operation in which the search results are obtained, is divided into 4 different steps:</div><div><br/></div><ul><li><div>Calculate searches</div></li><li><div>Launch searches &amp; Deliver Results</div></li><li><div>Build Results (use filter of repeated itineraries)</div></li><li><div>Post Process</div></li></ul><div>The next sections briefly explain this steps to set the context for the Build Results step, where the Filter of Repeated Itineraries is used. The build results step and the usage of the filter is explained in detail in that section.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you give an explanation of the calculate search step ?</div></td></tr><tr><td><div>Calculate searches</div><div>As a first step of SearchEngine related with search strategies model we select a <b>Suite</b>.</div><div>With this Suite we create a <b>SearchPatternsSuiteLauncher</b> and we use this launcher to work with the strategy model.</div><div>In the calculateSearches step:</div><div>The SearchPatternsSuiteLauncher is used to <b>calculate the ItineraryGateway searches</b> using the search strategy model</div><div>It calls the calculateProductGatewaySearchCriteriaSet in the launcher that will return the IG searches, asking to all the created builders for the IG searches</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an explanation of the launch searches step ?</div></td></tr><tr><td><div>Launch searches</div><div>The launch searches step:</div><div>we <b>launch all the IG searches</b> to ItineraryGateway and receive the results.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an explanation of the deliver results step ?</div></td></tr><tr><td><div>Deliver results</div><div>The deliver results step:</div><div>We <b>deliver</b> all the IG results to the <b>corresponding builder</b>.</div><div>We call the method deliverGatewaySearchResults of the launcher that will deliver the results to each builder.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you give an explanation of the build results step ?</div></td></tr><tr><td><div>Once all the builders have received the results we start the product building step.</div><div>We call the method <b>buildResults</b> on the <b>launcher</b>, which calls the <b>buildItineraries</b> method.</div><div>This method creates a <b>ResultBuilder</b> object that receives as parameter an instance of <b>FilterRepeatedFareItineraries</b> filter.</div><div>Then we iterate on the list of StrategyItineraryBuilders to add the results of each builder to the ResultsBuilder object.</div><div>For those StrategyItineraryBuilders that have results, we add the results list to the builder (map key value: strategy, itinerary list).</div><div>In this addResults operation we keep to different containers:</div><ul><li><div><b>container</b>: list of fareItinerary per strategy that are <u>not eligible to have duplicates</u></div></li><li><div><b>filteredContainer</b>: list of fareItinerary per strategy that are <u>eligible to have duplicates</u></div></li></ul><div><br/></div><div><br/></div><div>At this point we have the itineraryList for each strategy inside the ResultsBuilder, separating each result in two different containers according to the criteria of eligibility for duplicates.</div><div><br/></div><div>The final step of the product building is to call the method <b>filterItineraries</b> in the launcher that receives the ResultBuilder as parameter.</div><div>In the filterItineraries method we first call the method <b>buildResults</b> in the ResultBuilder.</div><div>This method does two actions:</div><ol><li><div><b>buildResults</b> on the <b>filteredContainer</b> (that contains the itineraries with possible duplicates)</div></li><li><div><b>add</b> the itineraries of <b>container</b> (that contains the itineraries with no duplicates; we know that these itineraries are simple, so they do not need product building and can be added directly to the list of results)</div></li></ol><div>The <b>buildResults</b> operation of the FilteredContainer takes the list of itineraries to filter and applies a set of filters on it. The list after applying all the filters is returned as the results itinerary list.</div><div>This list only contains the FilterRepeatedFareItineraries.</div><div>So we call the filter method of FilterRepeatedFareItineraries that receives a list of itineraries as parameter, and returns a filtered list of itineraries.</div><div>Inside the filter method, we <b>sortAndFilterItineraries</b> itineraries list.</div><div><br/></div><div>There is a log <b>FareItineraryListLogger</b> to see what happens in this filter (needs DEBUG level for the FareItineraryListLogger class). The log prints the combination before and after filter, and the duplicates. </div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>How is decided if a fareItinerary is eligible to have duplicates ?</div></td></tr><tr><td><div>To decide if a FareItinerary is eligible to have duplicates we use the FilterRepeatedFareItineraries.</div><div>Eligible to have duplicates if:</div><ul><li><div>1 or 2 segments AND (some Gds flight OR itinerary matching a condition in IT_FILTER_REPEATED_CONF)</div><div>The conditions:</div></li><ul><li><div>provider codes of itinerary contain higherPriorityProviderCode or lowerPriorityProviderCode,</div></li><li><div>carrier of first segment of outbound equals to carrierCode (if informed), website of search criteria matches website (if informed),</div></li><li><div>test token of search criteria matches test token (if informed)</div></li></ul><li><div>CompositeFareItinerary: Hub, XF, OWasRT, SmartHub, Hiding</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>who is responsible for the sort and filtering of the results ?</div></td></tr><tr><td><div>The <b>sortAndFilterItineraries</b> method is the method that contains the logic of the filter.</div><div>In this method we call the method getFilterRepeatedConfigurationItemsList of filterRepeatedConfigurationRetriever, passing the test token of search criteria as parameter</div><div>to retrieve the FilterRepeatedConfigurationItems that we will use to sort and filter the itineraries.</div><div>We will apply in a loop all the FilterRepeatedConfigurationItems, to sort and filter the itinerary list. At the end of the loop we will have applied the sort and filter operations for all the items.</div><div>The parameters inside a FilterRepeatedConfigurationItems are: higherPriorityProviderCode, lowerPriorityProviderCode, threshold, applyPerPassenger, websiteCode, carrierCode, testName, partitionNumber.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>How does the sort of the results work ?</div></td></tr><tr><td><div>For each item we sort the list with FilterRepeatedFareItineraryComparator that receives as parameter the item.</div><div>The comparison to sort the itineraries takes into account:</div><ul><li><div><b>compareProviderPrice</b>: compare provider price and give priority to the cheaper.</div><div>If certain conditions apply for the itineraries we are comparing, we apply a threshold to the provider price before comparing. (FilterRepeatedFareItineraryComparator.applyThreshold)</div><div>These conditions are checked in the ItineraryGatewaySearchResultsItems (provider itineraries) of the itinerary.</div><div>Carrier and higherPriorityProviderCode of the filterRepeatedConfigurationItem should match the values of the provider itinerary.</div></li><li><div><b>compareEticket</b>: gives priority to the eticket true</div></li><li><div><b>compareGdsService</b>: gives priority to Gds itineraries with NORMAL GdsService type</div></li><li><div><b>compareProviders</b>: gives priority to lower number of providers in the itinerary; if same number of providers, gives priority to providers that match (more times) the higherPriorityProviderCode of the FilterRepeatedConfigurationItem</div></li><li><div><b>commissionComparator</b>.compare: gives priority to itinerary with higher minimumCommission</div></li><li><div><b>repeatedFareItineraryIataComparator.compareIata</b>: gives priority to itineraries whose Gds provider itineraries have (more times) the Iata equals to default Iata of website</div><div>   if same priority, check country (agent country of the used iata should match the default country of the website)</div><div>   if same priority, check brand (brand of used credentials suite should match brand of the website)</div></li></ul><div>With this criteria we sort the list of itineraries.</div><div>The sort operation only depends on the FilterRepeatedConfigurationItem being used to decide if we apply threshold of provider price, to see which providers have priority.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is an extra search ?</div></td></tr><tr><td><div>Functionality to launch an Amadeus provider search specifying a list of mandatory carriers, so the search results only contain itineraries of these carriers.</div><div>The extra search functionality is implemented using the AmadeusLongHaul strategy. This is the strategy to generate extra searches.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the various steps of the extra search ?</div></td></tr><tr><td><ul><li><div>Select strategies (load from DB)</div></li><li><div>Calculate searches</div></li><li><div>Launch searches</div></li><li><div>Build itineraries</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain how does an extra search select a strategy ?</div></td></tr><tr><td><div>If the suite and pattern selected contain an AmadeusLongHaul strategy: the</div><div>AmadeusLongHaulStrategy is created using the information corresponding to the strategy in</div><div>FI_SEARCH_STRATEGIES, and the AmadeusProviderParameters, that are loaded from</div><div>FI_SEARCH_STRATEGIES_AMADEUS for the corresponding strategy id.</div><div>The configuration of the AmadeusLongHaul strategy is the same as Amadeus normal, but</div><div>the value of GdsService inside AmadeusParameters is LONG_HAUL (instead of normal).</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain how does an extra search calculate the searches ?</div></td></tr><tr><td><ul><li><div>Once the AmadeusLongHaul strategy is loaded, we call the method createItineraryBuilder to create the AmadeusLongHaulStrategyItineraryBuilder that will be used to calculate the gateway searches and later build the itineraries.</div></li></ul><div><br/></div><ul><li><div>Then we call the method to get the gateway searches in the itineraryBuilder. In this method we validate that the search is allowed. We do the same checks as Amadeus normal strategy (allowed by calendar, flight search, allowed by dates and allowed by Iata &amp; middle office combination). Finally there is a check that is GdsService specific. For LONG_HAUL service, we check that the search is not MultiSegment, and does not contain any shuttle segment.</div></li></ul><div><br/></div><ul><li><div>If the conditions are satisfied, we generate an AmadeusGatewaySearchCriteria with the amadeus parameters.</div></li></ul><div><br/></div><ul><li><div>Note that at this point the flow is the same as Amadeus normal strategy. The only difference is that the GdsService value is LONG_HAUL</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain how does an extra search launch searches ?</div></td></tr><tr><td><ul><li><div>The gateway searches are sent to itinerary gateway to perform the real searches on the providers.</div></li></ul><div><br/></div><ul><li><div>For an AmadeusGateway search, the flow distinguishes between gdsService NORMAL and LONG_HAUL.</div></li></ul><div><br/></div><ul><li><div>For LONG_HAUL we obtain the list of mandatory airlines (carriers) that should be specified in the Amadeus search.</div></li></ul><div><br/></div><ul><ul><li><div>The list of mandatory airlines is retrieved from DB, configured in tables FI_MANDATORY_CONDITIONS and FI_MANDATORY_AIRLINES. From these tables we obtain a list of airlines codes for each route_market.</div></li></ul></ul><div><br/></div><ul><ul><li><div>The route markets are configured in FI_ROUTE_MARKETS table. Each route_market contains a set of routes that are configured in FI_ROUTE_SETS.</div></li></ul></ul><div><br/></div><ul><ul><li><div>All this information of mandatory airlines is structured in a Map, where the key is the itineraryMarket (that identifies the routes and the markets) and the value is the list of mandatory airlines.</div></li></ul></ul><div><br/></div><ul><li><div>To obtain the mandatory carriers for our search, we check which entries of the map apply for our gdsService, origin and destination (the itinerary market should contain the route origin-destination). If the itineraryMarket is matched, its airlines are added to the list of mandatory carriers for the search.</div></li></ul><div><br/></div><ul><li><div>We apply some filters to filter forbidden MarketingAirlines and ValidatingAirlines.</div></li></ul><div><br/></div><ul><li><div>At this point we have the list of mandatoryAirlines to be sent to Amadeus.</div></li></ul><div><br/></div><ul><li><div>We create the AmadeusProviderSearch specifying the mandatoryAirlines obtained.</div></li></ul><div><br/></div><ul><li><div>The results of the gateway searches are returned.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain how does an extra search build its itinearies ?</div></td></tr><tr><td><div>there is no logic in the build itinearies tep for amadeus searches. The results returned by amadeusGateawySearch are directly returned</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you show the model for the extra search configuration ?</div></td></tr><tr><td><img src="Search Engine_files/image [7].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what is the difference between the amadeus long haul strategy and the amadeus normal strategy ?</div></td></tr><tr><td><div>The AmadeusLongHaulStrategy of SearchEngine is the same as AmadeusNormalStrategy (only difference is the value of GdsService), but in terms of configuration there is no difference</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the tables of the extra search and who is in charge of using it ?</div></td></tr><tr><td><div>The tables FI_MANDATORY_CONDITIONS, FI_MANDATORY_AIRLINES, FI_ROUTE_MARKETS, FI_ROUTE_SETS that store the configuration for extra searches are only accessed by ItineraryGateway.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how can we  implement an extended functionality of extra searches ?</div></td></tr><tr><td><div>An extended functionality of extra searches could be implemented using the parameter mandatoryCarriers of the SE search request. This parameter can specify the list of mandatory airlines to be sent to Amadeus. Then, the search could be a gdsService NORMAL with the mandatoryCarriers parameters. For Amadeus, the functionality would be the same (making sure that AmadeusProviderSearch takes into account the parameter mandatoryCarriers of the request). For other providers we  could implement an equivalent logic. For providers such as Ryanair or Vueling, we launch the provider search only if they are specified in mandatoryCarriers parameters. For providers such as TF, we should specify the “components” (airlines) that we want results from. This functionality should be available in TF request.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the corporate codes in amadeus search strategy ? </div></td></tr><tr><td><div>Another parameter that could be used for this functionality is the corporateCodes. CorporatesCodes are used in Amadeus searches to get better prices. For example, if</div><div>the search is from a TABLET device, IG uses the corporateCode of tablet for the Amadeus search.</div><div>The corporateCodes is also a parameter of IG request, so the SE can send corporateCodes to be applied. IG will send all the corporateCodes to Amadeus. If there available codes from business, we could generate a search strategy to use these codes.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you describe the flow for the smartHub strategy ?</div></td></tr><tr><td><div>Select strategies (load from DB)</div><div>Calculate searches</div><div>Launch searches</div><div>Build itineraries</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>What are the classes related to the smarthub strategy ?</div></td></tr><tr><td><ul><li><div><b>SmartHubSearchStrategy</b>​ : definition of SmartHub strategy</div></li><li><div><b>SmartHubSearchStrategyBuilder</b>​ : itinerary builder for smartHub strategy</div></li><li><div><b>DynamicHubSearchStrategy</b>​ : hub strategy built in runtime for the smartHub configurations that apply to the searchCriteria</div></li><li><div><b>DynamicHubSearchStrategyItineraryBuilder</b>​ : itinerary builder for the hub strategy built in runtime</div></li><li><div><b>CrossFaringDynamicHubStrategyItineraryBuilder</b>​ : itinerary builder for a crossFaring strategy that contains to dynamic hubs as sub-strategies for each leg</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>Can you describe the select strategies step of the smartHub Strategy ?</div></td></tr><tr><td><div>We select the suite to apply, we get the active pattern and its strategies. To get the strategies, we need to load all the information from database. Assume one of these strategies is SmartHub. </div><div>If the selected pattern contains a SmartHub search strategy, the SmartHubSearchStrategyStore will be used to generate an ​ instance of SmartHubSearchStrategy​ (​ no loading from DB​ needed at this point).</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the calculate searches step of the smarthub strategy ? </div></td></tr><tr><td><ol><li><div>Once we have the smartHub strategy created, we use the createItineraryBuilder method to generate the SmartHubSearchStrategyItineraryBuilder that will help us to calculate the gateway searches to launch. </div></li><li><div>Next we do a call to the getItineraryGatewaySearchCriteriaSet on the SmartHubSearchStrategyItineraryBuilder to calculate the gateway searches. </div></li></ol></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how do we use the createItineraryBuilder when doing a smartHub search ?</div></td></tr><tr><td><ul><li><div>a. To apply smartHub we need a ​ OneFrontDektop search without multisegment​ . If these conditions are not satisfied, smartHub strategy is not applied. </div></li><li><div>b. First step is to ​ retrieve the smartHubRule​ that applies for the given search criteria using the SmartHubConfigurationRetriever.</div></li><li><div>c. The set of all smartHubRules available in DB (​ FI_SMART_HUB_RULE​ ) are loaded. </div></li><li><div>d. Among the available SmartHubRules we ​ select the one with highest priority​ (lower value = higher priority) that ​ matches our searchCriteria​ . The matching is done with the flowItemConditionsSet. All the flow items conditions should match our searchCriteria. (Website, IncludesMetaSearch, DayOfWeek, ItineraryLocationPair, ItineraryCountry)</div></li><li><div>e. If no rule matches the searchCriteria, the SmartHub strategy is not applied.</div></li><li><div>f. Next step is to ​ get the policyNumber​ of the mandatory insurance for Hub itinerary (connection insurance).</div></li><li><div>g. The policyNumber is configured by website. We use the HubCrossFareRulesManager and we get the policyNumber by website.</div></li><li><div>h. The HubCrossFareRulesManager.properties contains the policy number for each configured website. CNXHUB153 for all the configured websites.</div></li><li><div>i. If no policy number is configured for the specified website, the an exception is thrown and the Hub strategy cannot be used.</div></li><li><div>j. If we get the policy number correctly, then we create the itinerary builder passing the necessary parameters. In this step we set the EconomicSearch parameter of the searchCriteria to true (NOT USED!).</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>what are the informations stored in the SmartHubRule ?</div></td></tr><tr><td><div>The ​ SmartHubRule ​ object contains the following information (see model of SmartHub configuration):</div><ul><li><div>Id​ : ID of the rule (FI_SMART_HUB_RULE.ID)</div></li><li><div>FlowItemConditionsSet​ : set of flow item conditions for the SmartHub. The Set is identified by FI_SMART_HUB_RULE.FLOW_ITEM_COND_SET_ID. The FlowItemCondition objects are retrieved from database using this id.</div></li><li><div>Enabled​ : boolean to specify if rule is enabled (FI_SMART_HUB_RULE.ENABLED)</div></li><li><div>Description​ : description of the rule (FI_SMART_HUB_RULE.DESCRIPTION)</div></li><li><div>Priority​ : priority value to sort the rules (FI_SMART_HUB_RULE.PRIORITY)</div></li><li><div>SmartHubDefinitions​ : list of hubs configured​ for the rule. This class defines a concrete airport to be used as a hub (​ FI_SMART_HUB_DEFINITION​ ). Besides the hub itself, it contains info about min/max connection times, possibility to shift date for outbound/inbound, flowItemConditions for dayOfWeek, specific list of providers allowed in each leg and use of cacheOnly for them.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>how do we use the getItineraryGatewaySearchCriteriaSet while doing a smarthub search ?</div></td></tr><tr><td><ul><li><div>a. First step is to get the​ enabled SmartHub definitions​ for the SmartHubRule. We get a subset of X objects among the set of definitions that belong to the rule and are enabled. The X values is defined in HubCrossFareRulesManager.smartHubMaximiumDefinitions​ . The value is hardcoded to 2. ​ (PROBLEM!!!! Set is not ordered... which definitions are we selecting?)</div></li></ul><div><br/></div><ul><li><div>b. Then we get the definitions that ​ match the DayOfWeek condition ​ (if any).The departure day of the searchCriteria has to match the dayOfWeek flow item condition (if specified). </div></li></ul><div><br/></div><ul><li><div>c. At this point we have the set of SmartHubDefinitions that will be used to calculate the itinerary builders for the sub-strategies to launch.</div></li></ul><div><br/></div><ul><li><div>d. If the search is ​ ONE_WAY ​ create a DynamicHubSearchStrategyItineraryBuilder for each definition (crossFaring not included).</div></li></ul><div><br/></div><ul><li><div>e. If the search is ​ ROUND_TRIP a nd there is ​ only one definition ​ available, create a DynamicHubSearchStrategyItineraryBuilder for it (crossfaring included).</div></li></ul><div><br/></div><ul><li><div>f. If the search is ​ ROUND_TRIP a nd there ​ several definitions​ available create the following strategies: simple smartHub for each Hub definition (DynpamicHubSearchStrategyItineraryBuilder); a crossfaring strategy with one way simple hubs with each hub definition for each segment (CrossFaringDynamicHubStrategyItineraryBuilder with DynamicHubs)</div></li></ul><div><br/></div><ul><li><div>g. The creation of a DynamicHubSearchStrategyItineraryBuilder implies the creation of a DynamicHubSearchStrategy for this smartHubRule and definition.</div></li></ul><div><br/></div><ul><li><div>h. From the available definitions we got all the itinerary builders. Now we call the method ​ getItineraryGatewaySearchCriteriaSet ​ on each builder to get the gateway searches.</div></li></ul><div><br/></div><ul><li><div>i. For DynamicHub builder, the logic to get gateway searches is the same as Hub, but ​ including crossFarings when specified​ .</div></li></ul><div><br/></div><ul><li><div>j. For CrossFaringDynamicHub builder, the logic to get the gateway searches is the same as CrossFaring. The strategies used are ​ DynamicHub for each leg​ . As they are OW, these Hubs do not include crossFaring strategy, only AmadeusNormal and LowCost.</div></li></ul><div><br/></div><ul><li><div>k. Keep in mind that for Hubs we add a ​ plusOneDay​ on departure date of last segment in the leg, which generates another gateway search.</div></li></ul><div><br/></div><ul><li><div>l. Each hub will use sub-strategies to generate the gateway searches. In general they will use AmadeusNormal and LowCost strategies, but also CrossFaring on the DynamicHubs RT.</div></li></ul><div><br/></div><ul><li><div>m. All the set of gateway searches generated is returned.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the launch searches step of the smarthub strategy ?</div></td></tr><tr><td><div>The gateway searches calculated in the previous step are sent to the IG module, that perform the searches on the providers.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you explain the build itineraries step of the smarthub strategy ?</div></td></tr><tr><td><div>The results from gateway searches (provider results) are combined according to the strategy builders to build the final itinerary results.</div><div><br/></div><ul><li><div>1. First, we ​ build the itineraries for each itineraryBuilder​ that we generate in the SmartHub strategy (dynamicHubSearchStrategyItineraryBuilder).</div></li></ul><div><br/></div><ul><li><div>2. The buildItineraries method of​ DynamicHub has the same behavior as Hub​ . So it starts building all the itineraries for originToHubLeg and hubtToDestination leg, calling buildItineraries method on all the sub-strategy builders. Then it gets the insuranceOffer and mix the itineraries from origintToHub and hubtToDEstination legs to build Hub itineraries. </div></li></ul><div><br/></div><ul><li><div>3. For the ​ CrossFaring ​ strategy with DynamicHubs we ​ combine the itineraries generated for each leg​ (generated by a DynamicHub OW) with the ​ mixer​ .</div></li></ul><div><br/></div><ul><li><div>4. Once all the itineraries for DynamicHubs builders and CrossFaring of DynamicHubs are built, we sort them by total provider price and departure date.</div></li></ul><div><br/></div><ul><li><div>5. We iterate over the sorted list of the itineraries, ​ checking some conditions​ to decide if the itinerary is added to the list of final results.</div></li><ul><li><div>a. The​ size of final results list​ is lower than smartHubMaximumResults configured in HubCrossFareRulesManager. Value hardcoded to 5.</div></li><li><div>b. The itinerary has​ less or equal PNRs than maximum allowed​ . In other words, the number of simple itineraries that compose the itinerary is less than the maximum allowed. This value is configured in HubCrossFareRulesManager and is set to 4.</div></li></ul></ul><div><br/></div><ul><li><div>6. The list of final results is returned.</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the model of the smarthub configuration ?</div></td></tr><tr><td><img src="Search Engine_files/image [8].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the operation flow of the smarthub strategy for a one way trip ?</div></td></tr><tr><td><img src="Search Engine_files/image [9].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the operation flow of the smarthub strategy for a round trip with one definition ?</div></td></tr><tr><td><img src="Search Engine_files/image [10].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the operation flow of the smarthub strategy of a round trip flight with multiple definitions ?</div></td></tr><tr><td><img src="Search Engine_files/image [11].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the funtional logic of a hiding strategy ?</div></td></tr><tr><td><div>Each hiding strategy has one or several MAIN substrategies, and one or several HIDING substrategies.</div><div>With the current configuration of Prod database, all the hiding strategies have only 1 MAIN substrategy and 1 HIDING subtrategy.</div><div><br/></div><img src="Search Engine_files/image [12].png" type="image/png" data-filename="image.png"/><div><br/></div><div><br/></div><div>For each HIDING substrategy a list of blacklisted carriers can be specified. Currently there is no carrier blacklisted for any HIDING substrategy.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe how is done the calculate search step for the hiding strategy ?</div></td></tr><tr><td><div>Conditions to apply Hiding in calculate searches:</div><ul><li><div>No multisegment search</div></li></ul><div><br/></div><div>If this condition is not satisfied, the Hiding strategy will not be applied (no provider searches generated by Hiding strategy).</div><div><br/></div><div>First step of calculate searches is to calculate the provider searches for the Main substrategies. For each main substrategy, we calculate the corresponding searches.</div><div>Second step is to calculate the provider searches for the Hiding substrategies. However, some conditions need to be satisfied to calculate these provider searches:</div><ul><li><div>Hiding substrategies are launched only for a percentage of times (percentageLaunchingHiding), which is configured in database</div></li></ul><div><br/></div><ul><li><div>Calendar related conditions:</div></li><ul><li><div>The configured Main and Hiding substrategies are not banned by calendar. Some combinations of Main-Hiding substrategies are banned. For each hiding substrategy, we check that its combination with any of the main substrategies are not banned. Otherwise, the hiding substrategy cannot be used. The banned combinations are configured in a properties file HidingStrategyCompatibilityConfiguration.properties. The combinations (of search strategy types) banned in the properties file:  strategiesToBeBannedByCalendar= 1=1 (1: Amadeus normal strategy type)</div></li></ul></ul><div><br/></div><div>or</div><ul><ul><li><div>allowed by calendar. For Hiding strategy and the agent used (default agent of the website), there should not be any calendar restriction with the maximum outbound date specified in the search. The restrictions are specified in a csv file. Each agent has its csv file associated. In the csv file there are the calendar restrictions for each strategy.</div></li></ul></ul><div><br/></div><div>If the conditions are satisfied, for each hiding substrategy, we calculate its provider searches.</div><div><br/></div><div>All the calculated provider searches (from main and hiding substrategy) will be sent to  providers.</div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe how is done the product building step for the hiding strategy ?</div></td></tr><tr><td><div>For each main substrategy, its corresponding results are built (following the internal logic of the substrategy).</div><div>Then, we find a compatible hiding substrategy among the list of hiding substrategies used (note that currently we have only one main substrategy, and one hiding substrategy, so there is only one combination possible). A main substrategy and hiding substrategy are compatible if:</div><ul><li><div>they are of same strategy type ()</div></li></ul><div>Or</div><ul><li><div>they are compatible according to the HidingStrategyCompatibilityConfiguration.propreties. hidingStrategyCompatibility=\ 1=9 (1: Amadeus normal strategy type, 9: Amadeus OW from RT strategy type)</div></li></ul><div><br/></div><div>There should be an existing compatibility combination matching the combination of main and hiding substrategies. Otherwise, the combination is not valid. Currently in production, only the combination ​ Amadeus normal ​ with ​ Amadeus OW from RT ​ is allowed.</div><div><br/></div><img src="Search Engine_files/image [13].png" type="image/png" data-filename="image.png"/><div><br/></div><div><br/></div><div>The first hiding substrategy that is compatible with the main is selected, and associated with the Main. The results for the Hiding substrategy are built according its own logic. Then, they are filtered:</div><ul><li><div>Results containing blackListed carriers are discarded</div></li><li><div>List is reduced to contain only numResults results (parameter configured in Hiding strategy)</div></li></ul><div><br/></div><div>Finally a container for results is created, to represent the results of Main-Hiding combination:</div><ul><li><div>List of results of main substrategy</div></li><li><div>List of results of hiding substrategy (associated with the main substrategy)</div></li></ul><div><br/></div><div>We’ll have a container for each main substrategy which has a compatible combination with one of the hiding substrategies used. For each container:</div><div>Conditions for combining main and hiding substrategy results are checked:</div><ul><li><div>No multisegment search</div></li><li><div>Main substrategy results not empty and Hiding substrategy results not empty</div></li></ul><div><br/></div><div>If the conditions are not satisfied, only the main substrategy results are used. If conditions are satisfied, then we combine main and hiding results, trying to replace results of main substrategy with results of hiding substrategy (which is supposed to be cheaper) if they are the same results. For each hiding substrategy result:</div><div>All the segment combinations are generated, and we keep the relation between each segmentComdination identifier and the result that generates it.</div><div><br/></div><div>We also keep a relation between a result and all the carriers contained in it. Finally, we follow this steps for each main substrategy itinerary: </div><div><br/></div><ul><li><div>1. Change the main itinerary with a hiding itinerary if it is equals to the main and has cheaper provider price. The replacement considers the different segmentCombinations, so we might replace only one segmentCombination. The remaining segmentCombinations not replaced, will continue be given by the main itinerary. For a combination to be replaced, it needs to be the same, but also cheaper in terms of provider price. The difference in provider price should be equals or greater than threshold (parameter of the Hiding Strategy), otherwise, we don’t replace the result.</div></li></ul><div><br/></div><ul><li><div>2. With the remaining hiding substrategy results not used in step 1, we change the main itinerary with a hiding if they have exactly the same carriers and the hiding has cheaper provider price (difference of threshold at least). </div></li></ul><div><br/></div><ul><li><div>3. After step 2 and 3, with all the remaining hiding substrategy results not used yet, we add hiding subtrategy results to the list of results if they are cheaper that the cheapest result of main subtrategy (difference of threshold at least). It considers onlythe segmentCombinations of the hiding substrategy itineraries not being used until now. When replacing the main itinerary by the hiding (or just adding a hiding), we create a HidingFareItienrary which wraps the hiding substrategy itinerary and the providerPrice of the main sustrategy itinerary. So the list of fareItineraries created by a Hiding strategy will contain:</div></li><ul><li><div>Itineraries of type equals to the Main substrategy</div></li><li><div>HidingFareItinerary (replacing main itineraries or just added)</div></li></ul></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe how is done the apply pricing step for the hidden startegy ?</div></td></tr><tr><td><div>The pricing is applied by the pricing-engine module. The search results generated in search-engine are sent to pricing-engine, and then pricing-engine applies the pricing for each result according to its logic.</div><div><br/></div><div>When sending the search results to pricing-engine, the itinerary type is specified (​ SIMPLE, COMPOSITE, XFARING, HUB, OWasRT, HIDDING, SMART_HUB, MULTI_DESTINATION​ ).</div><div><br/></div><div>Also if the fareItinerary is of type Hiding, two specific parameters are calculated and sent to pricing-engine to apply the pricing in this itinerary:</div><ul><li><div>hidingProviderPriceMain: contains the provider price of the main substrategy result that is replaced by this hiding</div></li><li><div>hidingStrategyType:</div></li><ul><li><div>ONEWAY_AS_ROUNDTRIP: if the hidingFareItinerary contains itinerary of OneWayAsRoundTrip strategy (itself or substrategies)</div></li><li><div>MULTI_IATA: if the fareItinerary inside the Hiding is generated by Amadeus strategy and this strategy has a spefici Iata configured (different than the default IATA)</div></li><li><div>OTHER: for any other case</div></li></ul></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you describe the selection and booking flow for the hidden strategy ?</div></td></tr><tr><td><div>In the selection process, we convert the FareItinerary into an Itinerary using the select operation.In this selection process the shoppingCart is created. The soppingCart contains the shoppingItems that will be booked during the flow. One of the shopping items might be anItineraryShoppingItem.</div><div><br/></div><div>The itineraryShoppingItem contains the Itinerary that is being selected.</div><div>During the selection and booking flow, the itineraryShoppingItem will be converted to an ItineraryBookingItem.</div><div>Eventually the booking will be completed, and its information will be logged in database, in the tables ED_BOOKING and FI_BOOKING_DETAILS (for itinerary bookings).</div><div>In the table FI_BOOKING_DETAILS that contains the information of the itinerary component of the booking, we store the suite and the search strategy used to generate the itinerary.</div><div><br/></div><img src="Search Engine_files/image [14].png" type="image/png" data-filename="image.png"/><div><br/></div><div><br/></div><div>For Hiding, the original HidingStrategy used in search to generate the HidingFareItinerary is lost in the step FareItienrary.buildItinerary. This happens because when building the itinerary, we just pass the FareItinerary inside the HidingFareItinerary (replaced), but we don’t pass the searchStrategy.</div><div>The Itinerary (or HidingItinerary) obtains the searchStrategy from the Itinerary that has inside. For HidingItinerary, this itinerary is the Hiding Substrategy itinerary. Its strategy will be one of the hiding substrategies configured in the original HidingStrategy.</div><div><br/></div><div>That’s why in FI_BOOKING_DETAILS we don’t have any HidingStrategy. For bookings that come from HidingStrategy, we store the subStrategy (hiding substrategy) used to generate the sub-result, but not the original Hiding strategy.</div><div><br/></div><img src="Search Engine_files/image [15].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you list the configuration parameters for the hidden startegy ?</div></td></tr><tr><td><ul><li><div><b>numResults</b>:​ number of results built for each hiding substrategy used</div></li><li><div><b>Threshold</b>: ​ difference of provider price between main substrategy result and hiding substrategy result needed to replace the main by hiding</div></li><li><div><b>percentageLaunchingHiding</b>:​ percentage of times the hiding substrategies will be launched when applying the hiding strategy</div></li><li><div><b>subMainStrategies</b>​ : list of sub strategies that will be used as Main</div></li><li><div><b>subHidingStrategies</b>​ : list of sub strategies that will be used as Hiding</div></li><li><div><b>blackListedCarriers</b>​ : list of carriers blacklisted for the sub strategies used as Hiding</div></li></ul></td></tr></tbody></table><div><br/></div><table style="width:1236px;" width="1236px"><colgroup><col style="width: 1236px;"></col></colgroup><tbody><tr><td><div>can you list the tables and queries used for the hidden strategy ?</div></td></tr><tr><td><div><br/></div><img src="Search Engine_files/image [16].png" type="image/png" data-filename="image.png"/><div><br/></div><img src="Search Engine_files/image [17].png" type="image/png" data-filename="image.png"/><div><br/></div></td></tr></tbody></table><div><br/></div></span>
</div></body></html> 